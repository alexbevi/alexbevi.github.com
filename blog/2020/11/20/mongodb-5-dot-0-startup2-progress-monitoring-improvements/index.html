<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="MongoDB 5.0 Initial Sync Progress Monitoring Improvements" /><meta property="og:locale" content="en" /><meta name="description" content="&lt;SHAMELESS_PLUG&gt; My previous article about initial sync progress monitoring got some attention, and as I’m a Technical Services Engineer at MongoDB, I got to provide direct feedback during the design phase of SERVER-47863: Initial Sync Progress Metrics!." /><meta property="og:description" content="&lt;SHAMELESS_PLUG&gt; My previous article about initial sync progress monitoring got some attention, and as I’m a Technical Services Engineer at MongoDB, I got to provide direct feedback during the design phase of SERVER-47863: Initial Sync Progress Metrics!." /><link rel="canonical" href="https://www.alexbevi.com/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-20T10:31:26-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="MongoDB 5.0 Initial Sync Progress Monitoring Improvements" /><meta name="twitter:site" content="@alexbevi" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-03-28T13:22:31-04:00","datePublished":"2020-11-20T10:31:26-05:00","description":"&lt;SHAMELESS_PLUG&gt; My previous article about initial sync progress monitoring got some attention, and as I’m a Technical Services Engineer at MongoDB, I got to provide direct feedback during the design phase of SERVER-47863: Initial Sync Progress Metrics!.","headline":"MongoDB 5.0 Initial Sync Progress Monitoring Improvements","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/"},"url":"https://www.alexbevi.com/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/"}</script><title>MongoDB 5.0 Initial Sync Progress Monitoring Improvements | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><meta name="google-adsense-account" content="ca-pub-6215800856413580"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src=" /./images/avatar.png " width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">ALEX BEVILACQUA</a></h1><p class="site-subtitle fst-italic mb-0">my little corner of the interwebs</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer" > <i class="fab fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"> Home </a> </span> <span>MongoDB 5.0 Initial Sync Progress Monitoring Improvements</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>MongoDB 5.0 Initial Sync Progress Monitoring Improvements</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1605886286" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 20, 2020 </time> </span> <span> Updated <time data-ts="1616952151" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 28, 2021 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1882 words" > <em>10 min</em> read </span></div></div></header><div class="content"><p><code class="language-plaintext highlighter-rouge">&lt;SHAMELESS_PLUG&gt;</code> <br /> My <a href="/blog/2020/02/13/mongodb-initial-sync-progress-monitoring/">previous article about initial sync progress monitoring</a> got some attention, and as I’m a <a href="/blog/2018/10/01/technical-services-engineering-at-mongodb/">Technical Services Engineer</a> at MongoDB, I got to provide direct feedback during the design phase of <a href="https://jira.mongodb.org/browse/SERVER-47863">SERVER-47863: <em>Initial Sync Progress Metrics</em></a>!.</p><p>You can be a part of this team and this awesome organization too! Head on over to <a href="https://grnh.se/dcd90aac1">MongoDB’s careers page</a> to see what’s available, or feel free to ping me on <a href="https://www.linkedin.com/in/alexbevi/">LinkedIn</a> if you have any questions. <br /> <code class="language-plaintext highlighter-rouge">&lt;/SHAMELESS_PLUG&gt;</code></p><p>The goal of this post is to showcase a change that is coming in MongoDB 5.0 that will significantly improve the feedback loop regarding <a href="https://docs.mongodb.com/manual/core/replica-set-sync/#initial-sync">initial sync</a> progress monitoring. With <a href="https://jira.mongodb.org/browse/SERVER-47863">SERVER-47863</a> being completed, the results of the <a href="https://docs.mongodb.com/manual/reference/command/replSetGetStatus/"><code class="language-plaintext highlighter-rouge">db.adminCommand({ replSetGetStatus: 1, initialSync: 1 })</code></a> now include additional metrics that can be used to help determine how long (approximately) an initial sync will be running for.</p><p><strong>Though this feature is planned to be backported to versions 4.4.3 and 4.2.12, at the time of writing backports had not been completed.</strong></p><p>If you want to test this yourself, my setup was as follows:</p><p>1) <a href="https://github.com/mongodb/mongo/blob/master/docs/building.md#scons-targets">Build the server using the <code class="language-plaintext highlighter-rouge">install-mongod</code> SCons target</a>. My version of the server was <code class="language-plaintext highlighter-rouge">mongod-4.9.0-alpha-596-g4437864</code> as a result. <br /> 2) Start up a single node replicaset as follows:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>data <span class="o">&amp;&amp;</span> build/install/bin/mongod <span class="nt">--dbpath</span> data <span class="nt">--bind_ip_all</span> <span class="nt">--replSet</span> rs0 <span class="nt">--logpath</span> data/mongod.log
</pre></table></code></div></div><p>3) Using the <code class="language-plaintext highlighter-rouge">mongo</code> shell, initialize the replica set:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>mongo <span class="nt">--eval</span> <span class="s1">'rs.initiate()'</span>
</pre></table></code></div></div><p>4) Seed the <code class="language-plaintext highlighter-rouge">test.data</code> namespace using the following <a href="https://github.com/rueckstiess/mgeneratejs"><code class="language-plaintext highlighter-rouge">mgeneratejs</code></a> and <a href="https://docs.mongodb.com/database-tools/mongoimport/"><code class="language-plaintext highlighter-rouge">mongoimport</code></a>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-s</span> https://gist.githubusercontent.com/alexbevi/955c6675337107e16d637233f865b1e3/raw/0c48178e9c570b7594f207559744f07ecf87ac28/template.json | mgeneratejs <span class="nt">-n</span> 1000000 | mongoimport <span class="nt">--collection</span> data <span class="nt">--numInsertionWorkers</span> 4
</pre></table></code></div></div><p>5) Start another <code class="language-plaintext highlighter-rouge">mongod</code> and add it to the replica set</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>data2 <span class="o">&amp;&amp;</span> build/install/bin/mongod <span class="nt">--port</span> 27018 <span class="nt">--dbpath</span> data2 <span class="nt">--bind_ip_all</span> <span class="nt">--replSet</span> rs0 <span class="nt">--logpath</span> data2/mongod.log
mongo <span class="nt">--eval</span> <span class="s1">'rs.add("localhost:27018")'</span>
</pre></table></code></div></div><p>The above steps will build the <code class="language-plaintext highlighter-rouge">mongod</code> and start up 2 nodes in a replica set with one in a <a href="https://docs.mongodb.com/manual/reference/replica-states/#replstate.STARTUP2"><code class="language-plaintext highlighter-rouge">STARTUP2</code></a> (initial sync) state.</p><p>By connecting to the secondary node directly and issuing a <a href="https://docs.mongodb.com/manual/reference/command/replSetGetStatus/"><code class="language-plaintext highlighter-rouge">replSetGetStatus</code></a> command we can now review the progress of the copy. Note that this will need to be done <em>while</em> the initial sync is in progress; once the node exits the <code class="language-plaintext highlighter-rouge">STARTUP2</code> state and enters a <code class="language-plaintext highlighter-rouge">SECONDARY</code> state, the <code class="language-plaintext highlighter-rouge">initialSyncStatus</code> details will be unavailable.</p><p>For example:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>db.adminCommand({ replSetGetStatus: 1, initialSync: 1 });
</pre></table></code></div></div><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="p">{</span>
	<span class="dl">"</span><span class="s2">set</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">rs0</span><span class="dl">"</span><span class="p">,</span>
	<span class="p">...</span>
	<span class="dl">"</span><span class="s2">initialSyncStatus</span><span class="dl">"</span> <span class="p">:</span> <span class="p">{</span>
		<span class="dl">"</span><span class="s2">failedInitialSyncAttempts</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
		<span class="dl">"</span><span class="s2">maxFailedInitialSyncAttempts</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
		<span class="dl">"</span><span class="s2">initialSyncStart</span><span class="dl">"</span> <span class="p">:</span> <span class="nc">ISODate</span><span class="p">(</span><span class="dl">"</span><span class="s2">2020-11-20T15:47:09.136Z</span><span class="dl">"</span><span class="p">),</span>
		<span class="dl">"</span><span class="s2">totalInitialSyncElapsedMillis</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">14925</span><span class="p">,</span>               <span class="o">&lt;-----------</span>
		<span class="dl">"</span><span class="s2">initialSyncAttempts</span><span class="dl">"</span> <span class="p">:</span> <span class="p">[</span> <span class="p">],</span>
		<span class="dl">"</span><span class="s2">approxTotalDataSize</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">311911892</span><span class="p">,</span>                     <span class="o">&lt;-----------</span>
		<span class="dl">"</span><span class="s2">approxTotalBytesCopied</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">16811036</span><span class="p">,</span>                   <span class="o">&lt;-----------</span>
		<span class="dl">"</span><span class="s2">remainingInitialSyncEstimatedMillis</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>             <span class="o">&lt;-----------</span>
		<span class="dl">"</span><span class="s2">appliedOps</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
		<span class="dl">"</span><span class="s2">initialSyncOplogStart</span><span class="dl">"</span> <span class="p">:</span> <span class="nc">Timestamp</span><span class="p">(</span><span class="mi">1605887228</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
		<span class="dl">"</span><span class="s2">totalTimeUnreachableMillis</span><span class="dl">"</span> <span class="p">:</span> <span class="nc">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
		<span class="dl">"</span><span class="s2">databases</span><span class="dl">"</span> <span class="p">:</span> <span class="p">{</span>
			<span class="dl">"</span><span class="s2">databasesToClone</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                              <span class="o">&lt;-----------</span>
			<span class="dl">"</span><span class="s2">databasesCloned</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">...</span>
			<span class="p">},</span>
			<span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="p">:</span> <span class="p">{</span>
				<span class="dl">"</span><span class="s2">collections</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="dl">"</span><span class="s2">clonedCollections</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="dl">"</span><span class="s2">start</span><span class="dl">"</span> <span class="p">:</span> <span class="nc">ISODate</span><span class="p">(</span><span class="dl">"</span><span class="s2">2020-11-20T15:47:13.968Z</span><span class="dl">"</span><span class="p">),</span>
				<span class="dl">"</span><span class="s2">test.data</span><span class="dl">"</span> <span class="p">:</span> <span class="p">{</span>
					<span class="dl">"</span><span class="s2">documentsToCopy</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">250000</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">documentsCopied</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">13481</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">indexes</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">fetchedBatches</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">bytesToCopy</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">311911663</span><span class="p">,</span>                       <span class="o">&lt;-----------</span>
					<span class="dl">"</span><span class="s2">approxBytesCopied</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">16810807</span><span class="p">,</span>                  <span class="o">&lt;-----------</span>
					<span class="dl">"</span><span class="s2">start</span><span class="dl">"</span> <span class="p">:</span> <span class="nc">ISODate</span><span class="p">(</span><span class="dl">"</span><span class="s2">2020-11-20T15:47:13.968Z</span><span class="dl">"</span><span class="p">),</span>
					<span class="dl">"</span><span class="s2">receivedBatches</span><span class="dl">"</span> <span class="p">:</span> <span class="mi">2</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="p">...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The command output has been truncated to focus in on the new fields added to the <code class="language-plaintext highlighter-rouge">initialSyncStatus</code> document. The new metrics details are as follows:</p><p><code class="language-plaintext highlighter-rouge">totalInitialSyncElapsedMillis</code></p><blockquote><p>Current Time - Start Time</p></blockquote><p><code class="language-plaintext highlighter-rouge">remainingInitialSyncEstimatedMillis</code></p><blockquote><p>(<code class="language-plaintext highlighter-rouge">totalInitialSyncElapsedMillis</code> / <code class="language-plaintext highlighter-rouge">approxTotalBytesCopied</code>) * (<code class="language-plaintext highlighter-rouge">approxTotalDataSize</code> - <code class="language-plaintext highlighter-rouge">approxTotalBytesCopied</code>)</p><p>If (<code class="language-plaintext highlighter-rouge">approxBytesCopied</code> == 0), this field will not be shown</p></blockquote><p>I’ve opened <a href="https://jira.mongodb.org/browse/SERVER-53017">SERVER-53017</a> to review this particular entry as the value did not appear to be properly updated throughout the initial sync process. As MongoDB 5.0 is not expected to be GA until mid 2021, this will likely be addressed before then.</p><p><strong>Update 2021-01-26</strong>: <a href="https://jira.mongodb.org/browse/SERVER-53017">SERVER-53017</a> has been fixed.</p><p><code class="language-plaintext highlighter-rouge">&lt;collection&gt;.bytesToCopy</code></p><blockquote><p>= <a href="https://docs.mongodb.com/manual/reference/command/collStats/#collStats.size"><code class="language-plaintext highlighter-rouge">collStats.size</code></a></p></blockquote><p><code class="language-plaintext highlighter-rouge">&lt;collection&gt;.approxBytesCopied</code></p><blockquote><p>= <a href="https://docs.mongodb.com/manual/reference/command/collStats/#collStats.avgObjSize"><code class="language-plaintext highlighter-rouge">collStats.avgObjSize</code></a> * <code class="language-plaintext highlighter-rouge">documentsCopied</code></p></blockquote><p><code class="language-plaintext highlighter-rouge">databasesToClone</code></p><blockquote><p>= length of <a href="https://docs.mongodb.com/manual/reference/command/listDatabases/index.html#output"><code class="language-plaintext highlighter-rouge">listDatabases</code></a> response</p></blockquote><p><code class="language-plaintext highlighter-rouge">approxTotalDataSize</code></p><blockquote><p>= Sum (<a href="https://docs.mongodb.com/manual/reference/command/dbStats/index.html#dbStats.dataSize"><code class="language-plaintext highlighter-rouge">dbStats.dataSize</code></a> for all databases)</p></blockquote><p><code class="language-plaintext highlighter-rouge">approxTotalBytesCopied</code></p><blockquote><p>= Sum (<code class="language-plaintext highlighter-rouge">&lt;collection&gt;.approxBytesCopied</code> for all collections)</p></blockquote><p>What can we do with all this useful information you ask? Well I’ve written the following script that can be used to poll a secondary replica set member in STARTUP2 to provide details regarding the progress of the initial sync. This script will also provide estimated throughput and a calculated ETA based on data transfer rates.</p><p>The output will appear similar to:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># start monitoring the initial sync (default refresh interval is 5 seconds)</span>
mongo <span class="nt">--host</span> <span class="nv">$SECONDARY_HOST</span> <span class="nt">--port</span> <span class="nv">$SECONDARY_PORT</span> <span class="nt">--quiet</span> <span class="nt">--eval</span> <span class="s2">"load('measureInitialSyncProgress.js'); measureInitialSyncProgress();"</span>
<span class="c"># to use a custom refresh interval, the value is in milliseconds, so for a 1 second refresh</span>
<span class="c"># pass 1000 to measureInitialSyncProgress as follows:</span>
<span class="c"># mongo --host $SECONDARY_HOST --port $SECONDARY_PORT --quiet --eval "load('measureInitialSyncProgress.js'); measureInitialSyncProgress(1000);"</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>Initial Sync running for 00:18:05.2 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:54.2 to go!
Initial Sync running for 00:18:10.8 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:17.9 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:22.9 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:27.9 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:33.1 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:38.4 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:49.1 to go!
Initial Sync running for 00:18:43.5 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:48.5 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:53.9 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:18:59.5 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:44.2 to go!
Initial Sync running for 00:19:05.3 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:39.2 to go!
Initial Sync running for 00:19:11.0 (remainingInitialSyncEstimatedMillis 0). Cloned 1.1 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:34.2 to go!
Initial Sync running for 00:19:16.6 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:29.2 to go!
Initial Sync running for 00:19:22.3 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:19:28.4 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:24.2 to go!
Initial Sync running for 00:19:34.5 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:19.2 to go!
Initial Sync running for 00:19:39.6 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:14.2 to go!
Initial Sync running for 00:19:45.3 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:19:54.6 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:09.2 to go!
Initial Sync running for 00:20:01.9 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:20:10.1 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (15.9 MB in past 5 second(s)) at a rate of 3.2 MB/second - 00:00:04.2 to go!
Initial Sync running for 00:20:15.7 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (No progress in past 5 second(s))
Initial Sync running for 00:20:20.7 (remainingInitialSyncEstimatedMillis 0). Cloned 1.2 GB of 1.2 GB (11.6 MB in past 5 second(s)) at a rate of 2.3 MB/second - 00:00:00.7 to go!
Node not currently performing an initial sync
</pre></table></code></div></div><p><del>Once <a href="https://jira.mongodb.org/browse/SERVER-53017">SERVER-53017</a> has been addressed I will update this script so that the <code class="language-plaintext highlighter-rouge">remainingInitialSyncEstimatedMillis</code> values can be used consistently.</del></p><p><strong>Update 2021-01-26</strong>: <a href="https://jira.mongodb.org/browse/SERVER-53017">SERVER-53017</a> was addressed and the script has been modified to use the <code class="language-plaintext highlighter-rouge">remainingInitialSyncEstimatedMillis</code> value directly!</p><noscript><pre>/*
* measureInitialSyncProgress
* @author Alex Bevilacqua &lt;alex@alexbevi.com&gt;
* @updated 2021-02-23
*
* Can be run against a MongoDB 4.2.12+ mongod that is in STARTUP2 (intitial sync) state to gain some
* insight into how the sync is progressing based on the improvements introduced with SERVER-47863.
* For versions of MongoDB &lt; 4.2.12, see https://www.alexbevi.com/blog/2020/02/13/mongodb-initial-sync-progress-monitoring
*
* usage:
*   mongo --quiet --eval &quot;load(&#39;measureInitialSyncProgress.js&#39;); measureInitialSyncProgress();&quot;
*   // pass a value in milliseconds to measureInitialSyncProgress to override the refresh interval
*   // default: 5000 (5 seconds)
*   mongo --quiet --eval &quot;load(&#39;measureInitialSyncProgress.js&#39;); measureInitialSyncProgress(1000);&quot;
*/
function msToTime(duration) {
  var milliseconds = parseInt((duration % 1000) / 100),
    seconds = Math.floor((duration / 1000) % 60),
    minutes = Math.floor((duration / (1000 * 60)) % 60),
    hours = Math.floor((duration / (1000 * 60 * 60)) % 24);

  hours = (hours &lt; 10) ? &quot;0&quot; + hours : hours;
  minutes = (minutes &lt; 10) ? &quot;0&quot; + minutes : minutes;
  seconds = (seconds &lt; 10) ? &quot;0&quot; + seconds : seconds;

  return hours + &quot;:&quot; + minutes + &quot;:&quot; + seconds + &quot;.&quot; + milliseconds;
}

var getReadableFileSizeString = function (fileSizeInBytes) {
  var i = -1;
  var byteUnits = [&#39; kB&#39;, &#39; MB&#39;, &#39; GB&#39;, &#39; TB&#39;, &#39;PB&#39;, &#39;EB&#39;, &#39;ZB&#39;, &#39;YB&#39;];
  do {
    fileSizeInBytes = fileSizeInBytes / 1024;
    i++;
  } while (fileSizeInBytes &gt; 1024);
  return Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];
};

function measureSyncProgress(previousResults) {
  var cmd = db.adminCommand({ replSetGetStatus: 1, initialSync: 1 });
  if (!cmd.hasOwnProperty(&quot;initialSyncStatus&quot;)) {
    print(&quot;Node not currently performing an initial sync&quot;);
    return { exit: true };
  }

  var status = cmd.initialSyncStatus;

  db.adminCommand({ replSetGetStatus: 1, initialSync: 1 }).initialSyncStatus.approxTotalBytesCopied

  var now = new Date();
  var started = status.initialSyncStart;

  var approxTotal = status.approxTotalDataSize;
  var approxCopied = status.approxTotalBytesCopied;

  var message = &quot;Cloned &quot; + getReadableFileSizeString(approxCopied) + &quot; of &quot; + getReadableFileSizeString(approxTotal) + &quot; in &quot; + msToTime(now - started);

  if (previousResults !== undefined &amp;&amp; previousResults.hasOwnProperty(&quot;refreshIntervalMS&quot;) !== null &amp;&amp; previousResults.hasOwnProperty(&quot;copied&quot;)) {
    var refreshInterval = previousResults.refreshIntervalMS / 1000;
    var intervalProgress = approxCopied - previousResults.copied;
    if (intervalProgress == 0) {
      message += &quot; (No progress in past &quot; + refreshInterval + &quot; second(s))&quot;;
    } else {
      var rate = intervalProgress / refreshInterval;
      // We no longer have to calculate remaining ourselves as SERVER-53017 has fixed remainingInitialSyncEstimatedMillis
      // var remaining = msToTime(((approxTotal - approxCopied) / rate) * 1000);
      message += &quot; (&quot; + getReadableFileSizeString(intervalProgress) + &quot; in past &quot; + refreshInterval;
      message += &quot; second(s)) at a rate of &quot; + getReadableFileSizeString(rate) + &quot;/second - &quot;;
      message += msToTime(status.remainingInitialSyncEstimatedMillis) + &quot; to go!&quot;;
    }
  }
  print(message);
  return { copied: approxCopied };
}

function measureInitialSyncProgress(refreshIntervalMS) {
  var dbver = db.version().split(&#39;-&#39;)[0];
  if (dbver &lt; &quot;4.2.12&quot;) {
    print(&quot;MongoDB 4.2.12 or greater required but found MongoDB &quot; + dbver);
    print(&quot;For previous versions see https://www.alexbevi.com/blog/2020/02/13/mongodb-initial-sync-progress-monitoring/&quot;);
    return;
  }

  if (refreshIntervalMS === undefined || refreshIntervalMS === null) {
    refreshIntervalMS = 5000;
  }

  var result = measureSyncProgress(result);
  result[&quot;refreshIntervalMS&quot;] = refreshIntervalMS;
  while (!result.exit) {
    sleep(refreshIntervalMS);
    result = measureSyncProgress(result);
    result[&quot;refreshIntervalMS&quot;] = refreshIntervalMS;
  }
}</pre></noscript> <script src="https://gist.github.com/alexbevi/fc4f59621aee4efbae2c04187dcbf2c6.js"> </script></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/mongodb/">MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/replication/" class="post-tag no-text-decoration" >replication</a> <a href="/tags/scripting/" class="post-tag no-text-decoration" >scripting</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MongoDB%205.0%20Initial%20Sync%20Progress%20Monitoring%20Improvements%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2020%2F11%2F20%2Fmongodb-5-dot-0-startup2-progress-monitoring-improvements%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MongoDB%205.0%20Initial%20Sync%20Progress%20Monitoring%20Improvements%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2020%2F11%2F20%2Fmongodb-5-dot-0-startup2-progress-monitoring-improvements%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2020%2F11%2F20%2Fmongodb-5-dot-0-startup2-progress-monitoring-improvements%2F&text=MongoDB%205.0%20Initial%20Sync%20Progress%20Monitoring%20Improvements%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2020%2F11%2F20%2Fmongodb-5-dot-0-startup2-progress-monitoring-improvements%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=MongoDB%205.0%20Initial%20Sync%20Progress%20Monitoring%20Improvements%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2020%2F11%2F20%2Fmongodb-5-dot-0-startup2-progress-monitoring-improvements%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Weibo" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/2016/02/23/just-finished-shadowrun/">Just Finished - Shadowrun</a><li class="text-truncate lh-lg"> <a href="/blog/2024/02/05/node-dot-js-driver-failing-to-connect-due-to-unsafe-legacy-renegotiation-disabled/">Node.js Driver failing to connect due to "unsafe legacy renegotiation disabled"</a><li class="text-truncate lh-lg"> <a href="/blog/2024/01/20/day-of-the-tentacle/">Maniac Mansion: Day of the Tentacle (LucasArts) - 1993</a><li class="text-truncate lh-lg"> <a href="/blog/2023/10/26/lost-in-time/">Lost in Time (Coktel Vision) - 1993</a><li class="text-truncate lh-lg"> <a href="/blog/2024/01/29/innocent-until-caught/">Innocent Until Caught (Divide By Zero) - 1993</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/snes/">snes</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/2020/02/13/mongodb-initial-sync-progress-monitoring/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1581615289" data-df="ll" > Feb 13, 2020 </time><h4 class="pt-0 my-2">MongoDB Initial Sync Progress Monitoring</h4><div class="text-muted"><p> Sometimes our replica set members fall off the oplog and the node needs to be resynced. When this happens, an Initial Sync is required, which does the following: Clones all databases except the...</p></div></div></a></article><article class="col"> <a href="/blog/2021/03/23/visualizing-a-replica-sets-sync-source-chain/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1616510861" data-df="ll" > Mar 23, 2021 </time><h4 class="pt-0 my-2">Visualizing a Replica Set's Sync Source Chain</h4><div class="text-muted"><p> A MongoDB replica set is a group of mongod processes that maintain the same data set. The PRIMARY node receives all write operations and The SECONDARY nodes replicate the PRIMARY’s oplog and apply ...</p></div></div></a></article><article class="col"> <a href="/blog/2016/02/10/identifying-failing-system-dot-js-functions-in-mongodb/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1455135476" data-df="ll" > Feb 10, 2016 </time><h4 class="pt-0 my-2">Identifying failing system.js functions in MongoDB</h4><div class="text-muted"><p> laptop(mongod-3.2.1) test&amp;gt; db.loadServerScripts() 2016-02-10T15:18:42.322-0500 E QUERY [thread1] SyntaxError: unterminated string literal : DB.prototype.loadServerScripts/&amp;lt;@src/mongo/shell...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/2020/07/15/mongodb-4-dot-4-change-streams-and-pre-image-support/" class="btn btn-outline-primary" aria-label="Older" ><p>MongoDB 4.4 Change Streams and Experimental Pre-Image 'Support'</p></a> <a href="/blog/2021/03/23/visualizing-a-replica-sets-sync-source-chain/" class="btn btn-outline-primary" aria-label="Newer" ><p>Visualizing a Replica Set's Sync Source Chain</p></a></nav><div id="disqus_thread"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/'; this.page.identifier = '/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p> © <time>2024</time> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/snes/">snes</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="/assets/lib/jquery/jquery.min.js"></script> <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script> <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script> <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/clipboard/clipboard.min.js"></script> <script src="/assets/lib/dayjs/dayjs.min.js"></script> <script src="/assets/lib/dayjs/locale/en.min.js"></script> <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-36490021-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-36490021-1'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
