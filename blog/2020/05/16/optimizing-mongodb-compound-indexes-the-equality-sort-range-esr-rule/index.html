<!doctype html>
    <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
    <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
    <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
    <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

    
      
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Optimizing MongoDB Compound Indexes - The "Equality - Sort - Range" (ESR) Rule - ALEX BEVILACQUA</title>
        <meta name="author" content="Alex Bevilacqua">
        
        <meta name="description" content="Optimizing MongoDB Compound Indexes - The "Equality - Sort - Range" (ESR) Rule May 16th, 2020 mongodb Comments Last Updated: May 16, 2020 Working in &hellip;">
        
        <meta name="viewport" content="width=device-width">
        <link rel="canonical" href="http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule">

        <link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,400italic' rel='stylesheet' type='text/css'>
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">

        
        <link href="/favicon.png" rel="icon">
        <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
        <link href="/atom.xml" rel="alternate" title="ALEX BEVILACQUA" type="application/atom+xml">
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/galleria/1.4.2/galleria.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/galleria/1.4.2/themes/classic/galleria.classic.min.js" type="text/javascript"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/galleria/1.4.2/themes/classic/galleria.classic.min.css" media="screen, projection" rel="stylesheet" type="text/css" />
<style>
  /* This rule is read by Galleria to define the gallery height: */
  #galleria{height:320px}
</style>

        <link href='/stylesheets/data-table.css' rel='stylesheet' type='text/css'>
    </head>


    <body >

        <header id="header">
    <div class="row">
    <div class="col-xs-12 col-sm-8 col-md-4">
        <a href="/" class="site-title">ALEX BEVILACQUA</a>
    </div>
    <div class="col-xs-12 col-sm-4 col-md-8">
        <nav>
    <input type="checkbox" id="toggle">
    <label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
    <ul class="menu">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/reviews">Reviews</a></li>
  <li><a href="/projects">Projects</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>

    </div>
</div>

</header>


        <div id="main-content">

            <!--[if lte IE 9]>
<div class="row upgrade-row">
    <div class="col-lg-12">
        <div class="upgrade">
            <i class="upgrade__icon fa fa-warning"></i>
            <h1 class="upgrade__title h6">Ohnoes!</h1>
            <p class="upgrade__text">
                Unfortunately, certain parts of this site may not display correctly in your version of Internet Explorer!<br>
                If possible, you should consider <a href="http://browsehappy.com/">upgrading your browser</a>.
            </p>
        </div>
    </div>
</div>
<!-- <![endif]-->


            

            <div class="row top-xs center-sm center-md center-lg site-wrapper">
                
                <div class="col-xs-12 col-sm-10 col-md-8 col-lg-8">
                
                    <article class="article article--single">
    <header class="article__header">
    
        <h1 class="article__title">Optimizing MongoDB Compound Indexes - The "Equality - Sort - Range" (ESR) Rule</h1>
    

    
        <div class="article__meta clearfix">
            






    <time class="article__date pull-left" datetime="2020-05-16T07:35:11-04:00" pubdate><i class="fa fa-calendar"></i> May 16th, 2020</time>




            

    <div class="article__tags pull-left">
        <i class="fa fa-tags"></i>
        <ul class="unstyled">
        

            
                <li><a class='category' href='/blog/categories/mongodb/'>mongodb</a></li>
            
        
        </ul>
    </div>


            
                <a class="pull-right" href="#disqus_thread">
                    Comments <i class="fa fa-comment"></i>
                </a>
            
        </div>
    
</header>




    <p class="clearfix"><small class="pull-right"><em>Last Updated: May 16, 2020</em></small></p>
    <p>Working in Technical Services at MongoDB I find that time and again customers need assistance understanding why the operations they&rsquo;ve created <a href="https://docs.mongodb.com/manual/indexes/">indexes</a> for may not be performing optimally. When providing supplementary documentation, the go-to article is <a href="https://emptysqua.re/blog/optimizing-mongodb-compound-indexes/">&ldquo;Optimizing MongoDB Compound Indexes&rdquo;</a> by MongoDB&rsquo;s <a href="https://emptysqua.re/blog/about/">A. Jesse Jiryu Davis</a>, however we do not have a formal public reference yet though <em><a href="https://jira.mongodb.org/browse/DOCS-11790">[DOCS-11790] Adding Equality-Sort-Range info to index documentation</a></em> exists to track this effort.</p>

<p>I&rsquo;ve presented this topic now at <a href="https://mongodblocaltoronto2019.sched.com/event/VCf3/tips-and-tricks-for-effective-indexing-mongodb">MongoDB.local Toronto 2019</a> (in <a href="https://www.slideshare.net/mongodb/mongodb-local-toronto-2019-tips-and-tricks-for-effective-indexing">&ldquo;Tips and Tricks for Effective Indexing&rdquo;</a>) and at <a href="https://mongodbworld2019.sched.com/event/OCX7/the-sights-and-smells-of-a-bad-query-mongodb">MongoDB World 2019</a> (in <a href="https://www.slideshare.net/mongodb/mongodb-world-2019-the-sights-and-smells-of-a-bad-query">&ldquo;The Sights (and Smells) of a Bad Query&rdquo;</a>). My colleague <a href="https://www.linkedin.com/in/christopher-harris-483aa149/">Chris Harris</a> has also covered this topic at MongoDB World 2019 (in <a href="https://www.slideshare.net/mongodb/mongodb-world-2019-tips-and-tricks-for-querying-and-indexing-mongodb">&ldquo;Tips and Tricks++ for Querying and Indexing MongoDB&rdquo;</a>) and again at the MongoDB.local Houston 2019, for which <a href="https://www.youtube.com/watch?v=5mBY27wVau0&amp;list=PL4RCxklHWZ9u_xtprouvxCvzq2m6q_0_E&amp;index=9&amp;t=0s">a video is available</a>.</p>

<p>Though we have Jesse&rsquo;s excellent (and still applicable and valid) article from 2012, I wanted to take this opportunity to collect some thoughts on this topic based on his work and previous presentations.</p>

<h2>The ESR &ldquo;Rule&rdquo;</h2>

<p>The ordering of index keys in a compound index is critically important, and the ESR &ldquo;Rule&rdquo; can be used as a rule of thumb to identify the optimal order <em>in most cases</em>.</p>

<p>The reason we are putting &ldquo;Rule&rdquo; in quotations is because, though the guidance is applicable in most cases, there are exceptions to be aware of. These exceptions are covered in greater detail in my in <a href="https://www.slideshare.net/mongodb/mongodb-local-toronto-2019-tips-and-tricks-for-effective-indexing">&ldquo;Tips and Tricks for Effective Indexing&rdquo;</a> presentation.</p>

<h3>The &ldquo;Rules&rdquo;</h3>

<!-- more -->


<p>(1) <em><strong>Equality</strong></em> predicates should be placed first</p>

<p>An equality predicate is any filter condition that is attempting to match a value <em>exactly</em>. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">123</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$eq</span><span class="o">:</span> <span class="mi">123</span> <span class="p">}</span> <span class="p">})</span>
</span><span class='line'><span class="nx">aggregate</span><span class="p">([</span> <span class="p">{</span> <span class="nx">$match</span><span class="o">:</span><span class="p">{</span> <span class="s2">&quot;x.y&quot;</span><span class="o">:</span> <span class="mi">123</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>These filters will be tightly bound when seen in the indexBounds of an <a href="https://docs.mongodb.com/manual/reference/explain-results/#explain-output">Explain Plan</a>:</p>

<p>&ldquo;indexBounds&rdquo; : {
    &ldquo;x&rdquo; : [
        &ldquo;[123.0, 123.0]&rdquo;
    ]
}</p>

<p>Note that <em>multiple equality predicates <strong>do not</strong> have to be ordered from most selective to least selective</em>. This guidance has been provided in the past however it is erroneous due to the nature of B-Tree indexes and how in leaf pages, a B-Tree will store combinations of all field’s values. As such, <em>there is exactly the same number of combinations regardless of key order</em>.</p>

<p>(2) <em><strong>Sort</strong></em> predicates follow <em>Equality</em> predicates
Sort predicates represent the entire requested sort for the operation and determine the ordering of results. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">b</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">a</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">aggregate</span><span class="p">([</span> <span class="p">{</span> <span class="nx">$sort</span><span class="o">:</span> <span class="p">{</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span> <span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>A sort predicate will be <em>unbounded</em> as it requires the entire key range to be scanned to satisfy the sort requirements:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;b&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;[MaxKey, MinKey]&quot;</span>
</span><span class='line'>    <span class="p">],</span>
</span><span class='line'>    <span class="s2">&quot;a&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>(3) <em><strong>Range</strong></em> predicates follow <em>Equality</em> and <em>Sort</em> predicates</p>

<p>Range predicates are filters that may scan multiple keys as they <em>are not</em> testing for an exact match. For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">z</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gte</span><span class="o">:</span> <span class="mi">5</span><span class="p">}</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">z</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$lt</span><span class="o">:</span> <span class="mi">10</span> <span class="p">}</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">z</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$ne</span><span class="o">:</span> <span class="kc">null</span> <span class="p">}</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The range predicates will be <em>loosely bounded</em> as a subset of the key range will need to be scanned to satisfy the filter requirements:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;z&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;[5.0, inf.0]&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;z&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;[-inf.0, 10.0)&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;z&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;[MinKey, undefined)&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;(null, MaxKey]&quot;</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>These three tenets of the &ldquo;rule&rdquo; have to do with how a query will traverse an index to identify the keys that match the query’s filter and sort criteria.</p>

<h3>Setup</h3>

<p>For the duration of this section we’ll be working with the following data to help illustrate the various guiding principles:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span> <span class="err">name:</span> <span class="nt">&quot;Shakir&quot;</span><span class="p">,</span> <span class="err">location:</span> <span class="nt">&quot;Ottawa&quot;</span><span class="p">,</span>    <span class="err">region:</span> <span class="nt">&quot;AMER&quot;</span><span class="p">,</span> <span class="err">joined:</span> <span class="err">2015</span> <span class="p">}</span>
</span><span class='line'><span class="p">{</span> <span class="err">name:</span> <span class="nt">&quot;Chris&quot;</span><span class="p">,</span>  <span class="err">location:</span> <span class="nt">&quot;Austin&quot;</span><span class="p">,</span>    <span class="err">region:</span> <span class="nt">&quot;AMER&quot;</span><span class="p">,</span> <span class="err">joined:</span> <span class="err">2016</span> <span class="p">}</span>
</span><span class='line'><span class="p">{</span> <span class="err">name:</span> <span class="nt">&quot;III&quot;</span><span class="p">,</span>    <span class="err">location:</span> <span class="nt">&quot;Sydney&quot;</span><span class="p">,</span>    <span class="err">region:</span> <span class="nt">&quot;APAC&quot;</span><span class="p">,</span> <span class="err">joined:</span> <span class="err">2016</span> <span class="p">}</span>
</span><span class='line'><span class="p">{</span> <span class="err">name:</span> <span class="nt">&quot;Miguel&quot;</span><span class="p">,</span> <span class="err">location:</span> <span class="nt">&quot;Barcelona&quot;</span><span class="p">,</span> <span class="err">region:</span> <span class="nt">&quot;EMEA&quot;</span><span class="p">,</span> <span class="err">joined:</span> <span class="err">2017</span> <span class="p">}</span>
</span><span class='line'><span class="p">{</span> <span class="err">name:</span> <span class="nt">&quot;Alex&quot;</span><span class="p">,</span>   <span class="err">location:</span> <span class="nt">&quot;Toronto&quot;</span><span class="p">,</span>   <span class="err">region:</span> <span class="nt">&quot;AMER&quot;</span><span class="p">,</span> <span class="err">joined:</span> <span class="err">2018</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We will also be examining simplified (filtered) Explain Plan’s <a href="https://docs.mongodb.com/manual/reference/explain-results/#executionstats"><code>executionStats</code></a> from each operation using a variation of the following command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="p">...</span> <span class="p">}).</span><span class="nx">sort</span><span class="p">({</span> <span class="p">...</span> <span class="p">}).</span><span class="nx">explain</span><span class="p">(</span><span class="s2">&quot;executionStats&quot;</span><span class="p">).</span><span class="nx">executionStats</span>
</span></code></pre></td></tr></table></div></figure>


<h3>(E) <em>Equality</em> First</h3>

<p>When <a href="https://docs.mongodb.com/manual/tutorial/create-queries-that-ensure-selectivity/">creating queries that ensure selectivity</a>, we learn that &ldquo;selectivity&rdquo; is the ability of a query to narrow results using the index. Effective indexes are more selective and allow MongoDB to use the index for a larger portion of the work associated with fulfilling the query.</p>

<p>Equality fields should always form the prefix for the index, followed by either Sort or Range predicates. To better understand why</p>

<h3>(E → S) <em>Equality</em> before <em>Sort</em></h3>

<p>Placing sort predicates after sequential equality keys allow for the index to:
Provide a non-blocking sort.
Minimize the amount of scanning required.</p>

<p>To better understand why this is we will begin with the following example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// operation</span>
</span><span class='line'><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="s2">&quot;AMER&quot;</span> <span class="p">}).</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the <em>Sort</em> predicate first, the full key range would have to be scanned prior to the more selective equality filter being applied:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// execution stats</span>
</span><span class='line'><span class="s2">&quot;nReturned&quot;</span> <span class="o">:</span> <span class="mf">3.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalKeysExamined&quot;</span> <span class="o">:</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalDocsExamined&quot;</span> <span class="o">:</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;executionStages&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;IXSCAN&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>        <span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/esr01.png"></p>

<p>With this index, all 5 keys have to be scanned (<code>totalKeysExamined</code>) to identify the 3 matching documents (<code>nReturned</code>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// operation</span>
</span><span class='line'><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="s2">&quot;AMER&quot;</span> <span class="p">}).</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>With the <em>Equality</em> predict first, the tight bounds allow less keys to be scanned to satisfy the filter criteria:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// execution stats</span>
</span><span class='line'><span class="s2">&quot;nReturned&quot;</span> <span class="o">:</span> <span class="mf">3.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalKeysExamined&quot;</span> <span class="o">:</span> <span class="mf">3.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalDocsExamined&quot;</span> <span class="o">:</span> <span class="mf">3.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;executionStages&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;IXSCAN&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>        <span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[\&quot;AMER\&quot;, \&quot;AMER\&quot;]&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/esr02.png"></p>

<h3>(E → R) <em>Equality</em> before <em>Range</em></h3>

<p>Though <em>Range</em> predicates scan a subset of keys (unlike <em>Sort</em> predicates), they should still be placed after Equality predicates to ensure the key ordering is optimized for selectivity.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// operation</span>
</span><span class='line'><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">joined</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="s2">&quot;AMER&quot;</span><span class="p">,</span> <span class="nx">joined</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">2015</span> <span class="p">}</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Having the <em>Range</em> before the <em>Equality</em> predicate causes more keys to be scanned to identify the matching documents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// execution stats</span>
</span><span class='line'><span class="s2">&quot;nReturned&quot;</span> <span class="o">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalKeysExamined&quot;</span> <span class="o">:</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalDocsExamined&quot;</span> <span class="o">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;executionStages&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;IXSCAN&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>        <span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;joined&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;(2015.0, inf.0]&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[\&quot;AMER\&quot;, \&quot;AMER\&quot;]&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/esr03.png"></p>

<p>In this example, 4 keys had to be scanned to identify the 2 matches. Changing the order of the keys to place the Equality predicate first will reduce the amount of scanning required:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// operation</span>
</span><span class='line'><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">joined</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="s2">&quot;AMER&quot;</span><span class="p">,</span> <span class="nx">joined</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">2015</span> <span class="p">}</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// execution stats</span>
</span><span class='line'><span class="s2">&quot;nReturned&quot;</span> <span class="o">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalKeysExamined&quot;</span> <span class="o">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalDocsExamined&quot;</span> <span class="o">:</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;executionStages&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;IXSCAN&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>        <span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[\&quot;AMER\&quot;, \&quot;AMER\&quot;]&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s2">&quot;joined&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;(2015.0, inf.0]&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/esr04.png"></p>

<p>After placing the <em>Equality</em> predicate before the <em>Range</em> predicate, only the number of keys necessary to satisfy the filter criteria are scanned.</p>

<h3>(S → R) <em>Sort</em> before <em>Range</em></h3>

<p>Having a <em>Range</em> predicate before the <em>Sort</em> can result in a Blocking (In Memory) Sort being performed as the <a href="https://docs.mongodb.com/manual/tutorial/sort-results-with-indexes/">index cannot be used to satisfy the sort criteria</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// operation</span>
</span><span class='line'><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">joined</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">joined</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">2015</span> <span class="p">}</span> <span class="p">}).</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// execution stats</span>
</span><span class='line'><span class="s2">&quot;nReturned&quot;</span> <span class="o">:</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalKeysExamined&quot;</span> <span class="o">:</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalDocsExamined&quot;</span> <span class="o">:</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;executionStages&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;SORT&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>        <span class="s2">&quot;sortPattern&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="mf">1.0</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="s2">&quot;memUsage&quot;</span> <span class="o">:</span> <span class="mf">136.0</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;memLimit&quot;</span> <span class="o">:</span> <span class="mf">33554432.0</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;SORT_KEY_GENERATOR&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">...</span>
</span><span class='line'>            <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;IXSCAN&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="p">...</span>
</span><span class='line'>                <span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>                    <span class="s2">&quot;joined&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                        <span class="s2">&quot;(2015.0, inf.0]&quot;</span>
</span><span class='line'>                    <span class="p">],</span>
</span><span class='line'>                    <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                        <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>                    <span class="p">]</span>
</span><span class='line'>                <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/esr05.png"></p>

<p>In this example, the filter was able to use the index selectively to identify the 4 keys needed to satisfy the query, however the results are not known to be in order. This results in the identified keys being sorted in memory prior to be returned to the calling stage in the execution plan.</p>

<p>By moving the <em>Sort</em> predicate before the <em>Range</em> predicate however, even though more keys may need to be scanned the keys will be returned correctly ordered.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// operation</span>
</span><span class='line'><span class="nx">createIndex</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">joined</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span><span class='line'><span class="nx">find</span><span class="p">({</span> <span class="nx">joined</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">2015</span> <span class="p">}</span> <span class="p">}).</span><span class="nx">sort</span><span class="p">({</span> <span class="nx">region</span><span class="o">:</span> <span class="mi">1</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// execution stats</span>
</span><span class='line'><span class="s2">&quot;nReturned&quot;</span> <span class="o">:</span> <span class="mf">4.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalKeysExamined&quot;</span> <span class="o">:</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;totalDocsExamined&quot;</span> <span class="o">:</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span class='line'><span class="s2">&quot;executionStages&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="s2">&quot;inputStage&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;stage&quot;</span> <span class="o">:</span> <span class="s2">&quot;IXSCAN&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="p">...</span>
</span><span class='line'>        <span class="s2">&quot;indexBounds&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;region&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s2">&quot;joined&quot;</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;[MinKey, MaxKey]&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/esr06.png"></p>

<p>Though this method requires scanning additional keys the lack of a blocking sort will generally be far more efficient/performant.</p>



</article>

  <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/" data-via="alexbevi" data-counturl="http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
  </script>
  <script type="IN/Share" data-url="http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/" data-counter="right"></script>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
  <script type="text/javascript" src="//www.reddit.com/buttonlite.js?i=5"></script>
</div>



<section id="disqus">
    <h1 class="disqus__title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>


                </div>

                
                <aside class="sidebar col-xs-12 col-md-4 col-lg-4">
                    <div class="row">

    
        <section class="hire--aside col-xs-12 col-sm-10 col-md-12">
            
    



    




<div class="hire hire--available hire--vibrant">
    <a class="hire__link" href="mailto:alex@alexbevi.com?subject=New%20job%20opportunity">
        Need a developer?
    </a>
</div>


        </section>
    

    
<section class="social col-xs-12 col-sm-6 col-md-12">
    <h1>
        Follow me!
    </h1>
    <ul class="unstyled">
        
        
        
        <li><a class="facebook" href="//facebook.com/alexbevi"><i class="fa fa-facebook-square"></i> Facebook</a></li>
        <li><a class="github" href="//github.com/alexbevi"><i class="fa fa-github"></i> Github</a></li>
        <li><a class="googleplus" href="//plus.google.com/+alexbevilacqua"><i class="fa fa-google-plus-square"></i> Google+</a></li>
        
        
        <li><a class="linkedin" href="//linkedin.com/in/alexbevi"><i class="fa fa-linkedin-square"></i> LinkedIn</a></li>
        
        <li><a class="reddit" href="//reddit.com/user/alexbevi"><i class="fa fa-reddit"></i> reddit</a></li>
        <li><a class="stackoverflow" href="//stackoverflow.com/users/195509"><i class="fa fa-stack-overflow"></i> StackOverflow</a></li>
        <li><a class="twitter" href="//twitter.com/alexbevi"><i class="fa fa-twitter"></i> Twitter</a></li>
        
    </ul>
</section>



    <section id="recent-posts" class="col-xs-12 col-sm-6 col-md-12">
    <h1>Recent Posts</h1>
    <ul class="divided">
        
        <li class="post">
            <a href="/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/">Optimizing MongoDB Compound Indexes - The "Equality - Sort - Range" (ESR) Rule</a>
        </li>
        
        <li class="post">
            <a href="/blog/2020/03/30/working-around-mongodb-stitchs-max-async-work-queue-limit/">Working around MongoDB Stitch's "max async work queue" limit</a>
        </li>
        
        <li class="post">
            <a href="/blog/2020/03/15/identifying-and-reclaiming-disk-space-in-mongodb/">Identifying and Reclaiming Disk Space in MongoDB</a>
        </li>
        
        <li class="post">
            <a href="/blog/2020/02/13/mongodb-initial-sync-progress-monitoring/">MongoDB Initial Sync Progress Monitoring</a>
        </li>
        
        <li class="post">
            <a href="/blog/2020/01/26/what-is-mongodb-ftdc-aka-diagnostic-dot-data/">What is MongoDB FTDC (aka. diagnostic.data)</a>
        </li>
        
    </ul>
</section>
<section>
  <h2>Looking for Something to Read?</h1>
  <a href="http://www.packtpub.com/redmine-plugin-extension-and-development/book" target ="_blank">
    <img src="/images/8748OS_mockupcover_normal_0.jpg" alt="Redmine Plugin Extension and Development">
  </a>

  <ul>
    <li>Gain access to powerful and useful features by hooking into Redmine's underlying infrastructure</li>
    <li>Real-world examples that will help you in building cross-platform applications using Redmine</li>
    <li>Full of illustrations, tips, and tricks to facilitate the development of plugins and extensions</li>
  </ul>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6215800856413580",
            enable_page_level_ads: true
       });
  </script>
</section>

<section id="github-repos" class="col-xs-12 col-sm-6 col-md-12">
    <h1>
        GitHub Repos
        
        <small class="pull-right">
            <a class="btn" href="//github.com/alexbevi" title="@alexbevi on GitHub" target="_blank">
                <i class="fa fa-external-link"></i>
            </a>
        </small>
        
    </h1>
    <ul id="gh_repos" class="divided">
        <li class="loading">
            <i class="fa fa-spinner fa-spin"></i>
        </li>
    </ul>
</section>





<section id="twitter-timeline" class="col-xs-12 col-sm-6 col-md-12">
    <h1>
        Latest Tweets
        
        <small class="pull-right">
            <a class="btn" href="//twitter.com/alexbevi" title="@alexbevi on Twitter" target="_blank">
                <i class="fa fa-external-link"></i>
            </a>
        </small>
        
    </h1>

    <a class="twitter-timeline" data-dnt="true" href="//twitter.com/alexbevi"  data-widget-id="448022650414051328"  data-link-color="#049cdb" data-tweet-limit="" data-chrome="noheader nofooter transparent noscrollbar">Tweets by @alexbevi</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>



</div>

                </aside>
                
            </div>
        </div>

        

    
    




<footer class="footer">
    <div class="row middle-xs">
        
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <p class="footer__copyright">
    All content copyright Alex Bevilacqua.<br>
    Code under <a href="//github.com/coogie/oscailte/blob/master/README.md">MIT Licence</a>.
</p>

        </div>
        
        
    </div>
</footer>

        

<script type="text/javascript">
      var disqus_shortname = 'alexbevi';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/';
        var disqus_url = 'http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
<script defer src="/javascripts/octopress.js"></script>


<script>
    var _gaq=[['_setAccount','UA-36490021-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>



<script>
    var disqus_shortname = 'alexbevi';
    
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/';
        var disqus_url = 'http://www.alexbevi.com/blog/2020/05/16/optimizing-mongodb-compound-indexes-the-equality-sort-range-esr-rule/';
        var disqus_script = 'embed.js';
    
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





<script>
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'alexbevi',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
</script>
<script src="/javascripts/github.js"></script>







    </body>

</html>
