<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="MongoDB Driver Monitoring" /><meta property="og:locale" content="en" /><meta name="description" content="One of the great things about MongoDB Drivers is that they are all built around a common set of specifications. Though these specifications exist to facilitate the development of new language drivers or to consistently implement new features across drivers, being aware of them can help when it comes to troubleshooting issues." /><meta property="og:description" content="One of the great things about MongoDB Drivers is that they are all built around a common set of specifications. Though these specifications exist to facilitate the development of new language drivers or to consistently implement new features across drivers, being aware of them can help when it comes to troubleshooting issues." /><link rel="canonical" href="https://www.alexbevi.com/blog/2022/05/15/mongodb-driver-monitoring/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2022/05/15/mongodb-driver-monitoring/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:image" content=" https://www.alexbevi.com/images/mongodb-logo.png " /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-15T08:27:09-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content=" https://www.alexbevi.com/images/mongodb-logo.png " /><meta property="twitter:title" content="MongoDB Driver Monitoring" /><meta name="twitter:site" content="@alexbevi" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-05-01T06:22:30-04:00","datePublished":"2022-05-15T08:27:09-04:00","description":"One of the great things about MongoDB Drivers is that they are all built around a common set of specifications. Though these specifications exist to facilitate the development of new language drivers or to consistently implement new features across drivers, being aware of them can help when it comes to troubleshooting issues.","headline":"MongoDB Driver Monitoring","image":" https://www.alexbevi.com/images/mongodb-logo.png ","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2022/05/15/mongodb-driver-monitoring/"},"url":"https://www.alexbevi.com/blog/2022/05/15/mongodb-driver-monitoring/"}</script><title>MongoDB Driver Monitoring | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="/assets/lib/glightbox/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script defer src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script> <script defer src="/assets/lib/glightbox/glightbox.min.js"></script> <script defer src="/assets/lib/clipboard/clipboard.min.js"></script> <script defer src="/assets/lib/dayjs/dayjs.min.js"></script> <script defer src="/assets/lib/dayjs/locale/en.js"></script> <script defer src="/assets/lib/dayjs/plugin/relativeTime.js"></script> <script defer src="/assets/lib/dayjs/plugin/localizedFormat.js"></script> <script defer src="/assets/lib/tocbot/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-36490021-1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-36490021-1'); }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6215800856413580" crossorigin="anonymous"></script><meta name="google-adsense-account" content="ca-pub-6215800856413580"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src=" /./images/avatar.png " width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ALEX BEVILACQUA</a><p class="site-subtitle fst-italic mb-0">my little corner of the interwebs</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/specifications/" class="nav-link"> <i class="fa-fw fas fa-book"></i> <span>SPECIFICATIONS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer" > <i class="fab fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>MongoDB Driver Monitoring</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>MongoDB Driver Monitoring</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1652617629" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 15, 2022 </time> </span> <span> Updated <time data-ts="1746094950" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 1, 2025 </time> </span><div class="mt-3 mb-3"> <a href=" /images/mongodb-logo.png" class="popup img-link preview-img shimmer"><img src=" /images/mongodb-logo.png" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2757 words" > <em>15 min</em> read </span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">MongoDB Driver Monitoring</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">MongoDB Driver Monitoring</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>One of the great things about <a href="https://www.mongodb.com/docs/drivers/">MongoDB Drivers</a> is that they are all built around a common set of <a href="https://github.com/mongodb/specifications">specifications</a>. Though these specifications exist to facilitate the development of new language drivers or to consistently implement new features across drivers, being aware of them can help when it comes to troubleshooting issues.</p><p>One of the more prominent specifications is the <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst">Server Discovery and Monitoring</a> (SDAM), which defines a set of behaviour in the drivers for providing runtime information about server discovery and monitoring events. These events are further codified in the associated <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring-monitoring.rst">SDAM Monitoring Specification</a>.</p><p>Examples exist within the MongoDB documentation (ex: <a href="https://www.mongodb.com/docs/drivers/node/v3.6/fundamentals/monitoring/">Node.js 3.6.x</a>, <a href="https://www.mongodb.com/docs/drivers/node/v4.5/fundamentals/monitoring/">Node.js 4.5.x</a>, <a href="https://www.mongodb.com/docs/drivers/java/sync/v4.3/fundamentals/monitoring/">Java 4.3.x</a>, <a href="https://mongodb.github.io/mongo-csharp-driver/2.15/reference/driver_core/sdamevents/">C# 2.15.x</a>), however I wanted to collect as many as possible in one place.</p><p>Troubleshooting driver-level issues can be challenging, and the <a href="https://jira.mongodb.org/browse/DRIVERS-1204">DRIVERS-1204: <em>Easier debugging with standardized logging</em></a> initiative exists to improve this however for the time being instrumenting your code is the best form of introspection.</p><h2 id="nodejs"><span class="me-2">Node.js</span><a href="#nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Starting with version 2.1.10 of the Node.js driver <a href="https://mongodb.github.io/node-mongodb-native/3.6/reference/management/sdam-monitoring/">SDAM Monitoring</a> can be done by subscribing to various SDAM events. With version 3.2 and newer of the driver the <a href="https://mongodb.github.io/node-mongodb-native/3.3/reference/unified-topology/">Unified Topology Design</a> was introduced, which is why the <code class="language-plaintext highlighter-rouge">useUnifiedTopology</code> flag is enabled in the sample below.</p><p>Note that with version 4.0 of the Node.js driver all legacy topologies were removed and only the unified topology remains. For more examples see the <a href="https://www.mongodb.com/docs/drivers/node/current/fundamentals/monitoring/cluster-monitoring/">Cluster Monitoring</a> documentation.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MongoClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">uri</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">mongodb+srv://......</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MongoClient</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">useUnifiedTopology</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="c1">// For debugging commands</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">commandStarted</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here, ex: console.log('commandStarted', event)</span>
<span class="p">});</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">commandFailed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">commandSucceeded</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">serverDescriptionChanged</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="c1">// For debugging SDAM events</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">serverHeartbeatFailed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">serverOpening</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">serverClosed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">topologyOpening</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">topologyClosed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">topologyDescriptionChanged</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="c1">// For debugging CMAP events</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connectionCheckOutStarted</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connectionCheckOutFailed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connectionCheckedIn</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connectionPoolCleared</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connectionClosed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connectionPoolClosed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Will want to log the event somewhere here.</span>
<span class="p">});</span>
<span class="err">​</span>
<span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
<span class="err">​​</span>
<span class="c1">// Please modify each event listener above with the appropriate logging logic that will record the event name and result (ex: console.log('commandStarted', event)).</span>
</pre></table></code></div></div><h2 id="java"><span class="me-2">Java</span><a href="#java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The driver documentation covers <a href="https://www.mongodb.com/docs/drivers/java/sync/current/fundamentals/monitoring/">Monitoring</a> in detail, including examples such as the following:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">CommandCounter</span> <span class="kd">implements</span> <span class="nc">CommandListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">commands</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">commandSucceeded</span><span class="o">(</span><span class="kd">final</span> <span class="nc">CommandSucceededEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">commandName</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getCommandName</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">commandName</span><span class="o">)</span> <span class="o">?</span> <span class="n">commands</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">commandName</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">commands</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">commandName</span><span class="o">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">commands</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commandFailed</span><span class="o">(</span><span class="kd">final</span> <span class="nc">CommandFailedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Failed execution of command '%s' with id %s"</span><span class="o">,</span>
                <span class="n">event</span><span class="o">.</span><span class="na">getCommandName</span><span class="o">(),</span>
                <span class="n">event</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">CommandCounter</span> <span class="kd">implements</span> <span class="nc">CommandListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">commands</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;();</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">commandSucceeded</span><span class="o">(</span><span class="kd">final</span> <span class="nc">CommandSucceededEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">commandName</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getCommandName</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">commandName</span><span class="o">)</span> <span class="o">?</span> <span class="n">commands</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">commandName</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">commands</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">commandName</span><span class="o">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">commands</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">commandFailed</span><span class="o">(</span><span class="kd">final</span> <span class="nc">CommandFailedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Failed execution of command '%s' with id %s"</span><span class="o">,</span>
                <span class="n">event</span><span class="o">.</span><span class="na">getCommandName</span><span class="o">(),</span>
                <span class="n">event</span><span class="o">.</span><span class="na">getRequestId</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>My colleague Jorge has an example of this at <a href="https://github.com/jorge-imperial/MongoTopologyMonitor"><code class="language-plaintext highlighter-rouge">jorge-imperial/MongoTopologyMonitor</code></a>.</p><h2 id="go"><span class="me-2">Go</span><a href="#go" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The sample program below shows how you can use the <code class="language-plaintext highlighter-rouge">CommandMonitor</code>, <code class="language-plaintext highlighter-rouge">PoolMonitor</code> and <code class="language-plaintext highlighter-rouge">ServerMonitor</code>. The post <a href="https://deeptiman.medium.com/mongodb-cluster-monitoring-in-go-f95a1230f9f7">“MongoDB Cluster Monitoring in Go”</a> offers additional examples you may find useful.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
</pre><td class="rouge-code"><pre><span class="c">// go run poc.go 2&gt;&amp;1 | tee go_test_$(date +%s).log</span>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"encoding/json"</span>
	<span class="s">"fmt"</span>
	<span class="s">"os"</span>
	<span class="s">"strings"</span>
	<span class="s">"time"</span>

	<span class="s">"github.com/google/uuid"</span>
	<span class="s">"go.mongodb.org/mongo-driver/bson"</span>
	<span class="s">"go.mongodb.org/mongo-driver/bson/primitive"</span>
	<span class="s">"go.mongodb.org/mongo-driver/event"</span>
	<span class="s">"go.mongodb.org/mongo-driver/mongo"</span>
	<span class="s">"go.mongodb.org/mongo-driver/mongo/options"</span>
	<span class="s">"go.mongodb.org/mongo-driver/mongo/readpref"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">pp</span><span class="p">(</span><span class="n">i</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="n">s</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%T: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="kt">string</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"starting"</span><span class="p">)</span>

  <span class="c">// Your connection string here</span>
  <span class="n">uri</span> <span class="o">:=</span> <span class="s">"mongodb+srv://..."</span>
	<span class="c">//////////////////////////////</span>

  <span class="n">ctx</span> <span class="o">:=</span> <span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">()</span>
	<span class="n">command_monitor</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">event</span><span class="o">.</span><span class="n">CommandMonitor</span><span class="p">{</span>
		<span class="n">Started</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">CommandStartedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">Succeeded</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">CommandSucceededEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">Failed</span><span class="o">:</span>    <span class="k">func</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">CommandFailedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">}</span>
	<span class="n">pool_monitor</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">event</span><span class="o">.</span><span class="n">PoolMonitor</span><span class="p">{</span>
		<span class="n">Event</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">PoolEvent</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="n">strings</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">Type</span><span class="p">),</span> <span class="s">"Failed"</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">},</span>
	<span class="p">}</span>
	<span class="n">server_monitor</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">event</span><span class="o">.</span><span class="n">ServerMonitor</span><span class="p">{</span>
		<span class="n">ServerDescriptionChanged</span><span class="o">:</span>   <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">ServerDescriptionChangedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">ServerOpening</span><span class="o">:</span>              <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">ServerOpeningEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">ServerClosed</span><span class="o">:</span>               <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">ServerClosedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">TopologyDescriptionChanged</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">TopologyDescriptionChangedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">TopologyOpening</span><span class="o">:</span>            <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">TopologyOpeningEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">TopologyClosed</span><span class="o">:</span>             <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">TopologyClosedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">ServerHeartbeatStarted</span><span class="o">:</span>     <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">ServerHeartbeatStartedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">ServerHeartbeatSucceeded</span><span class="o">:</span>   <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">ServerHeartbeatSucceededEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
		<span class="n">ServerHeartbeatFailed</span><span class="o">:</span>      <span class="k">func</span><span class="p">(</span><span class="n">evt</span> <span class="o">*</span><span class="n">event</span><span class="o">.</span><span class="n">ServerHeartbeatFailedEvent</span><span class="p">)</span> <span class="p">{</span> <span class="n">pp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">}</span>

	<span class="n">client</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">mongo</span><span class="o">.</span><span class="n">NewClient</span><span class="p">(</span>
		<span class="n">options</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span><span class="o">.</span>
			<span class="n">ApplyURI</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span>
			<span class="n">SetPoolMonitor</span><span class="p">(</span><span class="n">pool_monitor</span><span class="p">)</span><span class="o">.</span>
			<span class="n">SetServerMonitor</span><span class="p">(</span><span class="n">server_monitor</span><span class="p">)</span><span class="o">.</span>
			<span class="n">SetMonitor</span><span class="p">(</span><span class="n">command_monitor</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"error creating client: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Connect</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"error connecting: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Ping</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">readpref</span><span class="o">.</span><span class="n">Primary</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"error pinging: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"connected"</span><span class="p">)</span>

	<span class="k">for</span> <span class="p">{</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>

		<span class="n">collection</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s">"test"</span><span class="p">)</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="s">"items"</span><span class="p">)</span>
		<span class="n">id</span> <span class="o">:=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">New</span><span class="p">()</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
		<span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">collection</span><span class="o">.</span><span class="n">InsertOne</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">bson</span><span class="o">.</span><span class="n">D</span><span class="p">{</span>
			<span class="p">{</span><span class="n">Key</span><span class="o">:</span> <span class="s">"uuid"</span><span class="p">,</span> <span class="n">Value</span><span class="o">:</span> <span class="n">id</span><span class="p">},</span>
		<span class="p">})</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Insert error - %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>
		<span class="n">findResult</span> <span class="o">:=</span> <span class="n">collection</span><span class="o">.</span><span class="n">FindOne</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">bson</span><span class="o">.</span><span class="n">D</span><span class="p">{</span>
			<span class="p">{</span><span class="n">Key</span><span class="o">:</span> <span class="s">"uuid"</span><span class="p">,</span> <span class="n">Value</span><span class="o">:</span> <span class="n">id</span><span class="p">},</span>
		<span class="p">})</span>

		<span class="k">if</span> <span class="n">findResult</span><span class="o">.</span><span class="n">Err</span><span class="p">()</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Find error: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>
		<span class="n">result</span> <span class="o">:=</span> <span class="k">struct</span> <span class="p">{</span>
			<span class="n">ID</span>   <span class="n">primitive</span><span class="o">.</span><span class="n">ObjectID</span> <span class="s">`bson:"_id"`</span>
			<span class="n">UUID</span> <span class="kt">string</span>             <span class="s">`bson:"uuid"`</span>
		<span class="p">}{}</span>

		<span class="n">err</span> <span class="o">=</span> <span class="n">findResult</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">result</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Error decoding: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Got the result: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">UUID</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="ruby"><span class="me-2">Ruby</span><a href="#ruby" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The <a href="https://www.mongodb.com/docs/ruby-driver/master/reference/monitoring/index.html">Ruby Driver’s Monitoring</a> documentation outlines how to create event subscribers in great detail. These are summarized in the sample application below.</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="c1"># ruby poc.rb 2&gt;&amp;1 | tee ruby_test_$(date +%s).log</span>
<span class="nb">require</span> <span class="s1">'bundler/inline'</span>
<span class="nb">require</span> <span class="s1">'securerandom'</span>
<span class="n">gemfile</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
  <span class="n">gem</span> <span class="s1">'mongo'</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">SDAMLogSubscriber</span>
  <span class="kp">include</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Loggable</span>

  <span class="k">def</span> <span class="nf">succeeded</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
    <span class="n">log_debug</span><span class="p">(</span><span class="n">format_message</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="nf">inspect</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">logger</span>
    <span class="no">Mongo</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">logger</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">format_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="nb">format</span><span class="p">(</span><span class="s2">"SDAM | %s"</span><span class="p">.</span><span class="nf">freeze</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Mongo</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">level</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">::</span><span class="no">DEBUG</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">CONNECTION_POOL</span><span class="p">,</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">CmapLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">TOPOLOGY_OPENING</span><span class="p">,</span> <span class="no">SDAMLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">SERVER_OPENING</span><span class="p">,</span> <span class="no">SDAMLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">SERVER_DESCRIPTION_CHANGED</span><span class="p">,</span> <span class="no">SDAMLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">TOPOLOGY_CHANGED</span><span class="p">,</span> <span class="no">SDAMLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">SERVER_CLOSED</span><span class="p">,</span> <span class="no">SDAMLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">Global</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="no">Mongo</span><span class="o">::</span><span class="no">Monitoring</span><span class="o">::</span><span class="no">TOPOLOGY_CLOSED</span><span class="p">,</span> <span class="no">SDAMLogSubscriber</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>

<span class="c1"># Your connection string here</span>
<span class="n">client</span> <span class="o">=</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'mongodb+srv://...'</span><span class="p">)</span>
<span class="c1">#############################</span>

<span class="kp">loop</span> <span class="k">do</span>
  <span class="nb">sleep</span> <span class="mi">2</span>
  <span class="n">collection</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="ss">:items</span><span class="p">]</span>
  <span class="nb">id</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="p">.</span><span class="nf">uuid</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="p">{</span> <span class="no">Key</span><span class="p">:</span> <span class="s2">"uuid"</span><span class="p">,</span> <span class="no">Value</span><span class="p">:</span> <span class="nb">id</span> <span class="p">}</span>
  <span class="k">begin</span>
    <span class="n">collection</span><span class="p">.</span><span class="nf">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">ex</span>
    <span class="nb">puts</span> <span class="s2">"Insert error - </span><span class="si">#{</span><span class="n">ex</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="k">begin</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">collection</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">doc</span><span class="p">).</span><span class="nf">first</span>
    <span class="nb">puts</span> <span class="s2">"Got the result: </span><span class="si">#{</span><span class="n">response</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
  <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">ex</span>
    <span class="nb">puts</span> <span class="s2">"Find error - </span><span class="si">#{</span><span class="n">ex</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><h2 id="cnet"><span class="me-2">C#/.NET</span><a href="#cnet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The C# driver allows the use of a <a href="https://mongodb.github.io/mongo-csharp-driver/2.15/apidocs/html/P_MongoDB_Driver_MongoClientSettings_SdamLogFilename.htm"><code class="language-plaintext highlighter-rouge">MongoClientSettings.SdamLogFilename</code></a> property to be set which will write most SDAM events to a log file without further configuration.</p><p>In the example below we use the <a href="https://mongodb.github.io/mongo-csharp-driver/2.15/apidocs/html/T_MongoDB_Driver_Core_Events_IEventSubscriber.htm"><code class="language-plaintext highlighter-rouge">IEventSubscriber</code></a> interface instead to build a custom event subscriber that can be used to emit event details to <code class="language-plaintext highlighter-rouge">STDOUT</code>.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">MongoDB.Bson</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MongoDB.Driver</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MongoDB.Driver.Core.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Script.Serialization</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ConsoleApp1</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">settings</span> <span class="p">=</span> <span class="n">MongoClientSettings</span><span class="p">.</span><span class="nf">FromConnectionString</span><span class="p">(</span><span class="s">"mongodb://localhost:27017/test"</span><span class="p">);</span>
            <span class="n">settings</span><span class="p">.</span><span class="n">ClusterConfigurator</span> <span class="p">=</span> <span class="n">builder</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">builder</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="k">new</span> <span class="nf">CustomEventSubscriber</span><span class="p">());</span>
            <span class="p">};</span>

            <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MongoClient</span><span class="p">(</span><span class="n">settings</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">database</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetDatabase</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">collection</span> <span class="p">=</span> <span class="n">database</span><span class="p">.</span><span class="n">GetCollection</span><span class="p">&lt;</span><span class="n">BsonDocument</span><span class="p">&gt;(</span><span class="s">"foo"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">filter</span> <span class="p">=</span> <span class="n">Builders</span><span class="p">&lt;</span><span class="n">BsonDocument</span><span class="p">&gt;.</span><span class="n">Filter</span><span class="p">.</span><span class="nf">Eq</span><span class="p">(</span><span class="s">"bar"</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="n">collection</span><span class="p">.</span><span class="nf">CountDocuments</span><span class="p">(</span><span class="n">filter</span><span class="p">);</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">output</span><span class="p">);</span> <span class="c1">// 1</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">CustomEventSubscriber</span> <span class="p">:</span> <span class="n">IEventSubscriber</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEventSubscriber</span> <span class="n">_subscriber</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">JavaScriptSerializer</span> <span class="n">_serializer</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">CustomEventSubscriber</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_subscriber</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ReflectionEventSubscriber</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="n">_serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JavaScriptSerializer</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="n">TryGetEventHandler</span><span class="p">&lt;</span><span class="n">TEvent</span><span class="p">&gt;(</span><span class="k">out</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">TEvent</span><span class="p">&gt;</span> <span class="n">handler</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_subscriber</span><span class="p">.</span><span class="nf">TryGetEventHandler</span><span class="p">(</span><span class="k">out</span> <span class="n">handler</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterAddedServerEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterAddingServerEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterClosedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterClosingEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterDescriptionChangedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: Old = </span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="n">OldDescription</span><span class="p">}</span><span class="s"> / New = </span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="n">NewDescription</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterOpenedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterOpeningEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterRemovedServerEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterRemovingServerEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterSelectedServerEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterSelectingServerEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ClusterSelectingServerFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">CommandFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionClosedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionClosingEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionCreatedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionOpenedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionOpeningEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionOpeningFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolAddedConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolAddingConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolCheckedInConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolCheckedOutConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolCheckingInConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolCheckingOutConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolCheckingOutConnectionFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolClearedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolClearingEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolClosedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolClosingEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolOpenedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolOpeningEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolRemovedConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionPoolRemovingConnectionEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//public void Handle(ConnectionReceivedMessageEvent e)</span>
        <span class="c1">//{</span>
        <span class="c1">//    Console.WriteLine($"{e.GetType().Name}: {_serializer.Serialize(e)}");</span>
        <span class="c1">//}</span>

        <span class="c1">//public void Handle(ConnectionReceivingMessageEvent e)</span>
        <span class="c1">//{</span>
        <span class="c1">//    Console.WriteLine($"{e.GetType().Name}: {_serializer.Serialize(e)}");</span>
        <span class="c1">//}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionReceivingMessageFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//public void Handle(ConnectionSendingMessagesEvent e)</span>
        <span class="c1">//{</span>
        <span class="c1">//    Console.WriteLine($"{e.GetType().Name}: {_serializer.Serialize(e)}");</span>
        <span class="c1">//}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ConnectionSendingMessagesFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//public void Handle(ConnectionSentMessagesEvent e)</span>
        <span class="c1">//{</span>
        <span class="c1">//    Console.WriteLine($"{e.GetType().Name}: {_serializer.Serialize(e)}");</span>
        <span class="c1">//}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">SdamInformationEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ServerClosedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ServerClosingEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ServerDescriptionChangedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: Old = </span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="n">OldDescription</span><span class="p">}</span><span class="s"> / New = </span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="n">NewDescription</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ServerHeartbeatFailedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="n">ConnectionId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ServerOpenedEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ServerOpeningEvent</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">_serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="c"><span class="me-2">C++</span><a href="#c" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This example requires a little more setup as the necessary versions of bot the <a href="https://www.mongodb.com/docs/drivers/c/">C Driver</a> and <a href="https://www.mongodb.com/docs/drivers/cxx/">C++ Driver</a> need to be compiled and installed.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c"># Setup environment for C/C++ drivers</span>
<span class="nb">export </span><span class="nv">WORKDIR</span><span class="o">=</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>
<span class="nb">export </span><span class="nv">CDRIVER_VERSION</span><span class="o">=</span>1.17.4
<span class="nb">export </span><span class="nv">CPPDRIVER_VERSION</span><span class="o">=</span>3.6.2
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/lib
<span class="nb">sudo </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> build-essential wget cmake git pkg-config libssl-dev libsasl2-dev
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="k">${</span><span class="nv">WORKDIR</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKDIR</span><span class="k">}</span>
wget https://github.com/mongodb/mongo-c-driver/releases/download/<span class="k">${</span><span class="nv">CDRIVER_VERSION</span><span class="k">}</span>/mongo-c-driver-<span class="k">${</span><span class="nv">CDRIVER_VERSION</span><span class="k">}</span>.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">tar </span>xzf mongo-c-driver-<span class="k">${</span><span class="nv">CDRIVER_VERSION</span><span class="k">}</span>.tar.gz
<span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKDIR</span><span class="k">}</span>/mongo-c-driver-<span class="k">${</span><span class="nv">CDRIVER_VERSION</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">mkdir </span>cmake-build <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">cd </span>cmake-build <span class="o">&amp;&amp;</span> <span class="se">\</span>
  cmake <span class="nt">-DENABLE_AUTOMATIC_INIT_AND_CLEANUP</span><span class="o">=</span>OFF .. <span class="o">&amp;&amp;</span> <span class="se">\</span>
  make <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>make <span class="nb">install
cd</span> <span class="k">${</span><span class="nv">WORKDIR</span><span class="k">}</span>
wget https://github.com/mongodb/mongo-cxx-driver/archive/r<span class="k">${</span><span class="nv">CPPDRIVER_VERSION</span><span class="k">}</span>.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">tar</span> <span class="nt">-xzf</span> r<span class="k">${</span><span class="nv">CPPDRIVER_VERSION</span><span class="k">}</span>.tar.gz
<span class="nb">cd</span> <span class="k">${</span><span class="nv">WORKDIR</span><span class="k">}</span>/mongo-cxx-driver-r<span class="k">${</span><span class="nv">CPPDRIVER_VERSION</span><span class="k">}</span>/build <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">echo</span> <span class="nv">$CPPDRIVER_VERSION</span> <span class="o">&gt;</span> VERSION_CURRENT <span class="o">&amp;&amp;</span> <span class="se">\</span>
  cmake <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release <span class="nt">-DBSONCXX_POLY_USE_BOOST</span><span class="o">=</span>1 <span class="nt">-DENABLE_UNINSTALL</span><span class="o">=</span>ON <span class="se">\</span>
  <span class="nt">-DCMAKE_INSTALL_PREFIX</span><span class="o">=</span>/usr/local <span class="nt">-DCMAKE_PREFIX_PATH</span><span class="o">=</span>/usr/local .. <span class="o">&amp;&amp;</span> <span class="se">\</span>
  <span class="nb">sudo </span>cmake <span class="nt">--build</span> <span class="nb">.</span> <span class="nt">--target</span> <span class="nb">install</span>
</pre></table></code></div></div><p>Once the environment is setup, the following sample application can be used to monitor SDAM events. Note only the <code class="language-plaintext highlighter-rouge">ServerDescriptionChanged</code> is monitored, however this list can be expanded as needed (see <a href="http://mongocxx.org/api/current/classmongocxx_1_1options_1_1apm.html"><code class="language-plaintext highlighter-rouge">mongocxx::options::apm</code> Class Reference</a> documentation for more information).</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre><td class="rouge-code"><pre><span class="c1">// save as test.cpp and compile as follows:</span>
<span class="c1">//   c++ --std=c++11 test.cpp -o test $(pkg-config --cflags --libs libmongocxx)</span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;bsoncxx/builder/stream/document.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;bsoncxx/json.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;mongocxx/client.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;mongocxx/instance.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;mongocxx/pool.hpp&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">work</span><span class="p">(</span><span class="n">mongocxx</span><span class="o">::</span><span class="n">pool</span><span class="o">&amp;</span> <span class="n">pool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="n">acquire</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">collection</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">conn</span><span class="p">)[</span><span class="s">"test"</span><span class="p">][</span><span class="s">"foo"</span><span class="p">];</span>
<span class="cm">/*
void work(const mongocxx::client&amp; conn) {
    bsoncxx::builder::stream::document document{};
    auto collection = conn["test"]["foo"];
*/</span>
    <span class="n">bsoncxx</span><span class="o">::</span><span class="n">builder</span><span class="o">::</span><span class="n">stream</span><span class="o">::</span><span class="n">document</span> <span class="n">document</span><span class="p">{};</span>
    <span class="n">document</span> <span class="o">&lt;&lt;</span> <span class="s">"foo"</span> <span class="o">&lt;&lt;</span> <span class="s">"bar"</span><span class="p">;</span>
    <span class="n">document</span> <span class="o">&lt;&lt;</span> <span class="s">"t"</span> <span class="o">&lt;&lt;</span> <span class="n">bsoncxx</span><span class="o">::</span><span class="n">types</span><span class="o">::</span><span class="n">b_date</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">());</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">//collection.insert_one(document.view());</span>
        <span class="n">bsoncxx</span><span class="o">::</span><span class="n">builder</span><span class="o">::</span><span class="n">stream</span><span class="o">::</span><span class="n">document</span> <span class="n">order</span><span class="p">{};</span>
        <span class="n">order</span> <span class="o">&lt;&lt;</span> <span class="s">"_id"</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">opts</span> <span class="o">=</span> <span class="n">mongocxx</span><span class="o">::</span><span class="n">options</span><span class="o">::</span><span class="n">find</span><span class="p">{};</span>
        <span class="n">opts</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="n">view</span><span class="p">());</span>
        <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="p">.</span><span class="n">find_one</span><span class="p">({},</span> <span class="n">opts</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Last: "</span> <span class="o">&lt;&lt;</span> <span class="n">bsoncxx</span><span class="o">::</span><span class="n">to_json</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Error: "</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">mongocxx</span><span class="o">::</span><span class="n">options</span><span class="o">::</span><span class="n">apm</span> <span class="n">apm_opts</span><span class="p">;</span>
    <span class="n">mongocxx</span><span class="o">::</span><span class="n">options</span><span class="o">::</span><span class="n">client</span> <span class="n">client_opts</span><span class="p">;</span>

    <span class="c1">// http://mongocxx.org/api/current/classmongocxx_1_1options_1_1apm.html for other options</span>
    <span class="n">apm_opts</span><span class="p">.</span><span class="n">on_server_changed</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span> <span class="n">mongocxx</span><span class="o">::</span><span class="n">events</span><span class="o">::</span><span class="n">server_changed_event</span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"ServerDescriptionChanged "</span> <span class="o">&lt;&lt;</span> <span class="n">bsoncxx</span><span class="o">::</span><span class="n">to_json</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">new_description</span><span class="p">().</span><span class="n">is_master</span><span class="p">())</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="n">client_opts</span><span class="p">.</span><span class="n">apm_opts</span><span class="p">(</span><span class="n">apm_opts</span><span class="p">);</span>
    <span class="n">mongocxx</span><span class="o">::</span><span class="n">instance</span> <span class="n">inst</span><span class="p">{};</span>

    <span class="n">mongocxx</span><span class="o">::</span><span class="n">uri</span> <span class="n">uri</span><span class="p">{</span><span class="s">"mongodb://..."</span><span class="p">};</span>

    <span class="n">mongocxx</span><span class="o">::</span><span class="n">pool</span> <span class="n">pool</span><span class="p">{</span><span class="n">uri</span><span class="p">,</span> <span class="n">client_opts</span><span class="p">};</span>
    <span class="c1">// mongocxx::client conn{uri, client_opts};</span>

    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// wait 2 seconds between loops</span>
    <span class="kt">int</span> <span class="n">milli_seconds</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="kt">time_t</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Starting. New document will be inserted every "</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" second(s)."</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">start</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">work</span><span class="p">(</span><span class="n">pool</span><span class="p">);</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Tick: "</span> <span class="o">&lt;&lt;</span> <span class="n">start</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="php"><span class="me-2">PHP</span><a href="#php" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>TODO</strong></p><ul><li>https://gist.github.com/jmikola/dfcad9bc4e512b22dbb04beed4dc0a99<li>https://www.php.net/manual/en/mongodb.tutorial.apm.php</ul><p>The goal will be to collect more examples over time and post them here. If you have anything you’d like to share that I haven’t covered, please feel free to comment below ;)</p><p>Happy Coding!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/mongodb/">MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/drivers/" class="post-tag no-text-decoration" >drivers</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F&text=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Weibo" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <a href="https://bsky.app/intent/compose?text=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Bluesky" aria-label="Bluesky"> <i class="fa-fw fa-brands fa-bluesky"></i> </a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F&title=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit"> <i class="fa-fw fa-brands fa-square-reddit"></i> </a> <a href="https://www.threads.net/intent/post?text=MongoDB%20Driver%20Monitoring%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2022%2F05%2F15%2Fmongodb-driver-monitoring%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Threads" aria-label="Threads"> <i class="fa-fw fa-brands fa-square-threads"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/2023/02/01/leisure-suit-larry-2/">Leisure Suit Larry Goes Looking for Love (in Several Wrong Places) (Sierra On-Line) - 1988</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/07/kabul-spy/">Kabul Spy (Sirius Software) - 1982</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/07/eternam/">Eternam (Infogrames) - 1992</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/08/emmanuelle/">Emmanuelle (Coktel Vision) - 1989</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/10/beneath-a-steel-sky/">Beneath a Steel Sky (Revolution Software) - 1994</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/2024/07/12/call-stack-but-make-it-async/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1720797350" data-df="ll" > Jul 12, 2024 </time><h4 class="pt-0 my-2">Call Stack, But Make It Async!</h4><div class="text-muted"><p>Written by Neal Beeken (Blog, GitHub) - Canonical URL is at medium.com In a recent release of the MongoDB Node.js driver (v6.5.0), the team completed the effort of getting all our asynchronous op...</p></div></div></a></article><article class="col"> <a href="/blog/2025/04/11/performance-profiling-mongodb-on-cloudflare-workers/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1744367035" data-df="ll" > Apr 11, 2025 </time><h4 class="pt-0 my-2">Performance Profiling MongoDB on Cloudflare Workers</h4><div class="text-muted"><p>Cloudflare recently wrote about “Your frontend, backend, and database — now in one Cloudflare Worker”, which called out that the mongodb package should now work as expected. I validated that Cloudf...</p></div></div></a></article><article class="col"> <a href="/blog/2025/03/25/cloudflare-workers-and-mongodb/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1742923302" data-df="ll" > Mar 25, 2025 </time><h4 class="pt-0 my-2">Cloudflare Workers and MongoDB</h4><div class="text-muted"><p>Previously I wrote about Why Cloudflare Workers Don’t Work With MongoDB, but since then the Cloudflare team has done some great work to add support for the missing Node.js features MongoDB’s driver...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/2022/03/31/blue-force/" class="btn btn-outline-primary" aria-label="Older" ><p>Blue Force (Tsunami Games) - 1993</p></a> <a href="/blog/2022/06/26/just-finished-terranigma/" class="btn btn-outline-primary" aria-label="Newer" ><p>Just Finished - Terranigma</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2022/05/15/mongodb-driver-monitoring/'; this.page.identifier = '/blog/2022/05/15/mongodb-driver-monitoring/'; }; function addDisqus() { let disqusThread = document.createElement('div'); let paragraph = document.createElement('p'); disqusThread.id = 'disqus_thread'; paragraph.className = 'text-center text-muted small'; paragraph.innerHTML = 'Comments powered by <a href="https://disqus.com/">Disqus</a>.'; disqusThread.appendChild(paragraph); const footer = document.querySelector('footer'); footer.insertAdjacentElement("beforebegin", disqusThread); }function reloadDisqus(event) { if (event.source === window && event.data && event.data.id === Theme.ID) {if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } addDisqus(); if (Theme.switchable) { addEventListener('message', reloadDisqus); }var disqusObserver = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); disqusObserver.disconnect(); } }, { threshold: [0] } ); disqusObserver.observe(document.getElementById('disqus_thread')); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
