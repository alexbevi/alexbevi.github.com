<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="MongoDB Versioned API" /><meta name="author" content="Alex Bevilacqua" /><meta property="og:locale" content="en_US" /><meta name="description" content="The Versioned API For Drivers Specification states “When applications interact with MongoDB, both the driver and the server participate in executing operations. Therefore, when determining application compatibility with MongoDB, both the driver and the server behavior must be taken into account.”" /><meta property="og:description" content="The Versioned API For Drivers Specification states “When applications interact with MongoDB, both the driver and the server participate in executing operations. Therefore, when determining application compatibility with MongoDB, both the driver and the server behavior must be taken into account.”" /><link rel="canonical" href="https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-07T06:17:50-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="MongoDB Versioned API" /><meta name="twitter:site" content="@alexbevi" /><meta name="twitter:creator" content="@Alex Bevilacqua" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alex Bevilacqua"},"dateModified":"2021-12-29T13:12:35-05:00","datePublished":"2021-10-07T06:17:50-04:00","description":"The Versioned API For Drivers Specification states “When applications interact with MongoDB, both the driver and the server participate in executing operations. Therefore, when determining application compatibility with MongoDB, both the driver and the server behavior must be taken into account.”","headline":"MongoDB Versioned API","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/"},"url":"https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/"}</script><title>MongoDB Versioned API | ALEX BEVILACQUA</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-36490021-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-36490021-1'); }); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6215800856413580" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/galleria/1.5.7/galleria.min.js"></script><link href="//cdnjs.cloudflare.com/ajax/libs/galleria/1.5.7/themes/classic/galleria.classic.min.css" media="screen, projection" rel="stylesheet" type="text/css" /><style> /* This rule is read by Galleria to define the gallery height: */ .galleria{ width: 700px; height: 400px; background: #000 } .responsive-wrap iframe{ max-width: 100%;}</style><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/images/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ALEX BEVILACQUA</a></div><div class="site-subtitle font-italic">my little corner of the interwebs</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/alexbevi" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/alexbevi" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener"> <i class="fab fa-reddit"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> Blog </span> <span> 2021 </span> <span> 10 </span> <span> 07 </span> <span>MongoDB Versioned API</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>MongoDB Versioned API</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Oct 7, 2021, 6:17 AM -0400" > Oct 7, 2021 <i class="unloaded">2021-10-07T06:17:50-04:00</i> </span> by <span class="author"> Alex Bevilacqua </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 29, 2021, 1:12 PM -0500" > Dec 29, 2021 <i class="unloaded">2021-12-29T13:12:35-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="651 words">3 min</span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/images/mongodb-logo.png" class="preview-img" alt="MongoDB Logo"><p>The <a href="https://github.com/mongodb/specifications/blob/master/source/versioned-api/versioned-api.rst">Versioned API For Drivers Specification</a> states <em>“When applications interact with MongoDB, both the driver and the server participate in executing operations. Therefore, when determining application compatibility with MongoDB, both the driver and the server behavior must be taken into account.”</em></p><p>As MongoDB <a href="https://www.mongodb.com/blog/post/new-quarterly-releases-starting-with-mongodb-5-0">moves toward more frequent releases (a.k.a. continuous delivery)</a>, they want to enable users to take advantage of rapidly released features, without exposing applications to incompatible server changes due to automatic server upgrades. A versioned API will help accomplish that goal (see <a href="https://www.mongodb.com/developer/how-to/upgrade-fearlessly-versioned-api/">“Upgrade Fearlessly with the MongoDB Versioned API”</a>).</p><p>The Versioned API encompasses the subset of MongoDB commands that applications commonly use to read and write data, create collections and indexes, and so on. We commit to keeping these commands backward-compatible in new MongoDB versions. We can add new features (such as new command parameters, new aggregation operators, new commands, etc.) to the Versioned API, but only in backward-compatible ways.</p><h2 id="identifying-versioned-api-commands">Identifying Versioned API Commands</h2><p>From a mongo shell connected to a 5.0+ cluster the following helper function can be used to determine which commands are included in a specific API version.</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">printCommandsByAPIVersion</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">version</span> <span class="o">=</span> <span class="nx">version</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">runCommand</span><span class="p">({</span> <span class="na">listCommands</span><span class="p">:</span> <span class="mi">1</span> <span class="p">})</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">commands</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">commands</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cmd</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">commands</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">apiVersions</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="p">)</span> <span class="p">{</span>
            <span class="nx">commands</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">keys</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span> <span class="na">version</span><span class="p">:</span> <span class="nx">db</span><span class="p">.</span><span class="nx">serverBuildInfo</span><span class="p">().</span><span class="nx">version</span><span class="p">,</span> <span class="na">apiVersion</span><span class="p">:</span> <span class="nx">version</span><span class="p">,</span> <span class="na">commands</span><span class="p">:</span> <span class="nx">commands</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span> <span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This can be used to print out the commands supported by a specific API Version (only version <code class="language-plaintext highlighter-rouge">"1"</code> for now):</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">printCommandsByAPIVersion</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="api-v1-commands">API v1 Commands</h2><p><code class="language-plaintext highlighter-rouge">abortTransaction</code>, <code class="language-plaintext highlighter-rouge">aggregate</code>, <code class="language-plaintext highlighter-rouge">authenticate</code>, <code class="language-plaintext highlighter-rouge">collMod</code>, <code class="language-plaintext highlighter-rouge">commitTransaction</code>, <code class="language-plaintext highlighter-rouge">create</code>, <code class="language-plaintext highlighter-rouge">createIndexes</code>, <code class="language-plaintext highlighter-rouge">delete</code>, <code class="language-plaintext highlighter-rouge">drop</code>, <code class="language-plaintext highlighter-rouge">dropDatabase</code>, <code class="language-plaintext highlighter-rouge">dropIndexes</code>, <code class="language-plaintext highlighter-rouge">endSessions</code>, <code class="language-plaintext highlighter-rouge">explain</code>, <code class="language-plaintext highlighter-rouge">find</code>, <code class="language-plaintext highlighter-rouge">findAndModify</code>, <code class="language-plaintext highlighter-rouge">getMore</code>, <code class="language-plaintext highlighter-rouge">hello</code>, <code class="language-plaintext highlighter-rouge">insert</code>, <code class="language-plaintext highlighter-rouge">killCursors</code>, <code class="language-plaintext highlighter-rouge">listCollections</code>, <code class="language-plaintext highlighter-rouge">listDatabases</code>, <code class="language-plaintext highlighter-rouge">listIndexes</code>, <code class="language-plaintext highlighter-rouge">ping</code>, <code class="language-plaintext highlighter-rouge">refreshSessions</code>, <code class="language-plaintext highlighter-rouge">saslContinue</code>, <code class="language-plaintext highlighter-rouge">saslStart</code>, <code class="language-plaintext highlighter-rouge">update</code></p><h2 id="versioned-api-test">Versioned API Test</h2><p>The following test using the latest <code class="language-plaintext highlighter-rouge">master</code> branch of the <a href="https://github.com/mongodb/mongo-ruby-driver">Ruby Driver</a> can be used to test the behavior of an application with and without strict checking. This example sends a <a href="https://docs.mongodb.com/manual/reference/command/replSetGetStatus/"><code class="language-plaintext highlighter-rouge">replSetGetStatus</code></a> command to the server, and if the <code class="language-plaintext highlighter-rouge">strict</code> option is set shows the <code class="language-plaintext highlighter-rouge">APIStrictError</code> being raised:</p><div class="language-ruby highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1"># test.rb</span>
<span class="nb">require</span> <span class="s1">'bundler/inline'</span>
<span class="n">gemfile</span> <span class="k">do</span>
 <span class="n">source</span> <span class="s1">'https://rubygems.org'</span>
 <span class="n">gem</span> <span class="s1">'mongo'</span><span class="p">,</span> <span class="ss">github: </span><span class="s1">'mongodb/mongo-ruby-driver'</span><span class="p">,</span> <span class="ss">branch: </span><span class="s2">"master"</span>
<span class="k">end</span>

<span class="n">strict_api</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"true"</span>
<span class="c1"># connect to a MongoDB 5.0+ replica set</span>
<span class="n">client</span> <span class="o">=</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">([</span> <span class="s1">'alexs-mbp:27017'</span> <span class="p">],</span> <span class="ss">database: </span><span class="s1">'mydb'</span><span class="p">,</span> <span class="ss">replica_set: </span><span class="s1">'rs0'</span><span class="p">,</span> <span class="ss">server_api: </span><span class="p">{</span> <span class="ss">version: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">strict: </span><span class="n">strict_api</span> <span class="p">})</span>
<span class="k">begin</span>
 <span class="n">admin_client</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span>
 <span class="nb">p</span> <span class="n">admin_client</span><span class="p">.</span><span class="nf">database</span><span class="p">.</span><span class="nf">command</span><span class="p">(</span><span class="ss">replSetGetStatus: </span><span class="mi">1</span><span class="p">).</span><span class="nf">documents</span><span class="p">.</span><span class="nf">first</span>
<span class="k">rescue</span> <span class="no">Mongo</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">OperationFailure</span> <span class="o">=&gt;</span> <span class="n">ex</span>
 <span class="nb">puts</span> <span class="n">ex</span>
<span class="k">ensure</span>
 <span class="n">client</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</pre></table></code></div></div><p>The above script can be tested by passing <code class="language-plaintext highlighter-rouge">true</code>/<code class="language-plaintext highlighter-rouge">false</code> as the first argument to validate the behavior of the driver in strict mode:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ruby test.rb
<span class="o">{</span><span class="s2">"set"</span><span class="o">=&gt;</span><span class="s2">"rs0"</span>, <span class="s2">"date"</span><span class="o">=&gt;</span>2021-05-14 14:49:33 UTC, <span class="s2">"myState"</span><span class="o">=&gt;</span>1, <span class="s2">"term"</span><span class="o">=&gt;</span>7, <span class="s2">"syncSourceHost"</span><span class="o">=&gt;</span><span class="s2">""</span>, <span class="s2">"syncSourceId"</span><span class="o">=&gt;</span><span class="nt">-1</span>, <span class="s2">"heartbeatIntervalMillis"</span><span class="o">=&gt;</span>2000, <span class="s2">"majorityVoteCount"</span><span class="o">=&gt;</span>1, <span class="s2">"writeMajorityCount"</span><span class="o">=&gt;</span>1, <span class="s2">"votingMembersCount"</span><span class="o">=&gt;</span>1, <span class="s2">"writableVotingMembersCount"</span><span class="o">=&gt;</span>1, <span class="s2">"optimes"</span><span class="o">=&gt;{</span><span class="s2">"lastCommittedOpTime"</span><span class="o">=&gt;{</span><span class="s2">"ts"</span><span class="o">=&gt;</span><span class="c">#&lt;BSON::Timestamp:0x00007fb303a1dc78 @seconds=1621003767, @increment=1&gt;, "t"=&gt;7}, "lastCommittedWallTime"=&gt;2021-05-14 14:49:27 UTC, "readConcernMajorityOpTime"=&gt;{"ts"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1d9d0 @seconds=1621003767, @increment=1&gt;, "t"=&gt;7}, "appliedOpTime"=&gt;{"ts"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1d868 @seconds=1621003767, @increment=1&gt;, "t"=&gt;7}, "durableOpTime"=&gt;{"ts"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1d700 @seconds=1621003767, @increment=1&gt;, "t"=&gt;7}, "lastAppliedWallTime"=&gt;2021-05-14 14:49:27 UTC, "lastDurableWallTime"=&gt;2021-05-14 14:49:27 UTC}, "lastStableRecoveryTimestamp"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1d340 @seconds=1621003737, @increment=1&gt;, "electionCandidateMetrics"=&gt;{"lastElectionReason"=&gt;"electionTimeout", "lastElectionDate"=&gt;2021-05-14 14:27:57 UTC, "electionTerm"=&gt;7, "lastCommittedOpTimeAtElection"=&gt;{"ts"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1cfa8 @seconds=0, @increment=0&gt;, "t"=&gt;-1}, "lastSeenOpTimeAtElection"=&gt;{"ts"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1ce40 @seconds=1620999663, @increment=1&gt;, "t"=&gt;6}, "numVotesNeeded"=&gt;1, "priorityAtElection"=&gt;1.0, "electionTimeoutMillis"=&gt;10000, "newTermStartDate"=&gt;2021-05-14 14:27:57 UTC, "wMajorityWriteAvailabilityDate"=&gt;2021-05-14 14:27:57 UTC}, "members"=&gt;[{"_id"=&gt;0, "name"=&gt;"Alexs-MBP:27017", "health"=&gt;1.0, "state"=&gt;1, "stateStr"=&gt;"PRIMARY", "uptime"=&gt;1300, "optime"=&gt;{"ts"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1c6c0 @seconds=1621003767, @increment=1&gt;, "t"=&gt;7}, "optimeDate"=&gt;2021-05-14 14:49:27 UTC, "syncSourceHost"=&gt;"", "syncSourceId"=&gt;-1, "infoMessage"=&gt;"", "electionTime"=&gt;#&lt;BSON::Timestamp:0x00007fb303a1c378 @seconds=1621002477, @increment=1&gt;, "electionDate"=&gt;2021-05-14 14:27:57 UTC, "configVersion"=&gt;1, "configTerm"=&gt;7, "self"=&gt;true, "lastHeartbeatMessage"=&gt;""}], "ok"=&gt;1.0, "$clusterTime"=&gt;{"clusterTime"=&gt;#&lt;BSON::Timestamp:0x00007fb3049dff30 @seconds=1621003767, @increment=1&gt;, "signature"=&gt;{"hash"=&gt;&lt;BSON::Binary:0x70203426668280 type=generic data=0x0000000000000000...&gt;, "keyId"=&gt;0}}, "operationTime"=&gt;#&lt;BSON::Timestamp:0x00007fb3049dfd00 @seconds=1621003767, @increment=1&gt;}</span>

<span class="nv">$ </span>ruby test.rb <span class="nb">true</span>
<span class="o">[</span>323:APIStrictError]: Provided apiStrict:true, but the <span class="nb">command </span>replSetGetStatus is not <span class="k">in </span>API Version 1 <span class="o">(</span>on alexs-mbp:27017<span class="o">)</span>
</pre></table></code></div></div><p>There are presently no plans or schedules to deprecate version 1, which is reinforced by the following excerpt from the internal technical design document: <em>The Versioned API frees us from this bind. We say that today’s semantics are part of the MongoDB API Version 1, and the new semantics are in Version 2. MongoDB servers will support both.</em></p><h2 id="additional-references">Additional References:</h2><ul><li><a href="https://docs.mongodb.com/manual/reference/versioned-api/">Reference Documentation</a><li><a href="https://github.com/mongodb/mongo/blob/master/src/mongo/db/VERSIONED_API_README.md">Architecture Documentation</a><li><a href="https://jira.mongodb.org/browse/DRIVERS-996">DRIVERS-996: Versioned MongoDB API for Drivers</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/mongodb/'>MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MongoDB Versioned API - ALEX BEVILACQUA&url=https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MongoDB Versioned API - ALEX BEVILACQUA&u=https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=MongoDB Versioned API - ALEX BEVILACQUA&url=https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=MongoDB Versioned API - ALEX BEVILACQUA&url=https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2022/10/06/from-engineering-to-product-management/">From Engineering to Product Management</a><li><a href="/blog/2022/09/21/bug-hunting-with-the-mongodb-haskell-community/">Bug Hunting with the MongoDB Haskell Community</a><li><a href="/blog/2022/09/15/createindex-error-values-in-v-2-index-key-pattern-cannot-be-of-type-object/">Solving a mongorestore failure due to 'Values in v:2 index key pattern cannot be of type object.'</a><li><a href="/blog/2022/09/09/performance-profiling-a-mongoid-issue-using-appprofiler/">Performance Profiling a Mongoid Issue Using AppProfiler</a><li><a href="/blog/2022/08/18/why-use-mongodb-with-ruby/">Why Use MongoDB with Ruby</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/adventure/">adventure</a> <a class="post-tag" href="/tags/redmine/">redmine</a> <a class="post-tag" href="/tags/rpg/">rpg</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/snes/">snes</a> <a class="post-tag" href="/tags/jrpg/">jrpg</a> <a class="post-tag" href="/tags/ruby/">ruby</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/replication/">replication</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2022/07/04/hello-product-management/"><div class="card-body"> <span class="timeago small" > Jul 4 <i class="unloaded">2022-07-04T11:44:20-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hello Product Management</h3><div class="text-muted small"><p> Past My MongoDB Career Journey began almost 4 years ago, and I’ve enjoyed my time as a Technical Services Engineer immensely. During my tenure as part of the organization I had the opportunity to ...</p></div></div></a></div><div class="card"> <a href="/blog/2018/08/14/hello-mongodb/"><div class="card-body"> <span class="timeago small" > Aug 14, 2018 <i class="unloaded">2018-08-14T15:31:04-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hello MongoDB</h3><div class="text-muted small"><p> As of August 13th, I am no longer a System Architect at DAC Group. I have a public post on LinkedIn that got some good traction, but to summarize it was time to move on. I’ve been a software engin...</p></div></div></a></div><div class="card"> <a href="/blog/2018/10/01/technical-services-engineering-at-mongodb/"><div class="card-body"> <span class="timeago small" > Oct 1, 2018 <i class="unloaded">2018-10-01T15:39:28-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Technical Services Engineering at MongoDB</h3><div class="text-muted small"><p> The goal of this post is to provide a first hand account of what it means to be a Technical Services Engineer at MongoDB, as well as what the journey getting to this point has looked like for me. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2021/09/24/copy-mongodb-index-definitions/" class="btn btn-outline-primary" prompt="Older"><p>Copy MongoDB Index Definitions</p></a> <a href="/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/" class="btn btn-outline-primary" prompt="Newer"><p>Ensuring a MongoDB Replica Set Member's Priority Takeover Succeeds</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Loading comments from <a href="https://disqus.com/">Disqus</a> ...</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//alexbevi.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'MongoDB Versioned API'; this.page.url = 'https://www.alexbevi.com/blog/2021/10/07/mongodb-versioned-api/'; this.page.identifier = '/blog/2021/10/07/mongodb-versioned-api/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/adventure/">adventure</a> <a class="post-tag" href="/tags/redmine/">redmine</a> <a class="post-tag" href="/tags/rpg/">rpg</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/snes/">snes</a> <a class="post-tag" href="/tags/jrpg/">jrpg</a> <a class="post-tag" href="/tags/ruby/">ruby</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/replication/">replication</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.alexbevi.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script type="text/javascript" src="/assets/js/lightbox.js"></script><link rel="stylesheet" href="/assets/css/lightbox.css">
