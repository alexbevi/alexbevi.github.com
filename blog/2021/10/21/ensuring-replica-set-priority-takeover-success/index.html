<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Ensuring a MongoDB Replica Set Member’s Priority Takeover Succeeds" /><meta property="og:locale" content="en" /><meta name="description" content="High availability implies a system has been designed for durability, redundancy, and automatic failover such that the applications supported by the system can operate continuously and without downtime for a long period of time. MongoDB replica sets support high availability when deployed according to the documented best practices." /><meta property="og:description" content="High availability implies a system has been designed for durability, redundancy, and automatic failover such that the applications supported by the system can operate continuously and without downtime for a long period of time. MongoDB replica sets support high availability when deployed according to the documented best practices." /><link rel="canonical" href="https://www.alexbevi.com/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:image" content=" https://www.alexbevi.com/images/mongodb-logo.png " /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-21T07:11:18-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content=" https://www.alexbevi.com/images/mongodb-logo.png " /><meta property="twitter:title" content="Ensuring a MongoDB Replica Set Member’s Priority Takeover Succeeds" /><meta name="twitter:site" content="@alexbevi" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-24T06:13:54-04:00","datePublished":"2021-10-21T07:11:18-04:00","description":"High availability implies a system has been designed for durability, redundancy, and automatic failover such that the applications supported by the system can operate continuously and without downtime for a long period of time. MongoDB replica sets support high availability when deployed according to the documented best practices.","headline":"Ensuring a MongoDB Replica Set Member’s Priority Takeover Succeeds","image":" https://www.alexbevi.com/images/mongodb-logo.png ","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/"},"url":"https://www.alexbevi.com/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/"}</script><title>Ensuring a MongoDB Replica Set Member's Priority Takeover Succeeds | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="/assets/lib/glightbox/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script defer src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script> <script defer src="/assets/lib/glightbox/glightbox.min.js"></script> <script defer src="/assets/lib/clipboard/clipboard.min.js"></script> <script defer src="/assets/lib/dayjs/dayjs.min.js"></script> <script defer src="/assets/lib/dayjs/locale/en.js"></script> <script defer src="/assets/lib/dayjs/plugin/relativeTime.js"></script> <script defer src="/assets/lib/dayjs/plugin/localizedFormat.js"></script> <script defer src="/assets/lib/tocbot/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-36490021-1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-36490021-1'); }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6215800856413580" crossorigin="anonymous"></script><meta name="google-adsense-account" content="ca-pub-6215800856413580"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src=" /./images/avatar.png " width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ALEX BEVILACQUA</a><p class="site-subtitle fst-italic mb-0">my little corner of the interwebs</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/specifications/" class="nav-link"> <i class="fa-fw fas fa-leaf"></i> <span>MONGODB DRIVER SPECIFICATIONS</span> </a><li class="nav-item"> <a href="/driver-compatibility-checker/" class="nav-link"> <i class="fa-fw fas fa-car"></i> <span>MONGODB DRIVER COMPATIBILITY CHECKER</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer" > <i class="fab fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Ensuring a MongoDB Replica Set Member's Priority Takeover Succeeds</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Ensuring a MongoDB Replica Set Member's Priority Takeover Succeeds</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1634814678" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 21, 2021 </time> </span> <span> Updated <time data-ts="1761300834" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 24, 2025 </time> </span><div class="mt-3 mb-3"> <a href=" /images/mongodb-logo.png" class="popup img-link preview-img shimmer"><img src=" /images/mongodb-logo.png" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2353 words" > <em>13 min</em> read </span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Ensuring a MongoDB Replica Set Member's Priority Takeover Succeeds</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Ensuring a MongoDB Replica Set Member's Priority Takeover Succeeds</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p>High availability implies a system has been designed for durability, redundancy, and automatic failover such that the applications supported by the system can operate continuously and without downtime for a long period of time. MongoDB replica sets support high availability when deployed according to the <a href="https://docs.mongodb.com/manual/administration/production-checklist-operations/#std-label-production-checklist-replication">documented best practices</a>.</p><p>The <code class="language-plaintext highlighter-rouge">priority</code> settings of replica set members affect both the timing and the outcome of <a href="https://docs.mongodb.com/manual/core/replica-set-elections/">elections</a> for primary. Higher-priority members are more likely to call elections, and are more likely to win. The MongoDB documentation outlines a procedure to <a href="https://docs.mongodb.com/manual/tutorial/force-member-to-be-primary/#force-a-member-to-be-primary-by-setting-its-priority-high">Force a Member to be Primary by Setting its Priority High</a>, which can be easily demonstrated by changing the replica set’s priorities through a <a href="https://docs.mongodb.com/manual/reference/command/replSetReconfig/"><code class="language-plaintext highlighter-rouge">replSetReconfig</code></a> command.</p><p>In this article we will demonstrate how to utilize replica set member priority to ensure a given node assumes the <a href="https://docs.mongodb.com/manual/core/replica-set-primary/">primary</a> role under ideal circumstances, as well as under load (when there is consistent replication lag).</p><h2 id="initial-setup"><span class="me-2">Initial Setup</span><a href="#initial-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># setup a PSS replica set</span>
mlaunch init <span class="nt">--replicaset</span> <span class="nt">--nodes</span> 3 <span class="nt">--binarypath</span> <span class="si">$(</span>m bin 4.2.17-ent<span class="si">)</span>
<span class="c"># using the mongo shell reconfigure the set</span>
<span class="c"># with the 3rd node having a priority of 10</span>
mongo <span class="s2">"mongodb://localhost:27017/?replicaset=replset"</span> <span class="nt">--quiet</span> <span class="se">\</span>
  <span class="nt">--eval</span> <span class="s2">"c = rs.conf(); c.members[2].priority = 10; rs.reconfig(c)"</span>
</pre></table></code></div></div><p>To setup the replica set the <a href="https://github.com/aheckmann/m"><code class="language-plaintext highlighter-rouge">m</code> version manager</a> is used along with <a href="https://github.com/rueckstiess/mtools"><code class="language-plaintext highlighter-rouge">mtools</code></a>. Once the replica set is reconfigured via the <code class="language-plaintext highlighter-rouge">mongo</code> shell, checking the logs for the <code class="language-plaintext highlighter-rouge">rs3</code> node that should now be <code class="language-plaintext highlighter-rouge">PRIMARY</code> should show the results of the priority takeover:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tail</span> <span class="nt">-n</span> 1000 data/replset/rs3/mongod.log | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"(ELECTION|REPL)"</span>
</pre></table></code></div></div><pre><code class="language-log">2021-10-06T06:50:38.730-0400 I  REPL     [replexec-2] New replica set config in use: { _id: "replset", version: 2, protocolVersion: 1, writeConcernMajorityJournalDefault: true, members: [ { _id: 0, host: "localhost:27017", arbiterOnly: false, buildIndexes: true, hidden: false, priority: 1.0, tags: {}, slaveDelay: 0, votes: 1 }, { _id: 1, host: "localhost:27018", arbiterOnly: false, buildIndexes: true, hidden: false, priority: 1.0, tags: {}, slaveDelay: 0, votes: 1 }, { _id: 2, host: "localhost:27019", arbiterOnly: false, buildIndexes: true, hidden: false, priority: 10.0, tags: {}, slaveDelay: 0, votes: 1 } ], settings: { chainingAllowed: true, heartbeatIntervalMillis: 2000, heartbeatTimeoutSecs: 10, electionTimeoutMillis: 10000, catchUpTimeoutMillis: -1, catchUpTakeoverDelayMillis: 30000, getLastErrorModes: {}, getLastErrorDefaults: { w: 1, wtimeout: 0 }, replicaSetId: ObjectId('615d7f403cd84ab3e708fdea') } }
2021-10-06T06:50:38.730-0400 I  REPL     [replexec-2] This node is localhost:27019 in the config
2021-10-06T06:50:38.737-0400 I  ELECTION [replexec-3] Scheduling priority takeover at 2021-10-06T06:50:48.909-0400
2021-10-06T06:50:48.911-0400 I  REPL     [replexec-4] Canceling priority takeover callback
2021-10-06T06:50:48.911-0400 I  ELECTION [replexec-4] Starting an election for a priority takeover
2021-10-06T06:50:48.911-0400 I  ELECTION [replexec-4] conducting a dry run election to see if we could be elected. current term: 1
2021-10-06T06:50:48.912-0400 I  REPL     [replexec-4] Scheduling remote command request for vote request: RemoteCommand 183 -- target:localhost:27017 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: true, term: 1, candidateIndex: 2, configVersion: 2, lastCommittedOp: { ts: Timestamp(1633517438, 1), t: 1 } }
2021-10-06T06:50:48.912-0400 I  REPL     [replexec-4] Scheduling remote command request for vote request: RemoteCommand 184 -- target:localhost:27018 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: true, term: 1, candidateIndex: 2, configVersion: 2, lastCommittedOp: { ts: Timestamp(1633517438, 1), t: 1 } }
2021-10-06T06:50:48.912-0400 I  ELECTION [replexec-9] VoteRequester(term 1 dry run) received a yes vote from localhost:27017; response message: { term: 1, voteGranted: true, reason: "", ok: 1.0, $clusterTime: { clusterTime: Timestamp(1633517438, 1), signature: { hash: BinData(0, 0000000000000000000000000000000000000000), keyId: 0 } }, operationTime: Timestamp(1633517438, 1) }
2021-10-06T06:50:48.912-0400 I  ELECTION [replexec-5] dry election run succeeded, running for election in term 2
2021-10-06T06:50:48.941-0400 I  REPL     [replexec-5] Scheduling remote command request for vote request: RemoteCommand 185 -- target:localhost:27017 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: false, term: 2, candidateIndex: 2, configVersion: 2, lastCommittedOp: { ts: Timestamp(1633517438, 1), t: 1 } }
2021-10-06T06:50:48.942-0400 I  REPL     [replexec-5] Scheduling remote command request for vote request: RemoteCommand 186 -- target:localhost:27018 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: false, term: 2, candidateIndex: 2, configVersion: 2, lastCommittedOp: { ts: Timestamp(1633517438, 1), t: 1 } }
2021-10-06T06:50:48.957-0400 I  ELECTION [replexec-1] VoteRequester(term 2) received a yes vote from localhost:27018; response message: { term: 2, voteGranted: true, reason: "", ok: 1.0, $clusterTime: { clusterTime: Timestamp(1633517438, 1), signature: { hash: BinData(0, 0000000000000000000000000000000000000000), keyId: 0 } }, operationTime: Timestamp(1633517438, 1) }
2021-10-06T06:50:48.960-0400 I  ELECTION [replexec-8] election succeeded, assuming primary role in term 2
2021-10-06T06:50:48.961-0400 I  REPL     [replexec-8] transition to PRIMARY from SECONDARY
</code></pre><p>The above example will work every time on a local cluster with no traffic and no lag. What happens when we start applying some traffic to this cluster using a process that supports <a href="https://docs.mongodb.com/manual/core/retryable-writes/">Retryable Writes</a>?</p><h2 id="retryable-workload"><span class="me-2">Retryable Workload</span><a href="#retryable-workload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Retryable writes allow MongoDB drivers to automatically retry certain write operations a single time if they encounter network errors, or if they cannot find a healthy primary in the replica sets or sharded cluster. Based on this guarantee our assumption would be that the write workload should continue uninterrupted:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>curl <span class="nt">-s</span> https://gist.githubusercontent.com/alexbevi/955c6675337107e16d637233f865b1e3/raw/cca0390f6c30898140cc55490930b80c5cad527b/template.json | <span class="se">\</span>
  mgeneratejs <span class="nt">-n</span> 5000000 | <span class="se">\</span>
  mongoimport <span class="nt">--uri</span> <span class="s2">"mongodb://localhost:27017/test?replicaSet=replset&amp;w=majority&amp;retryWrites=true"</span> <span class="nt">--collection</span> data <span class="nt">--numInsertionWorkers</span> 1 <span class="nt">--drop</span>
</pre></table></code></div></div><p>The <a href="https://docs.mongodb.com/database-tools/mongoimport/"><code class="language-plaintext highlighter-rouge">mongoimport</code></a> command, along with <a href="https://github.com/rueckstiess/mgeneratejs"><code class="language-plaintext highlighter-rouge">mgeneratejs</code></a> are used to generate data and write the results to the <code class="language-plaintext highlighter-rouge">test.data</code> namespace. Note the version of <code class="language-plaintext highlighter-rouge">mongoimport</code> used is &gt; 100.2.1 as this ensures retryable writes are supported (per <a href="https://jira.mongodb.org/browse/TOOLS-2745">TOOLS-2745</a>).</p><p>Assuming the retryable writes guarantee is accurate, performing another <code class="language-plaintext highlighter-rouge">replSetReconfig</code> to shift the highest priority to another node should allow the election to occur without interrupting the <code class="language-plaintext highlighter-rouge">mongoimport</code> workload.</p><p><a href=" /images/priority-takeover-001.png" class="popup img-link shimmer"><img src=" /images/priority-takeover-001.png" alt="" loading="lazy"></a></p><p>Using <a href="https://github.com/tmux/tmux/wiki"><code class="language-plaintext highlighter-rouge">tmux</code></a> to manage multiple terminals (as seen in the screenshot above), the <code class="language-plaintext highlighter-rouge">mongoimport</code> (left panel) continues to import data while the election is triggered and completes (per the logs of the new <code class="language-plaintext highlighter-rouge">PRIMARY</code> in the right panel).</p><h2 id="retryable-workload-with-an-oplog-delay"><span class="me-2">Retryable Workload with an Oplog Delay</span><a href="#retryable-workload-with-an-oplog-delay" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In the above example the <code class="language-plaintext highlighter-rouge">mongoimport</code> workload was able to successfully continue with retryable writes enabled. Retryable writes are not a requirement in this scenario however (per the <a href="https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.rst#determining-retryable-errors">Retryable Writes Specification</a>) having this feature enabled will ensure server errors such as <code class="language-plaintext highlighter-rouge">NotWritablePrimary</code>, <code class="language-plaintext highlighter-rouge">NotPrimaryNoSecondaryOk</code>, <code class="language-plaintext highlighter-rouge">NotPrimaryOrSecondary</code>, <code class="language-plaintext highlighter-rouge">PrimarySteppedDown</code> will be retried.</p><p>Next we want to run the same test but with an artificial lag introduced to the node that is expected to step up as primary due to priority.</p><h2 id="simulating-an-oplog-delay"><span class="me-2">Simulating an Oplog Delay</span><a href="#simulating-an-oplog-delay" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Replication lag is a delay between an operation on the primary and the application of that operation from the oplog to the secondary (see <a href="https://docs.mongodb.com/manual/tutorial/troubleshoot-replica-sets/#check-the-replication-lag">“Check Replication Lag”</a>). Our test above was able to easily complete a priority takeover and election as the nodes are all on the same host (<code class="language-plaintext highlighter-rouge">localhost</code>) and there should be virtually no delay between writes and replicated operations.</p><p>The following script uses the <a href="https://docs.mongodb.com/manual/reference/command/fsync/"><code class="language-plaintext highlighter-rouge">fsync</code></a> and <a href="https://docs.mongodb.com/manual/reference/command/fsyncUnlock"><code class="language-plaintext highlighter-rouge">fsyncUnlock</code></a> commands to block a target node from performing writes. By doing this in a timed fashion we can simulate replication lag on a secondary as the node cannot apply writes from the oplog while it is locked.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">// file: secondaryDelay.js</span>
<span class="c1">//</span>
<span class="c1">// the host:port of the node to connect to and lock/unlock</span>
<span class="kd">const</span> <span class="nx">NODE</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">localhost:27019</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// how long to block operations (in milliseconds)</span>
<span class="kd">const</span> <span class="nx">DELAY</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">;</span>
<span class="kd">function</span> <span class="nf">delaySecondary</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">c</span><span class="p">.</span><span class="nf">getDB</span><span class="p">(</span><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">).</span><span class="nf">fsyncLock</span><span class="p">();</span>
  <span class="nf">sleep</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
  <span class="nx">c</span><span class="p">.</span><span class="nf">getDB</span><span class="p">(</span><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">).</span><span class="nf">fsyncUnlock</span><span class="p">();</span>
  <span class="c1">// print secondary replication info to show lag</span>
  <span class="nf">print</span><span class="p">(</span><span class="nx">db</span><span class="p">.</span><span class="nf">printSecondaryReplicationInfo</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mongo</span><span class="p">(</span><span class="nx">NODE</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">delaySecondary</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">DELAY</span><span class="p">);</span>
  <span class="nf">sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>When the <code class="language-plaintext highlighter-rouge">secondaryDelay.js</code> script is run and the replica set reconfiguration is performed, the priority takeover should now fail.</p><p><a href=" /images/priority-takeover-002.png" class="popup img-link shimmer"><img src=" /images/priority-takeover-002.png" alt="" loading="lazy"></a></p><p>To simulate the failure, the following commands were running in <code class="language-plaintext highlighter-rouge">tmux</code> windows:</p><ol><li><code class="language-plaintext highlighter-rouge">mongoimport</code><li><code class="language-plaintext highlighter-rouge">mongo --quiet secondaryDelay.js</code><li><code class="language-plaintext highlighter-rouge">mongo "mongodb://localhost:27017/?replicaset=replset" --quiet --eval "c = rs.conf(); c.members[0].priority = 1; c.members[2].priority = 10; rs.reconfig(c)"</code><li><code class="language-plaintext highlighter-rouge">tail -n 1000 data/replset/rs3/mongod.log | grep -E "(ELECTION|REPL)"</code></ol><pre><code class="language-log">2021-10-21T06:53:56.388-0400 I  ELECTION [replexec-12] Scheduling priority takeover at 2021-10-21T06:54:07.210-0400
2021-10-21T06:54:07.210-0400 I  REPL     [replexec-10] Canceling priority takeover callback
2021-10-21T06:54:07.210-0400 I  ELECTION [replexec-10] Starting an election for a priority takeover
2021-10-21T06:54:07.210-0400 I  ELECTION [replexec-10] conducting a dry run election to see if we could be elected. current term: 7
2021-10-21T06:54:07.210-0400 I  REPL     [replexec-10] Scheduling remote command request for vote request: RemoteCommand 1129 -- target:localhost:27017 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: true, term: 7, candidateIndex: 2, configVersion: 9, lastCommittedOp: { ts: Timestamp(1634813644, 1000), t: 7 } }
2021-10-21T06:54:07.211-0400 I  REPL     [replexec-10] Scheduling remote command request for vote request: RemoteCommand 1130 -- target:localhost:27018 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: true, term: 7, candidateIndex: 2, configVersion: 9, lastCommittedOp: { ts: Timestamp(1634813644, 1000), t: 7 } }
2021-10-21T06:54:07.211-0400 I  ELECTION [replexec-9] VoteRequester(term 7 dry run) received a no vote from localhost:27017 with reason "candidate's data is staler than mine. candidate's last applied OpTime: { ts: Timestamp(1634813644, 1000), t: 7 }, my last applied OpTime: { ts: Timestamp(1634813645, 1000), t: 7 }"; response message: { term: 7, voteGranted: false, reason: "candidate's data is staler than mine. candidate's last applied OpTime: { ts: Timestamp(1634813644, 1000), t: 7 }, my last applied OpTime: { ts: Timest...", ok: 1.0, $clusterTime: { clusterTime: Timestamp(1634813645, 1000), signature: { hash: BinData(0, 0000000000000000000000000000000000000000), keyId: 0 } }, operationTime: Timestamp(1634813645, 1000) }
2021-10-21T06:54:07.211-0400 I  ELECTION [replexec-2] VoteRequester(term 7 dry run) received a no vote from localhost:27018 with reason "candidate's data is staler than mine. candidate's last applied OpTime: { ts: Timestamp(1634813644, 1000), t: 7 }, my last applied OpTime: { ts: Timestamp(1634813645, 1000), t: 7 }"; response message: { term: 7, voteGranted: false, reason: "candidate's data is staler than mine. candidate's last applied OpTime: { ts: Timestamp(1634813644, 1000), t: 7 }, my last applied OpTime: { ts: Timest...", ok: 1.0, $clusterTime: { clusterTime: Timestamp(1634813645, 1000), signature: { hash: BinData(0, 0000000000000000000000000000000000000000), keyId: 0 } }, operationTime: Timestamp(1634813645, 1000) }
2021-10-21T06:54:07.211-0400 I  ELECTION [replexec-2] not running for primary, we received insufficient votes
2021-10-21T06:54:07.211-0400 I  ELECTION [replexec-2] Lost dry run election
</code></pre><p>The simulation is successful if we can verify the priority takeover could not complete due to <em>“candidate’s data is staler than mine”</em> failures. This implies the node trying to run for election requested votes from other nodes, which voted “no” as the candidate node needs to catch up. Note that if the oplog of the candidate node is <strong>more than 2 seconds behind</strong>, the priority takeover will not be scheduled and a failure such as the following will be logged:</p><pre><code class="language-log">2021-10-21T06:55:18.490-0400 I  ELECTION [replexec-13] Not starting an election for a priority takeover, since we are not electable due to: Not standing for election because member is not caught up enough to the most up-to-date member to call for priority takeover - must be within 2 seconds (mask 0x80)
</code></pre><p>Note that this threshold is defined by the <a href="https://github.com/mongodb/mongo/blob/r5.0.3/src/mongo/db/repl/topology_coordinator.idl"><code class="language-plaintext highlighter-rouge">priorityTakeoverFreshnessWindowSeconds</code></a> server parameter which controls how caught up in replication a secondary with higher priority than the current primary must be before it will call for a priority takeover election.</p><h2 id="ensuring-priority-takeover-when-lagging"><span class="me-2">Ensuring Priority Takeover when Lagging</span><a href="#ensuring-priority-takeover-when-lagging" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Assuming a 1-2 second delay is consistent, the priority takeover will continually be rescheduled but the election will always fail.</p><p>This particular scenario can be overcome using a combination of <a href="https://docs.mongodb.com/manual/reference/command/replSetFreeze/"><code class="language-plaintext highlighter-rouge">replSetFreeze</code></a> and <a href="https://docs.mongodb.com/manual/reference/command/replSetStepDown/"><code class="language-plaintext highlighter-rouge">replSetStepDown</code></a> as follows.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// file: freezeAndStepdown.js</span>
<span class="c1">//</span>
<span class="kd">function</span> <span class="nf">stepDown</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">hello</span><span class="p">().</span><span class="nx">primary</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mongo</span><span class="p">(</span><span class="nx">host</span><span class="p">)</span>
  <span class="nf">printjson</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nf">adminCommand</span><span class="p">({</span> <span class="na">replSetStepDown</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="na">secondaryCatchUpPeriodSecs</span><span class="p">:</span> <span class="mi">20</span> <span class="p">}));</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">freezeNode</span><span class="p">(</span><span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Mongo</span><span class="p">(</span><span class="nx">host</span><span class="p">)</span>
  <span class="nf">print</span><span class="p">(</span><span class="dl">"</span><span class="s2">Freezing </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">host</span><span class="p">)</span>
  <span class="nx">client</span><span class="p">.</span><span class="nf">adminCommand</span><span class="p">({</span> <span class="na">replSetFreeze</span><span class="p">:</span> <span class="mi">30</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nf">freezeNode</span><span class="p">(</span><span class="dl">"</span><span class="s2">localhost:27017</span><span class="dl">"</span><span class="p">);</span>
<span class="nf">freezeNode</span><span class="p">(</span><span class="dl">"</span><span class="s2">localhost:27018</span><span class="dl">"</span><span class="p">);</span>
<span class="nf">stepDown</span><span class="p">();</span>
</pre></table></code></div></div><p>All other replica set members aside from the one we’ve given the highest priority (<code class="language-plaintext highlighter-rouge">localhost:27019</code> in our scenario) are first frozen to prevent them from seeking election for 30 seconds. The primary is then stepped down with a <code class="language-plaintext highlighter-rouge">secondaryCatchUpPeriodSecs</code> of 20 seconds set to allow eligible secondaries to catch up to the primary. As all other nodes are frozen and won’t seek election, the only remaining node which was consistently lagging will catch up and stand for election.</p><p><a href=" /images/priority-takeover-003.png" class="popup img-link shimmer"><img src=" /images/priority-takeover-003.png" alt="" loading="lazy"></a></p><p>Our previous reproduction using <code class="language-plaintext highlighter-rouge">tmux</code> is updated as follows to produce this result:</p><ol><li><code class="language-plaintext highlighter-rouge">tail -n 1000 data/replset/rs3/mongod.log | grep -E "(ELECTION|REPL)"</code><li><code class="language-plaintext highlighter-rouge">mongoimport</code><li><code class="language-plaintext highlighter-rouge">mongo --quiet secondaryDelay.js</code><li><code class="language-plaintext highlighter-rouge">mongo "mongodb://localhost:27017/?replicaset=replset" --quiet --eval "c = rs.conf(); c.members[0].priority = 1; c.members[2].priority = 10; rs.reconfig(c)"</code><li><code class="language-plaintext highlighter-rouge">mongo --quiet freezeAndStepdown.js</code></ol><p>The end result should be the priority takeover attempt resulting in a successful dry run election and subsequent election.</p><pre><code class="language-log">2021-10-21T10:30:04.892-0400 I  ELECTION [replexec-15] not running for primary, we received insufficient votes
2021-10-21T10:30:04.907-0400 I  ELECTION [replexec-15] Lost dry run election
2021-10-21T10:30:05.772-0400 I  ELECTION [replexec-20] Scheduling priority takeover at 2021-10-21T10:30:16.346-0400
2021-10-21T10:30:09.777-0400 I  REPL     [replexec-14] Member localhost:27017 is now in state SECONDARY
2021-10-21T10:30:16.346-0400 I  REPL     [replexec-24] Canceling priority takeover callback
2021-10-21T10:30:16.346-0400 I  ELECTION [replexec-24] Starting an election for a priority takeover
2021-10-21T10:30:16.346-0400 I  ELECTION [replexec-24] conducting a dry run election to see if we could be elected. current term: 14
2021-10-21T10:30:16.346-0400 I  REPL     [replexec-24] Scheduling remote command request for vote request: RemoteCommand 6065 -- target:localhost:27017 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: true, term: 14, candidateIndex: 2, configVersion: 16, lastCommittedOp: { ts: Timestamp(1634826609, 1000), t: 14 } }
2021-10-21T10:30:16.346-0400 I  REPL     [replexec-24] Scheduling remote command request for vote request: RemoteCommand 6066 -- target:localhost:27018 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: true, term: 14, candidateIndex: 2, configVersion: 16, lastCommittedOp: { ts: Timestamp(1634826609, 1000), t: 14 } }
2021-10-21T10:30:16.347-0400 I  ELECTION [replexec-23] VoteRequester(term 14 dry run) received a yes vote from localhost:27017; response message: { term: 14, voteGranted: true, reason: "", ok: 1.0, $clusterTime: { clusterTime: Timestamp(1634826609, 1000), signature: { hash: BinData(0, 0000000000000000000000000000000000000000), keyId: 0 } }, operationTime: Timestamp(1634826609, 1000) }
2021-10-21T10:30:16.347-0400 I  ELECTION [replexec-23] dry election run succeeded, running for election in term 15
2021-10-21T10:30:18.621-0400 I  REPL     [replexec-22] Scheduling remote command request for vote request: RemoteCommand 6069 -- target:localhost:27017 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: false, term: 15, candidateIndex: 2, configVersion: 16, lastCommittedOp: { ts: Timestamp(1634826609, 1000), t: 14 } }
2021-10-21T10:30:18.621-0400 I  REPL     [replexec-22] Scheduling remote command request for vote request: RemoteCommand 6070 -- target:localhost:27018 db:admin cmd:{ replSetRequestVotes: 1, setName: "replset", dryRun: false, term: 15, candidateIndex: 2, configVersion: 16, lastCommittedOp: { ts: Timestamp(1634826609, 1000), t: 14 } }
2021-10-21T10:30:18.635-0400 I  ELECTION [replexec-15] VoteRequester(term 15) received a yes vote from localhost:27017; response message: { term: 15, voteGranted: true, reason: "", ok: 1.0, $clusterTime: { clusterTime: Timestamp(1634826609, 1000), signature: { hash: BinData(0, 0000000000000000000000000000000000000000), keyId: 0 } }, operationTime: Timestamp(1634826609, 1000) }
2021-10-21T10:30:18.638-0400 I  ELECTION [replexec-23] election succeeded, assuming primary role in term 15
2021-10-21T10:30:18.638-0400 I  REPL     [replexec-23] transition to PRIMARY from SECONDARY
</code></pre><p>From the screenshots we can see that during all election attempts the <code class="language-plaintext highlighter-rouge">mongoimport</code> workload continued to operate without issue.</p><p>Did this article help you? Let me know in the comments below ;)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/mongodb/">MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/replication/" class="post-tag no-text-decoration" >replication</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F&text=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Weibo" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <a href="https://bsky.app/intent/compose?text=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Bluesky" aria-label="Bluesky"> <i class="fa-fw fa-brands fa-bluesky"></i> </a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F&title=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit"> <i class="fa-fw fa-brands fa-square-reddit"></i> </a> <a href="https://www.threads.net/intent/post?text=Ensuring%20a%20MongoDB%20Replica%20Set%20Member's%20Priority%20Takeover%20Succeeds%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2021%2F10%2F21%2Fensuring-replica-set-priority-takeover-success%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Threads" aria-label="Threads"> <i class="fa-fw fa-brands fa-square-threads"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/2023/02/18/manhunter-new-york/">Manhunter: New York (Evryware) - 1988</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/21/police-quest-2/">Police Quest II: The Vengeance (Sierra On-Line) - 1988</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/24/space-quest-2/">Space Quest II: Vohaul's Revenge (Sierra On-Line) - 1987</a><li class="text-truncate lh-lg"> <a href="/blog/2023/03/03/duckman/">Duckman: The Graphic Adventures of a Private Dick (The Illusions Gaming Company) - 1997</a><li class="text-truncate lh-lg"> <a href="/blog/2023/03/10/full-throttle/">Full Throttle (LucasArts) - 1995</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/2021/08/23/the-impact-of-retryable-writes-on-the-mongodb-oplog/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1629746289" data-df="ll" > Aug 23, 2021 </time><h4 class="pt-0 my-2">Retryable Writes, findAndModify and the impact on the MongoDB Oplog</h4><div class="text-muted"><p>When you’re monitoring your cluster using Ops Manager or MongoDB Atlas and the Replication Oplog Window is (X) drastically drops, what can you do? Having a very short operations log (oplog) window...</p></div></div></a></article><article class="col"> <a href="/blog/2021/03/23/visualizing-a-replica-sets-sync-source-chain/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1616510861" data-df="ll" > Mar 23, 2021 </time><h4 class="pt-0 my-2">Visualizing a Replica Set's Sync Source Chain</h4><div class="text-muted"><p>A MongoDB replica set is a group of mongod processes that maintain the same data set. The PRIMARY node receives all write operations and The SECONDARY nodes replicate the PRIMARY’s oplog and apply ...</p></div></div></a></article><article class="col"> <a href="/blog/2020/11/20/mongodb-5-dot-0-startup2-progress-monitoring-improvements/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1605886286" data-df="ll" > Nov 20, 2020 </time><h4 class="pt-0 my-2">MongoDB 5.0 Initial Sync Progress Monitoring Improvements</h4><div class="text-muted"><p>&lt;SHAMELESS_PLUG&gt; My previous article about initial sync progress monitoring got some attention, and as I’m a Technical Services Engineer at MongoDB, I got to provide direct feedback during t...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/2021/10/07/mongodb-versioned-api/" class="btn btn-outline-primary" aria-label="Older" ><p>MongoDB Stable API</p></a> <a href="/blog/2021/10/27/just-finished-brain-lord/" class="btn btn-outline-primary" aria-label="Newer" ><p>Just Finished - Brain Lord</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/'; this.page.identifier = '/blog/2021/10/21/ensuring-replica-set-priority-takeover-success/'; }; function addDisqus() { let disqusThread = document.createElement('div'); let paragraph = document.createElement('p'); disqusThread.id = 'disqus_thread'; paragraph.className = 'text-center text-muted small'; paragraph.innerHTML = 'Comments powered by <a href="https://disqus.com/">Disqus</a>.'; disqusThread.appendChild(paragraph); const footer = document.querySelector('footer'); footer.insertAdjacentElement("beforebegin", disqusThread); }function reloadDisqus(event) { if (event.source === window && event.data && event.data.id === Theme.ID) {if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } addDisqus(); if (Theme.switchable) { addEventListener('message', reloadDisqus); }var disqusObserver = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); disqusObserver.disconnect(); } }, { threshold: [0] } ); disqusObserver.observe(document.getElementById('disqus_thread')); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
