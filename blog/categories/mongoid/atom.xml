<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

    <title><![CDATA[Category: mongoid | ALEX BEVILACQUA]]></title>
    <link href="http://www.alexbevi.com/blog/categories/mongoid/atom.xml" rel="self"/>
    <link href="http://www.alexbevi.com/"/>
    <updated>2021-03-26T09:36:33-04:00</updated>
    <id>http://www.alexbevi.com/</id>
    <author>
        <name><![CDATA[Alex Bevilacqua]]></name>
        <email><![CDATA[alex@alexbevi.com]]></email>
      </author>
    <generator uri="http://octopress.org/">Octopress</generator>

    
    <entry>
        <title type="html"><![CDATA[Analysis and Optimization of an N+1 Scenario in Mongoid]]></title>
        <link href="http://www.alexbevi.com/blog/2021/03/26/analysis-and-optimization-of-an-n-plus-1-scenario-in-mongoid/"/>
        <updated>2021-03-26T09:16:09-04:00</updated>
        <id>http://www.alexbevi.com/blog/2021/03/26/analysis-and-optimization-of-an-n-plus-1-scenario-in-mongoid</id>
        <content type="html"><![CDATA[The `N + 1` queries problem is a common issue Rails applications face whereby iterating an array of models and accessing an association results in a sub-optimal pattern of recurring queries.

To address this Rails offers [Eager Loading Associations](https://guides.rubyonrails.org/active_record_querying.html#eager-loading-associations) and there are gems (such as [bullet](https://github.com/flyerhzm/bullet)) that can be used to detect the `N + 1` pattern in an application.

This `N + 1` problem can manifest in any [ODM or ORM](https://medium.com/spidernitt/orm-and-odm-a-brief-introduction-369046ec57eb), including when working with MongoDB and Ruby.

For the purposes of this example we have a Ruby application that is using the [Mongoid](https://docs.mongodb.com/mongoid/current/) ODM with a minimal [Document](https://docs.mongodb.com/mongoid/current/tutorials/mongoid-documents/) model that contains a single [Field](https://docs.mongodb.com/mongoid/current/tutorials/mongoid-documents/#fields) definition. The scripts to setup the cluster and seed the data are shared at the end of this article (see _Reproduction_).

<!-- MORE -->

An external process updates the underlying document in the MongoDB cluster with telemetry entries, which the Ruby application will periodically prune.

The following code represents our core logic:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># mongoid_n_plus_1.rb</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;bundler/inline&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gemfile</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;mongoid&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;mongo&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Mongoid</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">clients</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">uri</span><span class="p">:</span> <span class="s2">&quot;mongodb://localhost:27017,localhost:27018,localhost:27019/test&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Test</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="nb">String</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># return all entries from the document that aren&#39;t defined as Mongoid fields</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">entries</span>
</span><span class='line'>    <span class="kp">attr</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">clone</span>
</span><span class='line'>    <span class="kp">attr</span><span class="o">.</span><span class="n">delete_if</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">|</span> <span class="nb">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">key?</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="kp">attr</span><span class="o">.</span><span class="n">sort</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">compact!</span>
</span><span class='line'>    <span class="c1"># unset each field that doesn&#39;t belong to the Mongoid document as an</span>
</span><span class='line'>    <span class="c1"># explicitely defined field</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">unset</span> <span class="n">entry</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

Using a Ruby REPL we can require the above code and verify it's connecting to our cluster and interacting with our document:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="n">require_relative</span> <span class="s1">&#39;mongoid_n_plus_1&#39;</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="no">Test</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="c1">#&lt;Test _id: 1.0, name: &quot;Alex&quot;&gt;</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">10000</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">entries</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">15</span><span class="o">]</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[[</span><span class="s2">&quot;2021-03-25T10:30:21&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:22&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:23&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:24&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:25&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:26&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:27&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:28&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:29&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:30&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:31&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:32&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:33&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:34&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:35&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'> <span class="o">[</span><span class="s2">&quot;2021-03-25T10:30:36&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="o">.</span><span class="mi">0</span><span class="o">]]</span>
</span></code></pre></td></tr></table></div></figure>

Next let's measure our `compact!` operations:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="nb">puts</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">measure</span> <span class="p">{</span> <span class="n">t</span><span class="o">.</span><span class="n">compact!</span> <span class="p">}</span>
</span><span class='line'>  <span class="mi">17</span><span class="o">.</span><span class="mi">319826</span>   <span class="mi">1</span><span class="o">.</span><span class="mo">025</span><span class="mi">931</span>  <span class="mi">18</span><span class="o">.</span><span class="mi">345757</span> <span class="p">(</span> <span class="mi">55</span><span class="o">.</span><span class="mo">0044</span><span class="mi">95</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

As a MongoDB Technical Services engieer I have access to tools we can use to parse the cluster's `FTDC` (see ["What is MongoDB FTDC (aka. diagnostic.data)"]([previous article about initial sync progress monitoring](/blog/2020/02/13/mongodb-initial-sync-progress-monitoring/) for more info) and visualize time series performance telemetry.

<img src="/images/nplus1-1.png">

We're only modifying a single document, but it appears there are about 10K update operations issued, which is taking about a minute to completed. After reviewing the documentation for MongoDB's [`$unset`](https://docs.mongodb.com/manual/reference/operator/update/unset/) update operator it appears we can pass more than one field at a time. If this is the case, we can send a single command with a list of 10K fields as opposed to 10K commands with a single field each.

To test this we modify our `compact!` method as follow:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">compact!</span>
</span><span class='line'>    <span class="c1"># each field in the `entries` array is a [k,v] array</span>
</span><span class='line'>    <span class="c1"># map the `k` (field) values into a single array and send them all</span>
</span><span class='line'>    <span class="c1"># as a single unset command</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">unset</span> <span class="nb">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:first</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

After testing this the result confirms our theory and the performance is significantly better:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;</span> <span class="nb">puts</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">measure</span> <span class="p">{</span> <span class="n">t</span><span class="o">.</span><span class="n">compact!</span> <span class="p">}</span>
</span><span class='line'>  <span class="mi">0</span><span class="o">.</span><span class="mi">150776</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">00250</span><span class="mi">9</span>   <span class="mi">0</span><span class="o">.</span><span class="mi">153285</span> <span class="p">(</span>  <span class="mi">0</span><span class="o">.</span><span class="mi">273297</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

Reviewing the FTDC again shows only a single command was issued:

<img src="/images/nplus1-2.png">

Anytime operations are being sent to the server from within a loop there may be an opptortunity to group/batch actions in a more efficient manner. The first step to improving performance is being able to identify an opporutnity for improvement, which I hope this article helps you do.

Happy Coding!

### Reproduction

#### Setup

First, we spin up a local [replica set](https://docs.mongodb.com/manual/replication) using some open source MongoDB helper utilities (see [`m`](https://github.com/aheckmann/m) and [`mtools`](https://github.com/rueckstiess/mtools)):

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>m 4.2.13
</span><span class='line'>mlaunch init --replicaset --nodes <span class="m">3</span> --binarypath <span class="k">$(</span>m bin 4.2.13<span class="k">)</span> --host localhost --bind_ip_all
</span><span class='line'>mongo <span class="s2">&quot;mongodb://localhost:27017,localhost:27018,localhost:27019/test&quot;</span> test.js
</span></code></pre></td></tr></table></div></figure>

The JavaScript file (`test.js`) above is used to seed the collection with a single document and 10,000 telemetry entries:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// test.js</span>
</span><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">drop</span><span class="p">();</span>
</span><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span> <span class="nx">_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Alex&quot;</span> <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">update</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="nx">d</span><span class="p">.</span><span class="nx">setSeconds</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>   <span class="nx">update</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">db</span><span class="p">.</span><span class="nx">tests</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span> <span class="nx">_id</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">$set</span><span class="o">:</span> <span class="nx">update</span> <span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

From the [`mongo`](https://docs.mongodb.com/manual/mongo/) or [`mongosh`](https://docs.mongodb.com/mongodb-shell/) the result of this script can be verified:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> mongo <span class="s2">&quot;mongodb://localhost:27017,localhost:27018,localhost:27019/test&quot;</span> --quiet --eval <span class="s1">&#39;db.tests.find().pretty()&#39;</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;_id&quot;</span>: 1,
</span><span class='line'>  <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;Alex&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T10:55:23&quot;</span>: 1,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T10:55:24&quot;</span>: 2,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T10:55:25&quot;</span>: 3,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T10:55:26&quot;</span>: 4,
</span><span class='line'>  ...
</span><span class='line'>  <span class="s2">&quot;2021-03-25T13:41:59&quot;</span>: 9997,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T13:42:00&quot;</span>: 9998,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T13:42:01&quot;</span>: 9999,
</span><span class='line'>  <span class="s2">&quot;2021-03-25T13:42:02&quot;</span>: 10000
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>]]></content>
    </entry>
    
    <entry>
        <title type="html"><![CDATA[Troubleshooting a Mongoid Connection Issue]]></title>
        <link href="http://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/"/>
        <updated>2014-06-23T10:27:58-04:00</updated>
        <id>http://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue</id>
        <content type="html"><![CDATA[I've been struggling with an issue for a while now regarding Mongoid connections just freezing when the host is not on *localhost*. I've tried posting this on [stack overflow](https://stackoverflow.com/questions/24210058/mongoid-4-mongodb-2-4-freezing-issue) and [GitHub](https://github.com/mongoid/moped/issues/274), but haven't really gotten anywhere.

I'm now trying to dive into the issue using GDB directly, which I'm starting off following the [NewRelic blog post](http://blog.newrelic.com/2013/04/29/debugging-stuck-ruby-processes-what-to-do-before-you-kill-9/) about debugging hung Ruby processes.

First, once the process is frozen, I connect using:

    sudo gdb -p <pid>

and then tried to get some info from the C-level backtraces via:

    (gdb) t a a bt

This resulted in a lot of information that didn't really help me (at least not immediately):

<!--more-->

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Thread <span class="m">8</span> <span class="o">(</span>Thread 0x7f032a5e1700 <span class="o">(</span>LWP 9001<span class="o">))</span>:
</span><span class='line'><span class="c">#0  0x00007f0329c0ffbd in poll () at ../sysdeps/unix/syscall-template.S:81</span>
</span><span class='line'><span class="c">#1  0x00007f032a0d1d60 in timer_thread_sleep (gvl=0x1ed8f28) at thread_pthread.c:1381</span>
</span><span class='line'><span class="c">#2  thread_timer (p=0x1ed8f28) at thread_pthread.c:1456</span>
</span><span class='line'><span class="c">#3  0x00007f032990c182 in start_thread (arg=0x7f032a5e1700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#4  0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">7</span> <span class="o">(</span>Thread 0x7f032a4c0700 <span class="o">(</span>LWP 9002<span class="o">))</span>:
</span><span class='line'><span class="c">#0  sem_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S:85</span>
</span><span class='line'><span class="c">#1  0x00007f032495b75d in v8::internal::LinuxSemaphore::Wait() ()</span>
</span><span class='line'>   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
</span><span class='line'><span class="c">#2  0x00007f032486104c in v8::internal::RuntimeProfiler::WaitForSomeIsolateToEnterJS() ()</span>
</span><span class='line'>   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
</span><span class='line'><span class="c">#3  0x00007f032495b968 in v8::internal::SignalSender::Run() ()</span>
</span><span class='line'>   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
</span><span class='line'><span class="c">#4  0x00007f032495b86e in v8::internal::ThreadEntry(void*) ()</span>
</span><span class='line'>   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
</span><span class='line'><span class="c">#5  0x00007f032990c182 in start_thread (arg=0x7f032a4c0700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#6  0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">6</span> <span class="o">(</span>Thread 0x7f0321988700 <span class="o">(</span>LWP 9008<span class="o">))</span>:
</span><span class='line'><span class="c">#0  0x00007f0329c14c33 in select () at ../sysdeps/unix/syscall-template.S:81</span>
</span><span class='line'><span class="c">#1  0x00007f032a0d8cdb in rb_fd_select (n=&lt;optimized out&gt;, readfds=&lt;optimized out&gt;, writefds=&lt;optimized out&gt;, exceptfds=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">timeout</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at thread.c:3321
</span><span class='line'><span class="c">#2  0x00007f032a0d9139 in native_fd_select (th=&lt;optimized out&gt;, timeout=0x7f0321987550, exceptfds=0x0, writefds=0x0, readfds=0x7f0321987810, </span>
</span><span class='line'>    <span class="nv">n</span><span class="o">=</span>12<span class="o">)</span> at thread_pthread.c:1007
</span><span class='line'><span class="c">#3  do_select (timeout=0x7f0321987550, except=0x0, write=0x0, read=0x7f0321987810, n=12) at thread.c:3436</span>
</span><span class='line'><span class="c">#4  rb_thread_fd_select (max=max@entry=12, read=read@entry=0x7f0321987810, write=write@entry=0x0, except=except@entry=0x0, </span>
</span><span class='line'>    <span class="nv">timeout</span><span class="o">=</span>timeout@entry<span class="o">=</span>0x7f03219877e0<span class="o">)</span> at thread.c:3582
</span><span class='line'><span class="c">#5  0x00007f0329f96150 in select_internal (fds=0x7f0321987810, tp=0x7f03219877e0, except=&lt;optimized out&gt;, write=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nb">read</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at io.c:8232
</span><span class='line'><span class="c">#6  select_call (arg=arg@entry=139651425269744) at io.c:8302</span>
</span><span class='line'><span class="c">#7  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f0329f95e30 &lt;select_call&gt;, data1=data1@entry=139651425269744, </span>
</span><span class='line'>    <span class="nv">e_proc</span><span class="o">=</span>e_proc@entry<span class="o">=</span>0x7f0329f926a0 &lt;select_end&gt;, <span class="nv">data2</span><span class="o">=</span>data2@entry<span class="o">=</span>139651425269744<span class="o">)</span> at eval.c:850
</span><span class='line'><span class="c">#8  0x00007f0329f92810 in rb_f_select (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, obj=&lt;optimized out&gt;) at io.c:8651</span>
</span><span class='line'><span class="c">#9  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321a88f20, th=0x96c91c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#10 vm_call_cfunc (th=0x96c91c0, reg_cfp=0x7f0321a88f20, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#11 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x96c91c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#12 0x00007f032a0bb5ec in vm_exec (th=0x96c91c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#13 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x96c91c0, proc=0x96c9690, self=133280920, defined_class=117512440, argc=0, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>0x7f1b228, <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#14 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x96c91c0, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#15 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x96c91c0, stack_start=&lt;optimized out&gt;) at thread.c:535</span>
</span><span class='line'><span class="c">#16 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x96c91c0) at thread_pthread.c:803</span>
</span><span class='line'><span class="c">#17 0x00007f032990c182 in start_thread (arg=0x7f0321988700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#18 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">5</span> <span class="o">(</span>Thread 0x7f0321786700 <span class="o">(</span>LWP 9009<span class="o">))</span>:
</span><span class='line'><span class="c">#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238</span>
</span><span class='line'><span class="c">#1  0x00007f032a0d27ff in native_cond_timedwait (ts=&lt;optimized out&gt;, mutex=&lt;optimized out&gt;, cond=&lt;optimized out&gt;) at thread_pthread.c:352</span>
</span><span class='line'><span class="c">#2  native_sleep (th=0x96c9870, timeout_tv=0x7f03217857c0) at thread_pthread.c:1061</span>
</span><span class='line'><span class="c">#3  0x00007f032a0d55fa in sleep_timeval (th=0x96c9870, tv=..., spurious_check=spurious_check@entry=1) at thread.c:1046</span>
</span><span class='line'><span class="c">#4  0x00007f032a0d57ba in rb_thread_wait_for (time=...) at thread.c:1115</span>
</span><span class='line'><span class="c">#5  0x00007f0329ff27d0 in rb_f_sleep (argc=1, argv=0x7f0321787038) at process.c:4193</span>
</span><span class='line'><span class="c">#6  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321886f70, th=0x96c9870) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#7  vm_call_cfunc (th=0x96c9870, reg_cfp=0x7f0321886f70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#8  0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x96c9870, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#9  0x00007f032a0bb5ec in vm_exec (th=0x96c9870) at vm.c:1304</span>
</span><span class='line'><span class="c">#10 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x96c9870, proc=0x96c9d90, self=133279880, defined_class=117256360, argc=0, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>0x7f1afd0, <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#11 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x96c9870, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#12 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x96c9870, stack_start=&lt;optimized out&gt;) at thread.c:535</span>
</span><span class='line'><span class="c">#13 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x96c9870) at thread_pthread.c:803</span>
</span><span class='line'><span class="c">#14 0x00007f032990c182 in start_thread (arg=0x7f0321786700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#15 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">4</span> <span class="o">(</span>Thread 0x7f0321584700 <span class="o">(</span>LWP 9010<span class="o">))</span>:
</span><span class='line'><span class="c">#0  0x00007f0329c14c33 in select () at ../sysdeps/unix/syscall-template.S:81</span>
</span><span class='line'><span class="c">#1  0x00007f032a0d8cdb in rb_fd_select (n=&lt;optimized out&gt;, readfds=&lt;optimized out&gt;, writefds=&lt;optimized out&gt;, exceptfds=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">timeout</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at thread.c:3321
</span><span class='line'><span class="c">#2  0x00007f032a0d9139 in native_fd_select (th=&lt;optimized out&gt;, timeout=0x0, exceptfds=0x0, writefds=0x0, readfds=0x7f0321583810, n=11)</span>
</span><span class='line'>    at thread_pthread.c:1007
</span><span class='line'><span class="c">#3  do_select (timeout=0x0, except=0x0, write=0x0, read=0x7f0321583810, n=11) at thread.c:3436</span>
</span><span class='line'><span class="c">#4  rb_thread_fd_select (max=max@entry=11, read=read@entry=0x7f0321583810, write=write@entry=0x0, except=except@entry=0x0, </span>
</span><span class='line'>    <span class="nv">timeout</span><span class="o">=</span>timeout@entry<span class="o">=</span>0x0<span class="o">)</span> at thread.c:3582
</span><span class='line'><span class="c">#5  0x00007f0329f96150 in select_internal (fds=0x7f0321583810, tp=0x0, except=&lt;optimized out&gt;, write=&lt;optimized out&gt;, read=&lt;optimized out&gt;)</span>
</span><span class='line'>    at io.c:8232
</span><span class='line'><span class="c">#6  select_call (arg=arg@entry=139651421059056) at io.c:8302</span>
</span><span class='line'><span class="c">#7  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f0329f95e30 &lt;select_call&gt;, data1=data1@entry=139651421059056, </span>
</span><span class='line'>    <span class="nv">e_proc</span><span class="o">=</span>e_proc@entry<span class="o">=</span>0x7f0329f926a0 &lt;select_end&gt;, <span class="nv">data2</span><span class="o">=</span>data2@entry<span class="o">=</span>139651421059056<span class="o">)</span> at eval.c:850
</span><span class='line'><span class="c">#8  0x00007f0329f92810 in rb_f_select (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, obj=&lt;optimized out&gt;) at io.c:8651</span>
</span><span class='line'><span class="c">#9  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321684f20, th=0x96c9f10) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#10 vm_call_cfunc (th=0x96c9f10, reg_cfp=0x7f0321684f20, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#11 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x96c9f10, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#12 0x00007f032a0bb5ec in vm_exec (th=0x96c9f10) at vm.c:1304</span>
</span><span class='line'><span class="c">#13 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x96c9f10, proc=0x96ec480, self=133126360, defined_class=118126960, argc=0, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>0x7f1adf0, <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#14 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x96c9f10, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#15 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x96c9f10, stack_start=&lt;optimized out&gt;) at thread.c:535</span>
</span><span class='line'><span class="c">#16 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x96c9f10) at thread_pthread.c:803</span>
</span><span class='line'><span class="c">#17 0x00007f032990c182 in start_thread (arg=0x7f0321584700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#18 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">3</span> <span class="o">(</span>Thread 0x7f0321180700 <span class="o">(</span>LWP 9472<span class="o">))</span>:
</span><span class='line'><span class="c">#0  0x00007f0329c1007f in __GI_ppoll (fds=fds@entry=0x7f032117bb90, nfds=nfds@entry=1, timeout=&lt;optimized out&gt;, timeout@entry=0x0, </span>
</span><span class='line'>    <span class="nv">sigmask</span><span class="o">=</span>sigmask@entry<span class="o">=</span>0x0<span class="o">)</span> at ../sysdeps/unix/sysv/linux/ppoll.c:56
</span><span class='line'><span class="c">#1  0x00007f032a0d9b28 in rb_wait_for_single_fd (fd=fd@entry=15, events=events@entry=1, tv=tv@entry=0x0) at thread.c:3656</span>
</span><span class='line'><span class="c">#2  0x00007f032a0da044 in rb_thread_wait_fd_rw (read=1, fd=fd@entry=15) at thread.c:3495</span>
</span><span class='line'><span class="c">#3  rb_thread_wait_fd (fd=fd@entry=15) at thread.c:3506</span>
</span><span class='line'><span class="c">#4  0x00007f0329f9693f in rb_io_wait_readable (f=15) at io.c:1092</span>
</span><span class='line'><span class="c">#5  0x00007f0329f97cee in io_bufread (ptr=0x7f03042c3440 &quot;&quot;, len=36, fptr=0x7f0310054420) at io.c:2035</span>
</span><span class='line'><span class="c">#6  0x00007f0329f97e24 in bufread_call (arg=arg@entry=139651416833616) at io.c:2071</span>
</span><span class='line'><span class="c">#7  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f0329f97e10 &lt;bufread_call&gt;, data1=data1@entry=139651416833616, </span>
</span><span class='line'>    <span class="nv">e_proc</span><span class="o">=</span>e_proc@entry<span class="o">=</span>0x7f032a04f900 &lt;rb_str_unlocktmp&gt;, <span class="nv">data2</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at eval.c:850
</span><span class='line'><span class="c">#8  0x00007f032a05e8db in rb_str_locktmp_ensure (str=&lt;optimized out&gt;, func=func@entry=0x7f0329f97e10 &lt;bufread_call&gt;, </span>
</span><span class='line'>    <span class="nv">arg</span><span class="o">=</span>arg@entry<span class="o">=</span>139651416833616<span class="o">)</span> at string.c:2004
</span><span class='line'><span class="c">#9  0x00007f0329f9ad06 in io_fread (fptr=0x7f0310054420, size=36, offset=0, str=139650673747040) at io.c:2085</span>
</span><span class='line'><span class="c">#10 io_read (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, io=35833440) at io.c:2816</span>
</span><span class='line'><span class="c">#11 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127e770, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#12 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127e770, th=0x7f030c0455c0) at vm_insnhelper.c:1560</span>
</span><span class='line'>---Type &lt;<span class="k">return</span>&gt; to <span class="k">continue</span>, or q &lt;<span class="k">return</span>&gt; to quit---
</span><span class='line'><span class="c">#13 vm_call_method (th=0x7f030c0455c0, cfp=0x7f032127e770, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754</span>
</span><span class='line'><span class="c">#14 0x00007f032a0b7b9c in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1050</span>
</span><span class='line'><span class="c">#15 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#16 0x00007f032a0c2cff in invoke_block_from_c (defined_class=79426520, cref=0x0, blockptr=0x0, argv=0x7f032117c2e8, argc=1, self=72558880, </span>
</span><span class='line'>    <span class="nv">block</span><span class="o">=</span>&lt;optimized out&gt;, <span class="nv">th</span><span class="o">=</span>0x7f030c0455c0<span class="o">)</span> at vm.c:732
</span><span class='line'><span class="c">#17 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763</span>
</span><span class='line'><span class="c">#18 rb_yield_0 (argv=0x7f032117c2e8, argc=1) at vm_eval.c:938</span>
</span><span class='line'><span class="c">#19 rb_yield (val=&lt;optimized out&gt;) at vm_eval.c:948</span>
</span><span class='line'><span class="c">#20 0x00007f0329f1d4bd in rb_ary_collect (ary=139650673749800) at array.c:2684</span>
</span><span class='line'><span class="c">#21 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127ea90, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#22 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127ea90, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#23 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#24 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#25 0x00007f032a0c2cff in invoke_block_from_c (defined_class=80043920, cref=0x0, blockptr=0x0, argv=0x7f032117c6c8, argc=1, </span>
</span><span class='line'>    <span class="nv">self</span><span class="o">=</span>139650673695240, <span class="nv">block</span><span class="o">=</span>&lt;optimized out&gt;, <span class="nv">th</span><span class="o">=</span>0x7f030c0455c0<span class="o">)</span> at vm.c:732
</span><span class='line'><span class="c">#26 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763</span>
</span><span class='line'><span class="c">#27 rb_yield_0 (argv=0x7f032117c6c8, argc=1) at vm_eval.c:938</span>
</span><span class='line'><span class="c">#28 rb_yield (val=&lt;optimized out&gt;) at vm_eval.c:948</span>
</span><span class='line'><span class="c">#29 0x00007f0329f15fa2 in rb_ary_each (array=139650673713080) at array.c:1792</span>
</span><span class='line'><span class="c">#30 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f170, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#31 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127f170, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#32 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#33 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#34 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f0304886b90, self=139650673713320, defined_class=78042600, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>0, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321182020, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#35 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f0304886b90, argc=argc@entry=0, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321182020, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#36 0x00007f0329f6e550 in proc_call (argc=0, argv=0x7f0321182020, procval=139650673713160) at proc.c:734</span>
</span><span class='line'><span class="c">#37 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f300, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#38 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127f300, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#39 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#40 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#41 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x7f030c0455c0, proc=0x9676cb0, self=139650673658200, defined_class=79743600, argc=1, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f032117d0a0, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#42 0x00007f032a0bea45 in vm_call_bmethod_body (argv=0x7f032117d0a0, ci=0x7f032117d280, th=0x7f030c0455c0) at vm_insnhelper.c:1592</span>
</span><span class='line'><span class="c">#43 vm_call_bmethod (th=th@entry=0x7f030c0455c0, cfp=cfp@entry=0x7f032127f7b0, ci=ci@entry=0x7f032117d280) at vm_insnhelper.c:1607</span>
</span><span class='line'><span class="c">#44 0x00007f032a0bfc1e in vm_call_method (th=th@entry=0x7f030c0455c0, cfp=cfp@entry=0x7f032127f7b0, ci=ci@entry=0x7f032117d280)</span>
</span><span class='line'>    at vm_insnhelper.c:1774
</span><span class='line'><span class="c">#45 0x00007f032a0bf691 in vm_call_opt_send (th=0x7f030c0455c0, reg_cfp=0x7f032127f7b0, ci=0x7f032117d280) at vm_insnhelper.c:1657</span>
</span><span class='line'><span class="c">#46 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#47 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#48 0x00007f032a0bec82 in vm_yield_with_cref (cref=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=0x7f030c0455c0) at vm.c:755</span>
</span><span class='line'><span class="c">#49 yield_under (under=&lt;optimized out&gt;, self=&lt;optimized out&gt;, values=139650673660760) at vm_eval.c:1531</span>
</span><span class='line'><span class="c">#50 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f9e0, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#51 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f9e0, th=0x7f030c0455c0) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#52 vm_call_method (th=0x7f030c0455c0, cfp=0x7f032127f9e0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754</span>
</span><span class='line'><span class="c">#53 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#54 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#55 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f030010a480, self=83224000, defined_class=87087200, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>2, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181c90, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#56 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f030010a480, argc=argc@entry=2, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181c90, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#57 0x00007f0329f6e550 in proc_call (argc=2, argv=0x7f0321181c90, procval=139651130810120) at proc.c:734</span>
</span><span class='line'><span class="c">#58 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fa80, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#59 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127fa80, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#60 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#61 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#62 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f030010a560, self=87087800, defined_class=87087760, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181c38, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#63 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f030010a560, argc=argc@entry=1, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181c38, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#64 0x00007f0329f6e550 in proc_call (argc=1, argv=0x7f0321181c38, procval=139651130809960) at proc.c:734</span>
</span><span class='line'><span class="c">#65 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fb20, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#66 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fb20, th=0x7f030c0455c0) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#67 vm_call_method (th=0x7f030c0455c0, cfp=0x7f032127fb20, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754</span>
</span><span class='line'><span class="c">#68 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#69 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#70 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f030010a720, self=87087800, defined_class=87087760, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181be0, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#71 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f030010a720, argc=argc@entry=1, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181be0, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#72 0x00007f0329f6e550 in proc_call (argc=1, argv=0x7f0321181be0, procval=139651130809560) at proc.c:734</span>
</span><span class='line'><span class="c">#73 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fbc0, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#74 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127fbc0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#75 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#76 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'>---Type &lt;<span class="k">return</span>&gt; to <span class="k">continue</span>, or q &lt;<span class="k">return</span>&gt; to quit---
</span><span class='line'><span class="c">#77 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f0304529c40, self=156831200, defined_class=50567600, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>1, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181990, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#78 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f0304529c40, argc=argc@entry=1, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181990, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#79 0x00007f0329f6e550 in proc_call (argc=1, argv=0x7f0321181990, procval=139650673670240) at proc.c:734</span>
</span><span class='line'><span class="c">#80 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321280070, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#81 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f0321280070, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#82 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#83 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#84 0x00007f032a0c2cff in invoke_block_from_c (defined_class=76547880, cref=0x0, blockptr=0x0, argv=0x7f032117ee08, argc=1, self=34415960, </span>
</span><span class='line'>    <span class="nv">block</span><span class="o">=</span>&lt;optimized out&gt;, <span class="nv">th</span><span class="o">=</span>0x7f030c0455c0<span class="o">)</span> at vm.c:732
</span><span class='line'><span class="c">#85 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763</span>
</span><span class='line'><span class="c">#86 rb_yield_0 (argv=0x7f032117ee08, argc=1) at vm_eval.c:938</span>
</span><span class='line'><span class="c">#87 rb_yield (val=&lt;optimized out&gt;) at vm_eval.c:948</span>
</span><span class='line'><span class="c">#88 0x00007f0329f15fa2 in rb_ary_each (array=139650673629520) at array.c:1792</span>
</span><span class='line'><span class="c">#89 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f03212801b0, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#90 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f03212801b0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#91 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#92 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#93 0x00007f032a0c2924 in invoke_block_from_c (defined_class=80036240, cref=0x0, blockptr=0x0, argv=0x7f032117f1c8, argc=1, self=120753520, </span>
</span><span class='line'>    <span class="nv">block</span><span class="o">=</span>&lt;optimized out&gt;, <span class="nv">th</span><span class="o">=</span>0x7f030c0455c0<span class="o">)</span> at vm.c:732
</span><span class='line'><span class="c">#94 vm_yield (argv=0x7f032117f1c8, argc=1, th=0x7f030c0455c0) at vm.c:763</span>
</span><span class='line'><span class="c">#95 rb_yield_0 (argv=0x7f032117f1c8, argc=1) at vm_eval.c:938</span>
</span><span class='line'><span class="c">#96 catch_i (tag=&lt;optimized out&gt;, data=data@entry=0) at vm_eval.c:1772</span>
</span><span class='line'><span class="c">#97 0x00007f032a0b4b4a in rb_catch_protect (t=&lt;optimized out&gt;, func=func@entry=0x7f032a0c26c0 &lt;catch_i&gt;, data=data@entry=0, </span>
</span><span class='line'>    <span class="nv">stateptr</span><span class="o">=</span>stateptr@entry<span class="o">=</span>0x7f032117f340<span class="o">)</span> at vm_eval.c:1858
</span><span class='line'><span class="c">#98 0x00007f032a0b4bbc in rb_catch_obj (t=&lt;optimized out&gt;, func=func@entry=0x7f032a0c26c0 &lt;catch_i&gt;, data=data@entry=0) at vm_eval.c:1837</span>
</span><span class='line'><span class="c">#99 0x00007f032a0b4c6e in rb_f_catch (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at vm_eval.c:1823</span>
</span><span class='line'><span class="c">#100 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f03212802f0, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#101 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f03212802f0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#102 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#103 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#104 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x96c8680, self=133126360, defined_class=118126960, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>2, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181070, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#105 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x96c8680, argc=argc@entry=2, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0321181070, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#106 0x00007f0329f6e550 in proc_call (argc=2, argv=0x7f0321181070, procval=133281320) at proc.c:734</span>
</span><span class='line'><span class="c">#107 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321280f70, th=0x7f030c0455c0) at vm_insnhelper.c:1470</span>
</span><span class='line'>---Type &lt;<span class="k">return</span>&gt; to <span class="k">continue</span>, or q &lt;<span class="k">return</span>&gt; to quit---
</span><span class='line'><span class="c">#108 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f0321280f70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#109 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#110 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304</span>
</span><span class='line'><span class="c">#111 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x7f030c0455c0, proc=0x7f030c044ca0, self=133281640, defined_class=117256680, argc=0, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>0x7f02f4c943a0, <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#112 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x7f030c0455c0, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#113 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x7f030c0455c0, stack_start=&lt;optimized out&gt;) at thread.c:535</span>
</span><span class='line'><span class="c">#114 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x7f030c0455c0) at thread_pthread.c:803</span>
</span><span class='line'><span class="c">#115 0x00007f032990c182 in start_thread (arg=0x7f0321180700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#116 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">2</span> <span class="o">(</span>Thread 0x7f0320f7e700 <span class="o">(</span>LWP 9563<span class="o">))</span>:
</span><span class='line'><span class="c">#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185</span>
</span><span class='line'><span class="c">#1  0x00007f032a0d6ce3 in native_cond_wait (mutex=0x8ef42b0, cond=0x8ef42d8) at thread_pthread.c:334</span>
</span><span class='line'><span class="c">#2  lock_func (timeout_ms=0, mutex=0x8ef42b0, th=0x7f030c0485d0) at thread.c:4324</span>
</span><span class='line'><span class="c">#3  rb_mutex_lock (self=120765160) at thread.c:4398</span>
</span><span class='line'><span class="c">#4  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032107ebb0, th=0x7f030c0485d0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#5  vm_call_cfunc (th=0x7f030c0485d0, reg_cfp=0x7f032107ebb0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#6  0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0485d0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#7  0x00007f032a0bb5ec in vm_exec (th=0x7f030c0485d0) at vm.c:1304</span>
</span><span class='line'><span class="c">#8  0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0485d0, proc=proc@entry=0x96c8680, self=133126360, defined_class=118126960, </span>
</span><span class='line'>    <span class="nv">argc</span><span class="o">=</span>argc@entry<span class="o">=</span>2, <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0320f7f070, <span class="nv">blockptr</span><span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#9  0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x96c8680, argc=argc@entry=2, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>argv@entry<span class="o">=</span>0x7f0320f7f070, <span class="nv">blockptr</span><span class="o">=</span>&lt;optimized out&gt;<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#10 0x00007f0329f6e550 in proc_call (argc=2, argv=0x7f0320f7f070, procval=133281320) at proc.c:734</span>
</span><span class='line'><span class="c">#11 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032107ef70, th=0x7f030c0485d0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#12 vm_call_cfunc (th=0x7f030c0485d0, reg_cfp=0x7f032107ef70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#13 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0485d0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#14 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0485d0) at vm.c:1304</span>
</span><span class='line'><span class="c">#15 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x7f030c0485d0, proc=0x7f030c047b40, self=133281640, defined_class=117256680, argc=0, </span>
</span><span class='line'>    <span class="nv">argv</span><span class="o">=</span>0x7f02f4cd2290, <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:788
</span><span class='line'><span class="c">#16 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x7f030c0485d0, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, </span>
</span><span class='line'>    <span class="nv">blockptr</span><span class="o">=</span>blockptr@entry<span class="o">=</span>0x0<span class="o">)</span> at vm.c:807
</span><span class='line'><span class="c">#17 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x7f030c0485d0, stack_start=&lt;optimized out&gt;) at thread.c:535</span>
</span><span class='line'><span class="c">#18 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x7f030c0485d0) at thread_pthread.c:803</span>
</span><span class='line'><span class="c">#19 0x00007f032990c182 in start_thread (arg=0x7f0320f7e700) at pthread_create.c:312</span>
</span><span class='line'><span class="c">#20 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111</span>
</span><span class='line'>
</span><span class='line'>Thread <span class="m">1</span> <span class="o">(</span>Thread 0x7f032a5c2740 <span class="o">(</span>LWP 8999<span class="o">))</span>:
</span><span class='line'><span class="c">#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185</span>
</span><span class='line'><span class="c">#1  0x00007f032a0d2390 in native_cond_wait (mutex=0x1ed96d0, cond=&lt;optimized out&gt;) at thread_pthread.c:334</span>
</span><span class='line'><span class="c">#2  native_sleep (th=th@entry=0x1ed95b0, timeout_tv=0x0) at thread_pthread.c:1059</span>
</span><span class='line'><span class="c">#3  0x00007f032a0d618a in sleep_forever (deadlockable=1, spurious_check=0, th=0x1ed95b0) at thread.c:996</span>
</span><span class='line'><span class="c">#4  thread_join_sleep (arg=arg@entry=140734195440096) at thread.c:787</span>
</span><span class='line'><span class="c">#5  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f032a0d6090 &lt;thread_join_sleep&gt;, data1=data1@entry=140734195440096, </span>
</span><span class='line'>    <span class="nv">e_proc</span><span class="o">=</span>e_proc@entry<span class="o">=</span>0x7f032a0cfa10 &lt;remove_from_join_list&gt;, <span class="nv">data2</span><span class="o">=</span>data2@entry<span class="o">=</span>140734195440096<span class="o">)</span> at eval.c:850
</span><span class='line'><span class="c">#6  0x00007f032a0d0cd0 in thread_join (delay=&lt;optimized out&gt;, target_th=0x96c9f10) at thread.c:829</span>
</span><span class='line'><span class="c">#7  thread_join_m (argc=&lt;optimized out&gt;, argv=0x7f032a4c1168, self=&lt;optimized out&gt;) at thread.c:909</span>
</span><span class='line'><span class="c">#8  0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0ca0, th=0x1ed95b0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#9  vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0ca0, th=0x1ed95b0) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#10 vm_call_method (th=0x1ed95b0, cfp=0x7f032a5c0ca0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754</span>
</span><span class='line'><span class="c">#11 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x1ed95b0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#12 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x1ed95b0) at vm.c:1304</span>
</span><span class='line'><span class="c">#13 0x00007f032a0c2cff in invoke_block_from_c (defined_class=51649880, cref=0x0, blockptr=0x0, argv=0x7fff3bba1e08, argc=1, self=51647880, </span>
</span><span class='line'>    <span class="nv">block</span><span class="o">=</span>&lt;optimized out&gt;, <span class="nv">th</span><span class="o">=</span>0x1ed95b0<span class="o">)</span> at vm.c:732
</span><span class='line'><span class="c">#14 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763</span>
</span><span class='line'><span class="c">#15 rb_yield_0 (argv=0x7fff3bba1e08, argc=1) at vm_eval.c:938</span>
</span><span class='line'><span class="c">#16 rb_yield (val=val@entry=52428600) at vm_eval.c:948</span>
</span><span class='line'><span class="c">#17 0x00007f0329fcb079 in rb_obj_tap (obj=52428600) at object.c:675</span>
</span><span class='line'><span class="c">#18 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0e30, th=0x1ed95b0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#19 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0e30, th=0x1ed95b0) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#20 vm_call_method (th=0x1ed95b0, cfp=0x7f032a5c0e30, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754</span>
</span><span class='line'><span class="c">#21 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x1ed95b0, initial=initial@entry=0) at insns.def:999</span>
</span><span class='line'><span class="c">#22 0x00007f032a0bb5ec in vm_exec (th=0x1ed95b0) at vm.c:1304</span>
</span><span class='line'><span class="c">#23 0x00007f032a0c43c9 in rb_iseq_eval (iseqval=&lt;optimized out&gt;) at vm.c:1549</span>
</span><span class='line'><span class="c">#24 0x00007f0329f6a630 in rb_load_internal0 (th=0x1ed95b0, fname=52100160, wrap=wrap@entry=0) at load.c:615</span>
</span><span class='line'><span class="c">#25 0x00007f0329f6bdde in rb_load_internal (wrap=0, fname=&lt;optimized out&gt;) at load.c:644</span>
</span><span class='line'><span class="c">#26 rb_require_safe (fname=52099680, safe=0) at load.c:996</span>
</span><span class='line'><span class="c">#27 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0f70, th=0x1ed95b0) at vm_insnhelper.c:1470</span>
</span><span class='line'><span class="c">#28 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0f70, th=0x1ed95b0) at vm_insnhelper.c:1560</span>
</span><span class='line'><span class="c">#29 vm_call_method (th=0x1ed95b0, cfp=0x7f032a5c0f70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754</span>
</span><span class='line'><span class="c">#30 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x1ed95b0, initial=initial@entry=0) at insns.def:1028</span>
</span><span class='line'><span class="c">#31 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x1ed95b0) at vm.c:1304</span>
</span><span class='line'><span class="c">#32 0x00007f032a0c4636 in rb_iseq_eval_main (iseqval=iseqval@entry=52095080) at vm.c:1562</span>
</span><span class='line'><span class="c">#33 0x00007f0329f6510a in ruby_exec_internal (n=0x31ae868) at eval.c:253</span>
</span><span class='line'><span class="c">#34 0x00007f0329f670ad in ruby_exec_node (n=n@entry=0x31ae868) at eval.c:318</span>
</span><span class='line'><span class="c">#35 0x00007f0329f694dc in ruby_run_node (n=0x31ae868) at eval.c:310</span>
</span><span class='line'><span class="c">#36 0x000000000040088b in main (argc=3, argv=0x7fff3bba2b88) at main.c:36</span>
</span></code></pre></td></tr></table></div></figure>

I then thought I might get a bit more info if I dumped the current Ruby backtrace:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">(</span>gdb<span class="o">)</span> call <span class="o">(</span>void<span class="o">)</span> close<span class="o">(</span>1<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> call <span class="o">(</span>void<span class="o">)</span> close<span class="o">(</span>2<span class="o">)</span>
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> shell tty
</span><span class='line'>/dev/pts/15 &lt;--- this will likely be different on your machine
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> call <span class="o">(</span>int<span class="o">)</span> open<span class="o">(</span><span class="s2">&quot;/dev/pts/15&quot;</span>, 2, 0<span class="o">)</span>
</span><span class='line'><span class="nv">$1</span> <span class="o">=</span> 1
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> call <span class="o">(</span>int<span class="o">)</span> open<span class="o">(</span><span class="s2">&quot;/dev/pts/15&quot;</span>, 2, 0<span class="o">)</span>
</span><span class='line'><span class="nv">$2</span> <span class="o">=</span> 2
</span><span class='line'><span class="o">(</span>gdb<span class="o">)</span> call <span class="o">(</span>void<span class="o">)</span>rb_backtrace<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>

This now shows me what's going on inside my Ruby process:

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/thread_pool.rb:92:in <span class="sb">`</span>block in spawn_thread<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/thread_pool.rb:92:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/server.rb:254:in <span class="sb">`</span>block in run<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/server.rb:361:in `process_client&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/server.rb:490:in <span class="sb">`</span>handle_request<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/content_length.rb:14:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/application.rb:144:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/engine.rb:514:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/airbrake-4.0.0/lib/airbrake/user_informer.rb:12:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/airbrake-4.0.0/lib/airbrake/user_informer.rb:16:in `_call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/sendfile.rb:112:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/static.rb:64:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/lock.rb:17:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/runtime.rb:17:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/methodoverride.rb:21:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/request_id.rb:21:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/quiet_assets-1.0.2/lib/quiet_assets.rb:18:in `call_with_quiet_assets&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/rack/logger.rb:20:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/tagged_logging.rb:68:in `tagged&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/tagged_logging.rb:26:in <span class="sb">`</span>tagged<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/tagged_logging.rb:68:in `block in tagged&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/rack/logger.rb:20:in <span class="sb">`</span>block in call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/rack/logger.rb:38:in `call_app&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/show_exceptions.rb:30:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/airbrake-4.0.0/lib/airbrake/rails/middleware.rb:13:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/remote_ip.rb:76:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/reloader.rb:73:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/callbacks.rb:27:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:82:in <span class="sb">`</span>run_callbacks<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/callbacks.rb:29:in `block in call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/cookies.rb:560:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/session/abstract/id.rb:220:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/session/abstract/id.rb:225:in <span class="sb">`</span>context<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/flash.rb:254:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/params_parser.rb:27:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/head.rb:11:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/conditionalget.rb:25:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/etag.rb:23:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/manager.rb:34:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/manager.rb:34:in `catch&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/manager.rb:35:in <span class="sb">`</span>block in call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:676:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/journey/router.rb:59:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/journey/router.rb:59:in `each&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/journey/router.rb:71:in <span class="sb">`</span>block in call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:48:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:80:in <span class="sb">`</span>dispatch<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:80:in `call&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal.rb:231:in <span class="sb">`</span>block in action<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/rack_delegation.rb:13:in `dispatch&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal.rb:195:in <span class="sb">`</span>dispatch<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionview-4.1.1/lib/action_view/rendering.rb:30:in `process&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/abstract_controller/base.rb:136:in <span class="sb">`</span>process<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/params_wrapper.rb:250:in `process_action&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/instrumentation.rb:30:in <span class="sb">`</span>process_action<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `instrument&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications/instrumenter.rb:20:in <span class="sb">`</span>instrument<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `block in instrument&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/instrumentation.rb:31:in <span class="sb">`</span>block in process_action<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/rescue.rb:29:in `process_action&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/abstract_controller/callbacks.rb:19:in <span class="sb">`</span>process_action<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:86:in `run_callbacks&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:86:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:166:in `block in halting&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:166:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:160:in `block in halting&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:160:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:440:in `block in make_lambda&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:440:in <span class="sb">`</span>instance_exec<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/mongoid_userstamp-0.3.2/lib/mongoid/userstamp/railtie.rb:15:in `block (2 levels) in &lt;class:Railtie&gt;&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/devise-3.2.4/lib/devise/controllers/helpers.rb:58:in <span class="sb">`</span>current_user<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/proxy.rb:104:in `authenticate&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/proxy.rb:318:in <span class="sb">`</span>_perform_authentication<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/proxy.rb:212:in `user&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/session_serializer.rb:34:in <span class="sb">`</span>fetch<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/devise-3.2.4/lib/devise.rb:462:in `block (2 levels) in configure_warden!&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/devise-3.2.4/lib/devise/models/authenticatable.rb:208:in <span class="sb">`</span>serialize_from_session<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/orm_adapter-0.5.0/lib/orm_adapter/adapters/mongoid.rb:22:in `get&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual.rb:20:in <span class="sb">`</span>first<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:197:in `first&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:447:in <span class="sb">`</span>try_cache<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:198:in `block in first&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:535:in <span class="sb">`</span>with_sorting<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:199:in `block (2 levels) in first&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/query_cache.rb:186:in <span class="sb">`</span>first_with_cache<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/query_cache.rb:135:in `with_cache&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/query_cache.rb:187:in <span class="sb">`</span>block in first_with_cache<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/query.rb:127:in `first&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/primary.rb:54:in <span class="sb">`</span>with_node<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/selectable.rb:65:in `with_retry&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/selectable.rb:65:in <span class="sb">`</span>call<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/primary.rb:55:in `block in with_node&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:240:in <span class="sb">`</span>with_primary<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:151:in `nodes&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:194:in <span class="sb">`</span>refresh<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:194:in `each&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:182:in <span class="sb">`</span>block in refresh<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:432:in `refresh&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:90:in <span class="sb">`</span><span class="nb">command</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:648:in `read&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/operation/read.rb:48:in <span class="sb">`</span>execute<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:391:in `process&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:587:in <span class="sb">`</span>flush<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:616:in `logging&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/instrumentable.rb:31:in <span class="sb">`</span>instrument<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `instrument&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications/instrumenter.rb:20:in <span class="sb">`</span>instrument<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `block in instrument&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:617:in <span class="sb">`</span>block in logging<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:589:in `block in flush&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:187:in <span class="sb">`</span>ensure_connected<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:184:in `rescue in ensure_connected&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/failover/retry.rb:29:in <span class="sb">`</span>execute<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:114:in `connection&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/gems/connection_pool-2.0.0/lib/connection_pool.rb:58:in <span class="sb">`</span>with<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:115:in `block in connection&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/failover/retry.rb:30:in <span class="sb">`</span>block in execute<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:590:in `block (2 levels) in flush&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection.rb:172:in <span class="sb">`</span>write<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection.rb:220:in `with_connection&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection.rb:52:in <span class="sb">`</span>connect<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:144:in `connect&#39;</span>
</span><span class='line'>  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:106:in <span class="sb">`</span>timeout<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:35:in `catch&#39;</span>
</span><span class='line'>  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:35:in <span class="sb">`</span>catch<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:35:in `block in catch&#39;</span>
</span><span class='line'>  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:91:in <span class="sb">`</span>block in timeout<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:145:in `block in connect&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:145:in <span class="sb">`</span>new<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/tcp.rb:20:in `initialize&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:119:in <span class="sb">`</span>handle_socket_errors<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/tcp.rb:20:in `block in initialize&#39;</span>
</span><span class='line'>  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/tcp.rb:20:in <span class="sb">`</span>initialize<span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>

Looks like the whole think started with a [moped](https://github.com/mongoid/moped) socket connection (which makes sense). 

Investigating further ...]]></content>
    </entry>
    
</feed>
