<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Round Trips to Authenticate a MongoDB Client Connection" /><meta property="og:locale" content="en" /><meta name="description" content="When MongoDB Drivers establish a connection with a MongoDB cluster a number of network round trips are performed. This can result in increased latency when measuring the time to response of an operation following a cold start, so it’s worth understanding what the anatomy of an authenticated connection is - as well as what can be done to improve an initial operations round trip time (RTT)." /><meta property="og:description" content="When MongoDB Drivers establish a connection with a MongoDB cluster a number of network round trips are performed. This can result in increased latency when measuring the time to response of an operation following a cold start, so it’s worth understanding what the anatomy of an authenticated connection is - as well as what can be done to improve an initial operations round trip time (RTT)." /><link rel="canonical" href="https://www.alexbevi.com/blog/2023/05/04/round-trips-to-authenticate-a-mongodb-client-connection/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2023/05/04/round-trips-to-authenticate-a-mongodb-client-connection/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:image" content="https://www.alexbevi.com/images/mongodb-logo.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-05-04T14:40:52-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://www.alexbevi.com/images/mongodb-logo.png" /><meta property="twitter:title" content="Round Trips to Authenticate a MongoDB Client Connection" /><meta name="twitter:site" content="@alexbevi" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-09T14:47:45-04:00","datePublished":"2023-05-04T14:40:52-04:00","description":"When MongoDB Drivers establish a connection with a MongoDB cluster a number of network round trips are performed. This can result in increased latency when measuring the time to response of an operation following a cold start, so it’s worth understanding what the anatomy of an authenticated connection is - as well as what can be done to improve an initial operations round trip time (RTT).","headline":"Round Trips to Authenticate a MongoDB Client Connection","image":"https://www.alexbevi.com/images/mongodb-logo.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2023/05/04/round-trips-to-authenticate-a-mongodb-client-connection/"},"url":"https://www.alexbevi.com/blog/2023/05/04/round-trips-to-authenticate-a-mongodb-client-connection/"}</script><title>Round Trips to Authenticate a MongoDB Client Connection | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/images/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">ALEX BEVILACQUA</a></div><div class="site-subtitle fst-italic">my little corner of the interwebs</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer" > <i class="fab fa-reddit"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Round Trips to Authenticate a MongoDB Client Connection</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Round Trips to Authenticate a MongoDB Client Connection</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1683225652" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 4, 2023 </em> </span> <span> Updated <em class="" data-ts="1683658065" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 9, 2023 </em> </span><div class="mt-3 mb-3"> <a href="/images/mongodb-logo.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/images/mongodb-logo.png" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1283 words" > <em>7 min</em> read </span></div></div></div><div class="post-content"><p>When <a href="https://www.mongodb.com/docs/drivers/">MongoDB Drivers</a> establish a connection with a MongoDB cluster a number of network round trips are performed. This can result in increased latency when measuring the time to response of an operation following a cold start, so it’s worth understanding what the anatomy of an authenticated connection is - as well as what can be done to improve an initial operations round trip time (RTT).</p><h1 id="current-state">Current State</h1><p><a href="/images/mongo-auth-01.png" class="popup img-link "><img data-src="/images/mongo-auth-01.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="connection-protocol"><span class="me-2">Connection Protocol</span><a href="#connection-protocol" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Typically a MongoDB connection string will contain a <a href="https://www.mongodb.com/docs/manual/reference/connection-string/#std-label-connections-standard-connection-string-format">standard seed list</a>, which is represented by the <code class="language-plaintext highlighter-rouge">mongodb://</code> protocol followed by a list of servers (ex: <code class="language-plaintext highlighter-rouge">mongodb://localhost:27017,localhost:27018....</code>).</p><p>Starting with MongoDB 3.6 instead of having to provide the seed list in the connection string manually a <a href="https://www.mongodb.com/docs/manual/reference/connection-string/#std-label-connections-dns-seedlist">DNS-constructed seed list</a> could be used as well. With this configuration the <code class="language-plaintext highlighter-rouge">mongodb+srv://</code> protocol is used to communicate both the seed list as well as any options by performing two (2) DNS queries to resolve the following DNS records: <a href="https://en.wikipedia.org/wiki/SRV_record"><code class="language-plaintext highlighter-rouge">SRV</code></a> and <a href="https://en.wikipedia.org/wiki/TXT_record"><code class="language-plaintext highlighter-rouge">TXT</code></a>.</p><p>See <a href="https://www.mongodb.com/blog/post/mongodb-3-6-here-to-srv-you-with-easier-replica-set-connections"><em>“MongoDB 3.6: Here to SRV you with easier replica set connections”</em></a> for more information regarding this topic.</p><p>Additionally there may be an RTT for <code class="language-plaintext highlighter-rouge">A</code>/<code class="language-plaintext highlighter-rouge">AAAA</code>/<code class="language-plaintext highlighter-rouge">CNAME</code> resolution, however these may be done in parallel and may also be cached. <a href="https://www.cloudns.net/blog/dns-cache-explained/">DNS Caching</a> will likely improve the performance of these queries, but it’s worth noting their presence within the connection establishment and authentication lifecycle.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
</pre></table></code></div></div><p>Note that if the <code class="language-plaintext highlighter-rouge">SRV</code> record returns multiple hosts, those <code class="language-plaintext highlighter-rouge">A</code>/<code class="language-plaintext highlighter-rouge">AAAA</code>/<code class="language-plaintext highlighter-rouge">CNAME</code> records will be resolved in parallel. And DNS servers typically will optimize the traversal returning any intermediate <code class="language-plaintext highlighter-rouge">CNAME</code>s followed by the <code class="language-plaintext highlighter-rouge">A</code>/<code class="language-plaintext highlighter-rouge">AAAA</code> in the same request.</p><p>This also assumes UDP-based DNS resolution. If you exceed the UDP packet size, you might first try UDP, receive an error, and retry using TCP (and possibly requiring a TCP handshake to the DNS server as well).</p><h2 id="tcp-handshake"><span class="me-2">TCP Handshake</span><a href="#tcp-handshake" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/images/mongo-auth-03.png" class="popup img-link "><img data-src="/images/mongo-auth-03.png" alt="" class="lazyload" data-proofer-ignore></a> <em>Source: <a href="https://www.makeuseof.com/what-is-three-way-handshake-how-does-it-work/">makeuseof.com</a></em></p><p>Once a host is known from the seed list, next we need to connect to it. This is done using a standard <a href="https://www.geeksforgeeks.org/tcp-3-way-handshake-process/">TCP 3-way Handshake</a>, which constitutes 1 RTT. Note that as there is an <code class="language-plaintext highlighter-rouge">ACK</code> sent following the <code class="language-plaintext highlighter-rouge">SYN/ACK</code> this handshake is sometimes considered to be <a href="https://networkengineering.stackexchange.com/a/76369">1.5 RTT</a>, however most TCP stacks will send the first data packet with the <code class="language-plaintext highlighter-rouge">ACK</code>.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
</pre></table></code></div></div><h2 id="tls-handshake"><span class="me-2">TLS Handshake</span><a href="#tls-handshake" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/images/mongo-auth-02.png" class="popup img-link "><img data-src="/images/mongo-auth-02.png" alt="" class="lazyload" data-proofer-ignore></a> <em>Source: <a href="https://www.cloudflare.com/en-gb/learning/ssl/what-happens-in-a-tls-handshake/">cloudflare.com</a></em></p><p>To ensure all connections to <a href="https://www.mongodb.com/atlas/database">MongoDB Atlas</a> are secure, <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security (TLS)</a> is enabled by default. Following a successful TCP handshake, a <a href="https://www.cloudflare.com/en-gb/learning/ssl/what-happens-in-a-tls-handshake/">TLS handshake</a> will be performed.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
<span class="o">+</span>  <span class="mi">2</span>      <span class="c1">// TLS</span>
</pre></table></code></div></div><h2 id="mongodb-handshake"><span class="me-2">MongoDB Handshake</span><a href="#mongodb-handshake" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now that we have established a TLS secured TCP socket connection to a MongoDB host (<code class="language-plaintext highlighter-rouge">mongos</code> or <code class="language-plaintext highlighter-rouge">mongod</code>), the MongoDB Driver will send a <a href="https://www.mongodb.com/docs/manual/reference/command/hello/"><code class="language-plaintext highlighter-rouge">hello</code></a> command to perform <a href="https://github.com/mongodb/specifications/blob/master/source/mongodb-handshake/handshake.rst">the initial handshake</a>.</p><p>This step is required to determine that the host at the other end of the socket is actually a MongoDB server. Assuming the version of the MongoDB Driver supports MongoDB 4.4+ the handshake will also include a <a href="https://github.com/mongodb/specifications/blob/master/source/mongodb-handshake/handshake.rst#speculative-authentication"><code class="language-plaintext highlighter-rouge">speculativeAuthenticate</code></a> argument. Specifying this argument to <code class="language-plaintext highlighter-rouge">hello</code> will speculatively include the first command of an authentication handshake, thus eliminating one round trip as the <code class="language-plaintext highlighter-rouge">saslStart</code> command doesn’t need to be sent during the authentication handshake.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
<span class="o">+</span>  <span class="mi">2</span>      <span class="c1">// TLS</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// MongoDB</span>
</pre></table></code></div></div><h2 id="authentication-handshake"><span class="me-2">Authentication Handshake</span><a href="#authentication-handshake" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>MongoDB supports a number of <a href="https://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer">SASL (Simple Authentication and Security Layer)</a> mechanisms. By default the SASL mechanism that will be used will be a <a href="https://www.mongodb.com/docs/manual/core/security-scram/">SCRAM</a> mechanism (either <code class="language-plaintext highlighter-rouge">SCRAM-SHA-1</code> or <code class="language-plaintext highlighter-rouge">SCRAM-SHA-256</code>), which effectively means “username and password”. Note that this is a “challenge response” mechanism, so these credentials aren’t broadcast in the clear.</p><p>As outlined in the <a href="https://github.com/mongodb/specifications/blob/master/source/auth/auth.rst#id8">MongoDB Authentication specification</a>, a <code class="language-plaintext highlighter-rouge">SCRAM-SHA-256</code> conversation will be made up of 2 round trips as follows:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;</span> <span class="p">{</span><span class="na">saslStart</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">mechanism</span><span class="p">:</span><span class="dl">"</span><span class="s2">SCRAM-SHA-256</span><span class="dl">"</span><span class="p">,</span> <span class="na">options</span><span class="p">:</span> <span class="p">{</span><span class="na">skipEmptyExchange</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">...=</span><span class="dl">"</span><span class="p">)}</span>
<span class="o">&lt;&lt;</span> <span class="p">{</span><span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">...=</span><span class="dl">"</span><span class="p">),</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">ok</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="p">{</span><span class="na">saslContinue</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">...==</span><span class="dl">"</span><span class="p">)}</span>
<span class="o">&lt;&lt;</span> <span class="p">{</span><span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">...==</span><span class="dl">"</span><span class="p">),</span> <span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">ok</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></table></code></div></div><p>For <a href="https://github.com/mongodb/specifications/blob/master/source/auth/auth.rst#backwards-compatibility">backwards compatibility</a> with MongoDB 4.2 or earlier, MongoDB Drivers support a longer <code class="language-plaintext highlighter-rouge">SCRAM</code> conversation which includes an additional <code class="language-plaintext highlighter-rouge">saslContinue</code> command being sent as follows:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;</span> <span class="p">{</span><span class="na">saslStart</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">mechanism</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SCRAM-SHA-1</span><span class="dl">"</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">),</span> <span class="na">options</span><span class="p">:</span> <span class="p">{</span><span class="na">skipEmptyExchange</span><span class="p">:</span> <span class="kc">true</span><span class="p">}}</span>
<span class="o">&lt;&lt;</span> <span class="p">{</span><span class="na">conversationId</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">),</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">ok</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="p">{</span><span class="na">saslContinue</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">)}</span>
<span class="o">&lt;&lt;</span> <span class="p">{</span><span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="dl">"</span><span class="s2">...</span><span class="dl">"</span><span class="p">),</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">ok</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="p">{</span><span class="na">saslContinue</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">""</span><span class="p">)}</span>
<span class="o">&lt;&lt;</span> <span class="p">{</span><span class="na">conversationId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nc">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="dl">""</span><span class="p">),</span> <span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">ok</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></table></code></div></div><p>RTT was improved with MongoDB 4.4+ as 2 round trips can potentially be avoided:</p><ol><li>when <code class="language-plaintext highlighter-rouge">speculativeAuthenticate</code> is used the <code class="language-plaintext highlighter-rouge">saslStart</code> command is incorporated into the initial MongoDB handshake<li>when the <code class="language-plaintext highlighter-rouge">saslStart</code> command contains the <code class="language-plaintext highlighter-rouge">skipEmptyExchange: true</code> option, the second <code class="language-plaintext highlighter-rouge">saslContinue</code> command can be skipped</ol><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
<span class="o">+</span>  <span class="mi">2</span>      <span class="c1">// TLS</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// MongoDB</span>
<span class="o">+</span> <span class="p">[</span><span class="mi">2</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Authentication</span>
</pre></table></code></div></div><h1 id="reducing-round-trips">Reducing Round Trips</h1><p>As outlined above there are a number of network round trips required to authenticate a client connection to a MongoDB host using a username and password:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
<span class="o">+</span>  <span class="mi">2</span>      <span class="c1">// TLS</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// MongoDB</span>
<span class="o">+</span> <span class="p">[</span><span class="mi">2</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Authentication</span>
<span class="o">---------------------------</span>
<span class="p">[</span><span class="mi">6</span> <span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
</pre></table></code></div></div><p>MongoDB 4.4 has been out since at least <a href="https://www.mongodb.com/docs/manual/release-notes/4.4/#4.4.1---sep-9--2020">September 2020</a>, so chances are most applications are connecting to at least this version or newer. This would put the average round trip count for authenticating a connection between 6 and 9 (depending on what protocol is being used and if DNS results were previously cached).</p><p>Next let’s review what can be done to reduce these round trips where possible.</p><h2 id="use-x509-authentication"><span class="me-2">Use x.509 Authentication</span><a href="#use-x509-authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When using <a href="https://www.mongodb.com/docs/manual/tutorial/configure-x509-client-authentication/">x.509 certificates to authenticate clients</a>, the <a href="https://github.com/mongodb/specifications/blob/master/source/auth/auth.rst/#mongodb-x509">conversation</a> with the server does not require a <code class="language-plaintext highlighter-rouge">saslContinue</code>. Assuming this <code class="language-plaintext highlighter-rouge">speculativeAuthenticate</code> of the initial handshake succeeds (which it should), two full round trip can be removed!</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
<span class="o">+</span>  <span class="mi">2</span>      <span class="c1">// TLS</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// MongoDB</span>
<span class="o">+</span>  <span class="mi">0</span>      <span class="c1">// Authentication</span>
<span class="o">---------------------------</span>
<span class="p">[</span><span class="mi">4</span> <span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
</pre></table></code></div></div><p>Note there’s no authentication round trips as the <code class="language-plaintext highlighter-rouge">speculativeAuthenticate</code> succeeding contains the information typically sent via the <code class="language-plaintext highlighter-rouge">saslStart</code> command.</p><h2 id="use-tls-13"><span class="me-2">Use TLS 1.3+</span><a href="#use-tls-13" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/images/mongo-auth-04.jpg" class="popup img-link "><img data-src="/images/mongo-auth-04.jpg" alt="" class="lazyload" data-proofer-ignore></a> <em>Source: <a href="https://www.thesslstore.com/blog/tls-1-3-handshake-tls-1-2/">thesslstore.com</a></em></p><p>TLS 1.3 (<a href="https://datatracker.ietf.org/doc/html/rfc8446">RFC 8446</a>) can authenticate a connection approximately twice as fast as TLS 1.2 (<a href="https://datatracker.ietf.org/doc/html/rfc5246">RFC 5246</a>) by eliminating a full round trip.</p><p>Though not necessarily supported (at time of writing) by the MongoDB Server, additional non-standard TLS 1.3 configurations can further help speed up encrypted connections - such as <a href="https://blogs.windows.com/msedgedev/2016/06/15/building-a-faster-and-more-secure-web-with-tcp-fast-open-tls-false-start-and-tls-1-3/">TLS false start</a> and <a href="https://blog.cloudflare.com/introducing-0-rtt/">Zero Round Trip Time (0-RTT)</a>. See <a href="https://www.thesslstore.com/blog/tls-1-3-everything-possibly-needed-know/">“TLS 1.3: Everything you need to know”</a> for more information.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="cm">/* Network Round Trips */</span>
  <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Protocol</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TCP</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// TLS</span>
<span class="o">+</span>  <span class="mi">1</span>      <span class="c1">// MongoDB</span>
<span class="o">+</span> <span class="p">[</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1">// Authentication</span>
<span class="o">---------------------------</span>
<span class="p">[</span><span class="mi">3</span> <span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</pre></table></code></div></div><h1 id="conclusion">Conclusion</h1><p>In some environments (such as <a href="https://en.wikipedia.org/wiki/Function_as_a_service">Function as a Service</a>) the cold start time of an application is critically important. The time to authenticate a connection to a MongoDB host and how this can be improved can be useful in improving operational latency of applications.</p><p>Out of the box there may be upwards of 9 network round trips (<code class="language-plaintext highlighter-rouge">SRV+TCP+TLS+MONGODB+AUTH</code>), however this can potentially be cut in half (or more) by understanding what configuration and authentication options exist and how they can be applied.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/mongodb/'>MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/connections/" class="post-tag no-text-decoration" >connections</a> <a href="/tags/drivers/" class="post-tag no-text-decoration" >drivers</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Round%20Trips%20to%20Authenticate%20a%20MongoDB%20Client%20Connection%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F05%2F04%2Fround-trips-to-authenticate-a-mongodb-client-connection%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Round%20Trips%20to%20Authenticate%20a%20MongoDB%20Client%20Connection%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F05%2F04%2Fround-trips-to-authenticate-a-mongodb-client-connection%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F05%2F04%2Fround-trips-to-authenticate-a-mongodb-client-connection%2F&text=Round%20Trips%20to%20Authenticate%20a%20MongoDB%20Client%20Connection%20-%20ALEX%20BEVILACQUA" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F05%2F04%2Fround-trips-to-authenticate-a-mongodb-client-connection%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin" > <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Round%20Trips%20to%20Authenticate%20a%20MongoDB%20Client%20Connection%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F05%2F04%2Fround-trips-to-authenticate-a-mongodb-client-connection%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo" > <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/2023/11/13/querysrv-errors-when-connecting-to-mongodb-atlas/">querySrv errors when connecting to MongoDB Atlas</a><li class="text-truncate lh-lg"> <a href="/blog/2021/07/28/adventure-games-1980-1999/">Let's Adventure! A Journey into Adventure Games (1980-1999)</a><li class="text-truncate lh-lg"> <a href="/blog/2021/08/08/adventure-games-1980-1999-sorted-by-score/">Let's Adventure! Reviewed Games Sorted by Score</a><li class="text-truncate lh-lg"> <a href="/blog/2023/10/26/lost-in-time/">Lost in Time (Coktel Vision) - 1993</a><li class="text-truncate lh-lg"> <a href="/blog/2023/10/24/adventureland/">Adventureland (Adventure International) - 1982</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/snes/">snes</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1688480174" data-df="ll" > Jul 4, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>How Many Connections is My Application Establishing to My MongoDB Cluster?</h4><div class="text-muted small"><p> MongoDB Atlas is the best way to host your MongoDB data, but it’s important to be aware that like any other managed service there can be limitations. For example, MongoDB Atlas - depending on the s...</p></div></div></a></div><div class="col"> <a href="/blog/2023/11/13/querysrv-errors-when-connecting-to-mongodb-atlas/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1699904533" data-df="ll" > Nov 13, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>querySrv errors when connecting to MongoDB Atlas</h4><div class="text-muted small"><p> If your application uses MongoDB’s Node.js driver or Mongoose ODM, occasionally you may observe errors such as querySrv ECONNREFUSED _mongodb._tcp.cluster0.abcde.mongodb.net or Error: querySrv ETIM...</p></div></div></a></div><div class="col"> <a href="/blog/2023/08/03/behavioral-changes-to-the-findoneand-star-family-of-apis-in-node-dot-js-driver-6-dot-0-0/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1691067569" data-df="ll" > Aug 3, 2023 </em><h4 class="pt-0 my-2" data-toc-skip>Changes to findOneAnd* APIs in Node.js Driver 6.0.0</h4><div class="text-muted small"><p> Cross posted from the MongoDB Blog One exciting change that is coming in release 6.0.0 of the Node.js Driver is that the modified (or original) document targeted by a findOneAnd* operation wil...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2023/05/01/favourite-ruby-slash-rails-ides/" class="btn btn-outline-primary" prompt="Older" ><p>Identifying Ruby Developers' Favourite IDEs for Ruby/Rails in 2023</p></a> <a href="/blog/2023/05/10/murder-on-the-mississippi/" class="btn btn-outline-primary" prompt="Newer" ><p>Murder on the Mississippi (Activision) - 1986</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2023/05/04/round-trips-to-authenticate-a-mongodb-client-connection/'; this.page.identifier = '/blog/2023/05/04/round-trips-to-authenticate-a-mongodb-client-connection/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/snes/">snes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p><p>© 2023 <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="/assets/lib/jquery/jquery.min.js"></script> <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script> <script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script src="/assets/lib/lazysizes/lazysizes.min.js"></script> <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/clipboard/clipboard.min.js"></script> <script src="/assets/lib/dayjs/dayjs.min.js"></script> <script src="/assets/lib/dayjs/locale/en.min.js"></script> <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script> <script src="/assets/lib/tocbot/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
