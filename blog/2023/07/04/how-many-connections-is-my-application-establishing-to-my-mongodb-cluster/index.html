<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.0" /><meta property="og:title" content="How Many Connections is My Application Establishing to My MongoDB Cluster?" /><meta property="og:locale" content="en" /><meta name="description" content="MongoDB Atlas is the best way to host your MongoDB data, but it’s important to be aware that like any other managed service there can be limitations. For example, MongoDB Atlas - depending on the selected tier - will impose a connection limit." /><meta property="og:description" content="MongoDB Atlas is the best way to host your MongoDB data, but it’s important to be aware that like any other managed service there can be limitations. For example, MongoDB Atlas - depending on the selected tier - will impose a connection limit." /><link rel="canonical" href="https://www.alexbevi.com/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:image" content=" https://www.alexbevi.com/images/mongodb-logo.png " /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-04T10:16:14-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content=" https://www.alexbevi.com/images/mongodb-logo.png " /><meta property="twitter:title" content="How Many Connections is My Application Establishing to My MongoDB Cluster?" /><meta name="twitter:site" content="@alexbevi" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-06T14:01:05-05:00","datePublished":"2023-07-04T10:16:14-04:00","description":"MongoDB Atlas is the best way to host your MongoDB data, but it’s important to be aware that like any other managed service there can be limitations. For example, MongoDB Atlas - depending on the selected tier - will impose a connection limit.","headline":"How Many Connections is My Application Establishing to My MongoDB Cluster?","image":" https://www.alexbevi.com/images/mongodb-logo.png ","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/"},"url":"https://www.alexbevi.com/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/"}</script><title>How Many Connections is My Application Establishing to My MongoDB Cluster? | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="/assets/lib/glightbox/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script defer src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script> <script defer src="/assets/lib/glightbox/glightbox.min.js"></script> <script defer src="/assets/lib/clipboard/clipboard.min.js"></script> <script defer src="/assets/lib/dayjs/dayjs.min.js"></script> <script defer src="/assets/lib/dayjs/locale/en.js"></script> <script defer src="/assets/lib/dayjs/plugin/relativeTime.js"></script> <script defer src="/assets/lib/dayjs/plugin/localizedFormat.js"></script> <script defer src="/assets/lib/tocbot/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-36490021-1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-36490021-1'); }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6215800856413580" crossorigin="anonymous"></script><meta name="google-adsense-account" content="ca-pub-6215800856413580"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src=" /./images/avatar.png " width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ALEX BEVILACQUA</a><p class="site-subtitle fst-italic mb-0">my little corner of the interwebs</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/specifications/" class="nav-link"> <i class="fa-fw fas fa-book"></i> <span>SPECIFICATIONS</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer" > <i class="fab fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>How Many Connections is My Application Establishing to My MongoDB Cluster?</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>How Many Connections is My Application Establishing to My MongoDB Cluster?</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1688480174" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 4, 2023 </time> </span> <span> Updated <time data-ts="1709751665" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 6, 2024 </time> </span><div class="mt-3 mb-3"> <a href=" /images/mongodb-logo.png" class="popup img-link preview-img shimmer"><img src=" /images/mongodb-logo.png" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1021 words" > <em>5 min</em> read </span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">How Many Connections is My Application Establishing to My MongoDB Cluster?</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">How Many Connections is My Application Establishing to My MongoDB Cluster?</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><p><a href="https://www.mongodb.com/atlas/database">MongoDB Atlas</a> is the best way to host your MongoDB data, but it’s important to be aware that like any other managed service there can be limitations. For example, MongoDB Atlas - depending on the selected tier - will impose a <a href="https://www.mongodb.com/docs/atlas/reference/atlas-limits/#connection-limits-and-cluster-tier">connection limit</a>.</p><p>Depending on the architecture of your application and how you’ve configured your <a href="https://www.mongodb.com/docs/manual/administration/connection-pool-overview/">connection pools</a> it’s possible you’ve approached or exceeded these limits before and weren’t really sure why. Thankfully MongoDB Atlas provides a number of configurable alerts (such as <a href="https://www.mongodb.com/docs/atlas/reference/alert-conditions/#mongodb-alert-Connections---of-configured-limit-is"><code class="language-plaintext highlighter-rouge">Connections % of configured limit</code></a>) which can notify you if you’re approaching a limit, but where are these connections coming from in the first place?</p><h2 id="mongodb-drivers"><span class="me-2">MongoDB Drivers</span><a href="#mongodb-drivers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Your application has been built using one of <a href="https://www.mongodb.com/docs/drivers/">MongoDB’s Drivers</a>, which are all built according to a number of <a href="https://github.com/mongodb/specifications">published specifications</a>. Most noteworthy when it comes to how many connections an application may establish to a MongoDB cluster are the <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst">Server Monitoring</a> and <a href="https://github.com/mongodb/specifications/blob/master/source/connection-monitoring-and-pooling/connection-monitoring-and-pooling.rst">Connection Monitoring and Pooling</a> (CMAP) specifications.</p><p>These specifications help us understand how many connections may be opened, and what variables we should be aware of that can affect these connections such as:</p><ul><li>Is the MongoClient single-threaded or multi-threaded<li>The MongoDB Server version (&gt;= 4.4)<li>The MongoDB Driver version (does it support MongoDB Server 4.4+)</ul><p>Just a quick note regarding <em>Connection Pools</em>: the default value of <a href="https://github.com/mongodb/specifications/blob/master/source/connection-monitoring-and-pooling/connection-monitoring-and-pooling.rst#id1"><code class="language-plaintext highlighter-rouge">minPoolSize</code></a> is <code class="language-plaintext highlighter-rouge">0</code>, which means that using the defaults when a <em>Connection Pool</em> is created it will not contain any connections. For the purposes of this article I imply that at least one connection has been created in the pool and ready for use.</p><h3 id="single-threaded-mongoclient"><span class="me-2">Single-Threaded <code class="language-plaintext highlighter-rouge">MongoClient</code></span><a href="#single-threaded-mongoclient" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The MongoDB <a href="https://www.mongodb.com/docs/drivers/c/">C Driver</a> and <a href="https://www.mongodb.com/docs/drivers/php/">PHP Driver</a> provide single-threaded <code class="language-plaintext highlighter-rouge">MongoClient</code> implementations. As such, they do not offer connection pools at all which makes understanding how many connections can be established straightforward<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>.</p><p><a href=" /images/mongo-conns-01.png" class="popup img-link shimmer"><img src=" /images/mongo-conns-01.png" alt="" loading="lazy"></a> <em>Connections from a Single Threaded <code class="language-plaintext highlighter-rouge">MongoClient</code></em></p><p>With this configuration, a single connection (<code class="language-plaintext highlighter-rouge">c1</code>) will be established to each <a href="https://www.mongodb.com/docs/manual/core/replica-set-members/">replica set member</a>, or if the cluster is <a href="https://www.mongodb.com/docs/manual/sharding/">Sharded</a> each <a href="https://www.mongodb.com/docs/manual/core/sharded-cluster-query-router/"><code class="language-plaintext highlighter-rouge">mongos</code></a> present in the seed list when the <code class="language-plaintext highlighter-rouge">MongoClient</code> was created<sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>. This single connection will be used for data operations as well as to perform <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#single-threaded-monitoring">server monitoring</a>.</p><blockquote class="prompt-tip"><p>Note that when connecting to a Sharded Cluster using a <a href="https://www.mongodb.com/docs/manual/reference/connection-string/#dns-seed-list-connection-format">DNS Seed List</a> connection string, the <a href="https://github.com/mongodb/specifications/blob/master/source/initial-dns-seedlist-discovery/initial-dns-seedlist-discovery.rst#srvmaxhosts"><code class="language-plaintext highlighter-rouge">srvMaxHosts</code></a> URI option can be configured to limit the number of <code class="language-plaintext highlighter-rouge">mongos</code>’ that will be connected to.</p></blockquote><blockquote class="prompt-info"><p>Assuming a cluster with 3 nodes, each <code class="language-plaintext highlighter-rouge">MongoClient</code> instance would create 3 connections.</p></blockquote><h3 id="mongodb-server-42-and-earlier-polling-monitoring"><span class="me-2">MongoDB Server 4.2 and earlier (Polling Monitoring)</span><a href="#mongodb-server-42-and-earlier-polling-monitoring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Prior to MongoDB 4.4, MongoDB Drivers would use a <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#polling-protocol">polling protocol to perform server monitoring</a>. This process would involve opening a dedicated <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#monitor-thread">monitor thread</a> per host, which would be polled (by default<sup id="fnref:3"><a href="#fn:3" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>) every 10 seconds (multi-threaded) or 60 seconds (single-threaded) to determine if the state of the host or cluster topology had changed.</p><p><a href=" /images/mongo-conns-02.png" class="popup img-link shimmer"><img src=" /images/mongo-conns-02.png" alt="" loading="lazy"></a></p><p>This dedicated monitor thread (<code class="language-plaintext highlighter-rouge">m1</code>) as well as a the 1 or more connections in the connection pool (<code class="language-plaintext highlighter-rouge">p1</code>) result in at least 2 connections per host. Note that if <a href="https://www.mongodb.com/docs/manual/reference/connection-string/#mongodb-urioption-urioption.minPoolSize"><code class="language-plaintext highlighter-rouge">minPoolSize</code></a> (default: 0) is &gt; 1 this number of connections will <em>always</em> remain open against each host a connection pool has been created for.</p><blockquote class="prompt-info"><p>Assuming a cluster with 3 nodes, each <code class="language-plaintext highlighter-rouge">MongoClient</code> instance would create 6 connections.</p></blockquote><blockquote class="prompt-tip"><p>If <code class="language-plaintext highlighter-rouge">minPoolSize=5</code> then each <code class="language-plaintext highlighter-rouge">MongoClient</code> would create 18 connections (using the formula <code class="language-plaintext highlighter-rouge">(minPoolSize + 1) x nodes</code>)</p></blockquote><h3 id="mongodb-server-44-and-later-streaming-monitoring"><span class="me-2">MongoDB Server 4.4 and later (Streaming Monitoring)</span><a href="#mongodb-server-44-and-later-streaming-monitoring" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Starting with MongoDB 4.4, MongoDB Drivers would begin using a <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#streaming-protocol">streaming protocol to perform server monitoring</a> - assuming those Drivers were compatible with MongoDB 4.4. The goal of this new protocol was to ensure connected applications could discover topology changes in as close to realtime as possible.</p><p>As the polling protocol only polled at fixed intervals, it was possible for topology changes to go undiscovered for upwards of 10 seconds. The streaming protocol would “push” updates from the server to the clients, as opposed to the previous “pull” model, which allowed applications to update their view of the cluster far more quickly.</p><p><a href=" /images/mongo-conns-03.png" class="popup img-link shimmer"><img src=" /images/mongo-conns-03.png" alt="" loading="lazy"></a></p><p>Similar to the polling protocol, a dedicated monitor thread (<code class="language-plaintext highlighter-rouge">m1</code>) will be opened per host, as well as 1 or more connections in the connection pool (<code class="language-plaintext highlighter-rouge">p1</code>). Further to these connections though a third connection (<code class="language-plaintext highlighter-rouge">r1</code>) is opened per node for <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#measuring-rtt">measuring RTT</a> (round trip time). This is needed as the monitor thread is open and listening once established, and will only receive updates from the server as they occur. Measuring RTT require the measurement of the time taken for an operation to travel from the client to the server and back, which the streaming monitor no longer provides.</p><blockquote class="prompt-info"><p>Assuming a cluster with 3 nodes, each <code class="language-plaintext highlighter-rouge">MongoClient</code> instance would create 9 connections.</p></blockquote><blockquote class="prompt-tip"><p>If <code class="language-plaintext highlighter-rouge">minPoolSize=5</code> then each <code class="language-plaintext highlighter-rouge">MongoClient</code> would create 21 connections (using the formula <code class="language-plaintext highlighter-rouge">(minPoolSize + 2) x nodes</code>)</p></blockquote><h2 id="what-if-im-using-aws-lambda"><span class="me-2">What if I’m using AWS Lambda?</span><a href="#what-if-im-using-aws-lambda" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Depending on your application’s architecture, it’s possible to blow past your connection limits pretty quickly. This is one reason why the documented guidance for <a href="https://www.mongodb.com/docs/atlas/manage-connections-aws-lambda/">managing connections with AWS Lambda</a> has the first bullet point of <em>“Define the client to the MongoDB server outside the <a href="http://docs.aws.amazon.com/lambda/latest/dg/nodejs-prog-model-handler.html">AWS Lambda handler function</a>“</em>.</p><p>If each Lambda function were to connect to a MongoDB 4.4+ cluster using a connection string of <code class="language-plaintext highlighter-rouge">mongodb+srv://xxx.mongodb.net/?minPoolSize=5</code> and the cluster only had 3000 connections configured, within 150 near-concurrent function executions the cluster could potentially reach the connection limit! This is obviously an extreme scenario, but is meant to help illustrate the impact creating many <code class="language-plaintext highlighter-rouge">MongoClient</code> instances can potentially have on your cluster.</p><p>I plan on going into much more detail regarding AWS Lambda and MongoDB connection behavior in a future article.</p><hr /><p><strong>Footnotes</strong></p><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1"><p><small>The MongoDB C driver has two connection modes: single-threaded and <a href="https://mongoc.org/libmongoc/current/connection-pooling.html#pooled-mode">pooled</a>. Single-threaded mode is optimized for embedding the driver within languages like PHP. Multi-threaded programs should use pooled mode: this mode minimizes the total connection count, and in pooled mode background threads monitor the MongoDB server topology, so the program need not block to scan it.</small> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p><li id="fn:2"><p><small><code class="language-plaintext highlighter-rouge">MongoClient</code>s created using a <a href="https://www.mongodb.com/docs/manual/reference/connection-string/#dns-seed-list-connection-format">DNS Seed List</a> connection string can <a href="https://github.com/mongodb/specifications/blob/master/source/polling-srv-records-for-mongos-discovery/polling-srv-records-for-mongos-discovery.rst">poll the <code class="language-plaintext highlighter-rouge">SRV</code> record to discover additional <code class="language-plaintext highlighter-rouge">mongos</code>’</a></small> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p><li id="fn:3"><p><small>Polling interval can be configured via the <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#heartbeatfrequencyms"><code class="language-plaintext highlighter-rouge">heartbeatFrequencyMS</code></a> URI option, but must be more than the <a href="https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-monitoring.rst#minheartbeatfrequencyms"><code class="language-plaintext highlighter-rouge">minHeartbeatFrequencyMS</code></a> of 500ms. In MongoDB Atlas environments the <code class="language-plaintext highlighter-rouge">heartbeatFrequencyMS</code> is lowered from the default (10000) to 5000.</small> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/mongodb/">MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/connections/" class="post-tag no-text-decoration" >connections</a> <a href="/tags/drivers/" class="post-tag no-text-decoration" >drivers</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F&text=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Weibo" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <a href="https://bsky.app/intent/compose?text=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Bluesky" aria-label="Bluesky"> <i class="fa-fw fa-brands fa-bluesky"></i> </a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F&title=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit"> <i class="fa-fw fa-brands fa-square-reddit"></i> </a> <a href="https://www.threads.net/intent/post?text=How%20Many%20Connections%20is%20My%20Application%20Establishing%20to%20My%20MongoDB%20Cluster?%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2023%2F07%2F04%2Fhow-many-connections-is-my-application-establishing-to-my-mongodb-cluster%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Threads" aria-label="Threads"> <i class="fa-fw fa-brands fa-square-threads"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/2021/07/28/adventure-games-1980-1999/">Let's Adventure! A Journey into Adventure Games (1980-1999)</a><li class="text-truncate lh-lg"> <a href="/blog/2021/08/08/adventure-games-1980-1999-sorted-by-score/">Let's Adventure! Reviewed Games Sorted by Score</a><li class="text-truncate lh-lg"> <a href="/blog/2025/02/02/universe/">Universe (Core Design) - 1994</a><li class="text-truncate lh-lg"> <a href="/blog/2024/03/08/mongodb-and-load-balancer-support/">MongoDB and Load Balancer Support</a><li class="text-truncate lh-lg"> <a href="/blog/2024/12/30/return-of-the-phantom/">Return of the Phantom (MicroProse) - 1993</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/2024/04/26/event-monitoring-with-mongoose/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1714139932" data-df="ll" > Apr 26, 2024 </time><h4 class="pt-0 my-2">Event Monitoring with Mongoose</h4><div class="text-muted"><p>I previously wrote about MongoDB Driver Monitoring, but there are ODM libraries and framework integrations that are built atop the drivers that can take advantage of this functionality. For exampl...</p></div></div></a></article><article class="col"> <a href="/blog/2024/03/08/mongodb-and-load-balancer-support/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1709905045" data-df="ll" > Mar 8, 2024 </time><h4 class="pt-0 my-2">MongoDB and Load Balancer Support</h4><div class="text-muted"><p>Overview A load balancer enhances your application’s scalability, availability, and performance by efficiently distributing traffic across multiple servers based on a number of algorithms and tech...</p></div></div></a></article><article class="col"> <a href="/blog/2024/02/05/node-dot-js-driver-failing-to-connect-due-to-unsafe-legacy-renegotiation-disabled/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1707142013" data-df="ll" > Feb 5, 2024 </time><h4 class="pt-0 my-2">Node.js Driver failing to connect due to "unsafe legacy renegotiation disabled"</h4><div class="text-muted"><p>Overview In this community forum post there was a report of the MongoDB Node.js driver failing to connect with the following error: MongoServerSelectionError: C8320000:error:0A000152:SSL routi...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/2023/06/28/snatcher/" class="btn btn-outline-primary" aria-label="Older" ><p>Snatcher (Konami) - 1988</p></a> <a href="/blog/2023/07/31/tony-tough/" class="btn btn-outline-primary" aria-label="Newer" ><p>Tony Tough and the Night of Roasted Moths (Nayma Software, Prograph Research S.r.l.) - 1999</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/jrpg/">jrpg</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/'; this.page.identifier = '/blog/2023/07/04/how-many-connections-is-my-application-establishing-to-my-mongodb-cluster/'; }; function addDisqus() { let disqusThread = document.createElement('div'); let paragraph = document.createElement('p'); disqusThread.id = 'disqus_thread'; paragraph.className = 'text-center text-muted small'; paragraph.innerHTML = 'Comments powered by <a href="https://disqus.com/">Disqus</a>.'; disqusThread.appendChild(paragraph); const footer = document.querySelector('footer'); footer.insertAdjacentElement("beforebegin", disqusThread); }function reloadDisqus(event) { if (event.source === window && event.data && event.data.id === Theme.ID) {if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } addDisqus(); if (Theme.switchable) { addEventListener('message', reloadDisqus); }var disqusObserver = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); disqusObserver.disconnect(); } }, { threshold: [0] } ); disqusObserver.observe(document.getElementById('disqus_thread')); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
