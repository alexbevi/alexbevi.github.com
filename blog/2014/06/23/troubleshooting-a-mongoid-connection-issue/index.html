<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Troubleshooting a Mongoid Connection Issue" /><meta property="og:locale" content="en" /><meta name="description" content="I’ve been struggling with an issue for a while now regarding Mongoid connections just freezing when the host is not on localhost. I’ve tried posting this on stack overflow and GitHub, but haven’t really gotten anywhere." /><meta property="og:description" content="I’ve been struggling with an issue for a while now regarding Mongoid connections just freezing when the host is not on localhost. I’ve tried posting this on stack overflow and GitHub, but haven’t really gotten anywhere." /><link rel="canonical" href="https://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/" /><meta property="og:url" content="https://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2014-06-23T10:27:58-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Troubleshooting a Mongoid Connection Issue" /><meta name="twitter:site" content="@alexbevi" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-03-28T13:22:31-04:00","datePublished":"2014-06-23T10:27:58-04:00","description":"I’ve been struggling with an issue for a while now regarding Mongoid connections just freezing when the host is not on localhost. I’ve tried posting this on stack overflow and GitHub, but haven’t really gotten anywhere.","headline":"Troubleshooting a Mongoid Connection Issue","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/"},"url":"https://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/"}</script><title>Troubleshooting a Mongoid Connection Issue | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/bootstrap/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup/magnific-popup.css"> <script src="/assets/lib/jquery/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/images/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">ALEX BEVILACQUA</a></div><div class="site-subtitle font-italic">my little corner of the interwebs</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me"> <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer"> <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer"> <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer"> <i class="fab fa-reddit"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Troubleshooting a Mongoid Connection Issue</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Troubleshooting a Mongoid Connection Issue</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1403533678" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 23, 2014 </em> </span> <span> Updated <em class="" data-ts="1616952151" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 28, 2021 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3208 words"> <em>17 min</em> read </span></div></div></div><div class="post-content"><p>I’ve been struggling with an issue for a while now regarding Mongoid connections just freezing when the host is not on <em>localhost</em>. I’ve tried posting this on <a href="https://stackoverflow.com/questions/24210058/mongoid-4-mongodb-2-4-freezing-issue">stack overflow</a> and <a href="https://github.com/mongoid/moped/issues/274">GitHub</a>, but haven’t really gotten anywhere.</p><p>I’m now trying to dive into the issue using GDB directly, which I’m starting off following the <a href="http://blog.newrelic.com/2013/04/29/debugging-stuck-ruby-processes-what-to-do-before-you-kill-9/">NewRelic blog post</a> about debugging hung Ruby processes.</p><p>First, once the process is frozen, I connect using:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sudo gdb -p &lt;pid&gt;
</pre></table></code></div></div><p>and then tried to get some info from the C-level backtraces via:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(gdb) t a a bt
</pre></table></code></div></div><p>This resulted in a lot of information that didn’t really help me (at least not immediately):</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
</pre><td class="rouge-code"><pre>Thread 8 (Thread 0x7f032a5e1700 (LWP 9001)):
#0  0x00007f0329c0ffbd in poll () at ../sysdeps/unix/syscall-template.S:81
#1  0x00007f032a0d1d60 in timer_thread_sleep (gvl=0x1ed8f28) at thread_pthread.c:1381
#2  thread_timer (p=0x1ed8f28) at thread_pthread.c:1456
#3  0x00007f032990c182 in start_thread (arg=0x7f032a5e1700) at pthread_create.c:312
#4  0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 7 (Thread 0x7f032a4c0700 (LWP 9002)):
#0  sem_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/sem_wait.S:85
#1  0x00007f032495b75d in v8::internal::LinuxSemaphore::Wait() ()
   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
#2  0x00007f032486104c in v8::internal::RuntimeProfiler::WaitForSomeIsolateToEnterJS() ()
   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
#3  0x00007f032495b968 in v8::internal::SignalSender::Run() ()
   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
#4  0x00007f032495b86e in v8::internal::ThreadEntry(void*) ()
   from gems/ruby-2.1.1/extensions/x86_64-linux/2.1.0/therubyracer-0.12.1/v8/init.so
#5  0x00007f032990c182 in start_thread (arg=0x7f032a4c0700) at pthread_create.c:312
#6  0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 6 (Thread 0x7f0321988700 (LWP 9008)):
#0  0x00007f0329c14c33 in select () at ../sysdeps/unix/syscall-template.S:81
#1  0x00007f032a0d8cdb in rb_fd_select (n=&lt;optimized out&gt;, readfds=&lt;optimized out&gt;, writefds=&lt;optimized out&gt;, exceptfds=&lt;optimized out&gt;,
    timeout=&lt;optimized out&gt;) at thread.c:3321
#2  0x00007f032a0d9139 in native_fd_select (th=&lt;optimized out&gt;, timeout=0x7f0321987550, exceptfds=0x0, writefds=0x0, readfds=0x7f0321987810,
    n=12) at thread_pthread.c:1007
#3  do_select (timeout=0x7f0321987550, except=0x0, write=0x0, read=0x7f0321987810, n=12) at thread.c:3436
#4  rb_thread_fd_select (max=max@entry=12, read=read@entry=0x7f0321987810, write=write@entry=0x0, except=except@entry=0x0,
    timeout=timeout@entry=0x7f03219877e0) at thread.c:3582
#5  0x00007f0329f96150 in select_internal (fds=0x7f0321987810, tp=0x7f03219877e0, except=&lt;optimized out&gt;, write=&lt;optimized out&gt;,
    read=&lt;optimized out&gt;) at io.c:8232
#6  select_call (arg=arg@entry=139651425269744) at io.c:8302
#7  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f0329f95e30 &lt;select_call&gt;, data1=data1@entry=139651425269744,
    e_proc=e_proc@entry=0x7f0329f926a0 &lt;select_end&gt;, data2=data2@entry=139651425269744) at eval.c:850
#8  0x00007f0329f92810 in rb_f_select (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, obj=&lt;optimized out&gt;) at io.c:8651
#9  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321a88f20, th=0x96c91c0) at vm_insnhelper.c:1470
#10 vm_call_cfunc (th=0x96c91c0, reg_cfp=0x7f0321a88f20, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#11 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x96c91c0, initial=initial@entry=0) at insns.def:1028
#12 0x00007f032a0bb5ec in vm_exec (th=0x96c91c0) at vm.c:1304
#13 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x96c91c0, proc=0x96c9690, self=133280920, defined_class=117512440, argc=0,
    argv=0x7f1b228, blockptr=blockptr@entry=0x0) at vm.c:788
#14 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x96c91c0, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;,
    blockptr=blockptr@entry=0x0) at vm.c:807
#15 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x96c91c0, stack_start=&lt;optimized out&gt;) at thread.c:535
#16 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x96c91c0) at thread_pthread.c:803
#17 0x00007f032990c182 in start_thread (arg=0x7f0321988700) at pthread_create.c:312
#18 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 5 (Thread 0x7f0321786700 (LWP 9009)):
#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238
#1  0x00007f032a0d27ff in native_cond_timedwait (ts=&lt;optimized out&gt;, mutex=&lt;optimized out&gt;, cond=&lt;optimized out&gt;) at thread_pthread.c:352
#2  native_sleep (th=0x96c9870, timeout_tv=0x7f03217857c0) at thread_pthread.c:1061
#3  0x00007f032a0d55fa in sleep_timeval (th=0x96c9870, tv=..., spurious_check=spurious_check@entry=1) at thread.c:1046
#4  0x00007f032a0d57ba in rb_thread_wait_for (time=...) at thread.c:1115
#5  0x00007f0329ff27d0 in rb_f_sleep (argc=1, argv=0x7f0321787038) at process.c:4193
#6  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321886f70, th=0x96c9870) at vm_insnhelper.c:1470
#7  vm_call_cfunc (th=0x96c9870, reg_cfp=0x7f0321886f70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#8  0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x96c9870, initial=initial@entry=0) at insns.def:1028
#9  0x00007f032a0bb5ec in vm_exec (th=0x96c9870) at vm.c:1304
#10 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x96c9870, proc=0x96c9d90, self=133279880, defined_class=117256360, argc=0,
    argv=0x7f1afd0, blockptr=blockptr@entry=0x0) at vm.c:788
#11 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x96c9870, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;,
    blockptr=blockptr@entry=0x0) at vm.c:807
#12 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x96c9870, stack_start=&lt;optimized out&gt;) at thread.c:535
#13 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x96c9870) at thread_pthread.c:803
#14 0x00007f032990c182 in start_thread (arg=0x7f0321786700) at pthread_create.c:312
#15 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 4 (Thread 0x7f0321584700 (LWP 9010)):
#0  0x00007f0329c14c33 in select () at ../sysdeps/unix/syscall-template.S:81
#1  0x00007f032a0d8cdb in rb_fd_select (n=&lt;optimized out&gt;, readfds=&lt;optimized out&gt;, writefds=&lt;optimized out&gt;, exceptfds=&lt;optimized out&gt;,
    timeout=&lt;optimized out&gt;) at thread.c:3321
#2  0x00007f032a0d9139 in native_fd_select (th=&lt;optimized out&gt;, timeout=0x0, exceptfds=0x0, writefds=0x0, readfds=0x7f0321583810, n=11)
    at thread_pthread.c:1007
#3  do_select (timeout=0x0, except=0x0, write=0x0, read=0x7f0321583810, n=11) at thread.c:3436
#4  rb_thread_fd_select (max=max@entry=11, read=read@entry=0x7f0321583810, write=write@entry=0x0, except=except@entry=0x0,
    timeout=timeout@entry=0x0) at thread.c:3582
#5  0x00007f0329f96150 in select_internal (fds=0x7f0321583810, tp=0x0, except=&lt;optimized out&gt;, write=&lt;optimized out&gt;, read=&lt;optimized out&gt;)
    at io.c:8232
#6  select_call (arg=arg@entry=139651421059056) at io.c:8302
#7  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f0329f95e30 &lt;select_call&gt;, data1=data1@entry=139651421059056,
    e_proc=e_proc@entry=0x7f0329f926a0 &lt;select_end&gt;, data2=data2@entry=139651421059056) at eval.c:850
#8  0x00007f0329f92810 in rb_f_select (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, obj=&lt;optimized out&gt;) at io.c:8651
#9  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321684f20, th=0x96c9f10) at vm_insnhelper.c:1470
#10 vm_call_cfunc (th=0x96c9f10, reg_cfp=0x7f0321684f20, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#11 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x96c9f10, initial=initial@entry=0) at insns.def:1028
#12 0x00007f032a0bb5ec in vm_exec (th=0x96c9f10) at vm.c:1304
#13 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x96c9f10, proc=0x96ec480, self=133126360, defined_class=118126960, argc=0,
    argv=0x7f1adf0, blockptr=blockptr@entry=0x0) at vm.c:788
#14 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x96c9f10, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;,
    blockptr=blockptr@entry=0x0) at vm.c:807
#15 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x96c9f10, stack_start=&lt;optimized out&gt;) at thread.c:535
#16 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x96c9f10) at thread_pthread.c:803
#17 0x00007f032990c182 in start_thread (arg=0x7f0321584700) at pthread_create.c:312
#18 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 3 (Thread 0x7f0321180700 (LWP 9472)):
#0  0x00007f0329c1007f in __GI_ppoll (fds=fds@entry=0x7f032117bb90, nfds=nfds@entry=1, timeout=&lt;optimized out&gt;, timeout@entry=0x0,
    sigmask=sigmask@entry=0x0) at ../sysdeps/unix/sysv/linux/ppoll.c:56
#1  0x00007f032a0d9b28 in rb_wait_for_single_fd (fd=fd@entry=15, events=events@entry=1, tv=tv@entry=0x0) at thread.c:3656
#2  0x00007f032a0da044 in rb_thread_wait_fd_rw (read=1, fd=fd@entry=15) at thread.c:3495
#3  rb_thread_wait_fd (fd=fd@entry=15) at thread.c:3506
#4  0x00007f0329f9693f in rb_io_wait_readable (f=15) at io.c:1092
#5  0x00007f0329f97cee in io_bufread (ptr=0x7f03042c3440 "", len=36, fptr=0x7f0310054420) at io.c:2035
#6  0x00007f0329f97e24 in bufread_call (arg=arg@entry=139651416833616) at io.c:2071
#7  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f0329f97e10 &lt;bufread_call&gt;, data1=data1@entry=139651416833616,
    e_proc=e_proc@entry=0x7f032a04f900 &lt;rb_str_unlocktmp&gt;, data2=&lt;optimized out&gt;) at eval.c:850
#8  0x00007f032a05e8db in rb_str_locktmp_ensure (str=&lt;optimized out&gt;, func=func@entry=0x7f0329f97e10 &lt;bufread_call&gt;,
    arg=arg@entry=139651416833616) at string.c:2004
#9  0x00007f0329f9ad06 in io_fread (fptr=0x7f0310054420, size=36, offset=0, str=139650673747040) at io.c:2085
#10 io_read (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, io=35833440) at io.c:2816
#11 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127e770, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#12 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127e770, th=0x7f030c0455c0) at vm_insnhelper.c:1560
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#13 vm_call_method (th=0x7f030c0455c0, cfp=0x7f032127e770, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754
#14 0x00007f032a0b7b9c in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1050
#15 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304
#16 0x00007f032a0c2cff in invoke_block_from_c (defined_class=79426520, cref=0x0, blockptr=0x0, argv=0x7f032117c2e8, argc=1, self=72558880,
    block=&lt;optimized out&gt;, th=0x7f030c0455c0) at vm.c:732
#17 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763
#18 rb_yield_0 (argv=0x7f032117c2e8, argc=1) at vm_eval.c:938
#19 rb_yield (val=&lt;optimized out&gt;) at vm_eval.c:948
#20 0x00007f0329f1d4bd in rb_ary_collect (ary=139650673749800) at array.c:2684
#21 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127ea90, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#22 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127ea90, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#23 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999
#24 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304
#25 0x00007f032a0c2cff in invoke_block_from_c (defined_class=80043920, cref=0x0, blockptr=0x0, argv=0x7f032117c6c8, argc=1,
    self=139650673695240, block=&lt;optimized out&gt;, th=0x7f030c0455c0) at vm.c:732
#26 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763
#27 rb_yield_0 (argv=0x7f032117c6c8, argc=1) at vm_eval.c:938
#28 rb_yield (val=&lt;optimized out&gt;) at vm_eval.c:948
#29 0x00007f0329f15fa2 in rb_ary_each (array=139650673713080) at array.c:1792
#30 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f170, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#31 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127f170, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#32 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999
#33 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#34 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f0304886b90, self=139650673713320, defined_class=78042600,
    argc=argc@entry=0, argv=argv@entry=0x7f0321182020, blockptr=0x0) at vm.c:788
#35 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f0304886b90, argc=argc@entry=0,
    argv=argv@entry=0x7f0321182020, blockptr=&lt;optimized out&gt;) at vm.c:807
#36 0x00007f0329f6e550 in proc_call (argc=0, argv=0x7f0321182020, procval=139650673713160) at proc.c:734
#37 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f300, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#38 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127f300, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#39 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028
#40 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#41 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x7f030c0455c0, proc=0x9676cb0, self=139650673658200, defined_class=79743600, argc=1,
    argv=argv@entry=0x7f032117d0a0, blockptr=0x0) at vm.c:788
#42 0x00007f032a0bea45 in vm_call_bmethod_body (argv=0x7f032117d0a0, ci=0x7f032117d280, th=0x7f030c0455c0) at vm_insnhelper.c:1592
#43 vm_call_bmethod (th=th@entry=0x7f030c0455c0, cfp=cfp@entry=0x7f032127f7b0, ci=ci@entry=0x7f032117d280) at vm_insnhelper.c:1607
#44 0x00007f032a0bfc1e in vm_call_method (th=th@entry=0x7f030c0455c0, cfp=cfp@entry=0x7f032127f7b0, ci=ci@entry=0x7f032117d280)
    at vm_insnhelper.c:1774
#45 0x00007f032a0bf691 in vm_call_opt_send (th=0x7f030c0455c0, reg_cfp=0x7f032127f7b0, ci=0x7f032117d280) at vm_insnhelper.c:1657
#46 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028
#47 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#48 0x00007f032a0bec82 in vm_yield_with_cref (cref=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=0x7f030c0455c0) at vm.c:755
#49 yield_under (under=&lt;optimized out&gt;, self=&lt;optimized out&gt;, values=139650673660760) at vm_eval.c:1531
#50 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f9e0, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#51 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127f9e0, th=0x7f030c0455c0) at vm_insnhelper.c:1560
#52 vm_call_method (th=0x7f030c0455c0, cfp=0x7f032127f9e0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754
#53 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999
#54 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#55 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f030010a480, self=83224000, defined_class=87087200,
    argc=argc@entry=2, argv=argv@entry=0x7f0321181c90, blockptr=0x0) at vm.c:788
#56 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f030010a480, argc=argc@entry=2,
    argv=argv@entry=0x7f0321181c90, blockptr=&lt;optimized out&gt;) at vm.c:807
#57 0x00007f0329f6e550 in proc_call (argc=2, argv=0x7f0321181c90, procval=139651130810120) at proc.c:734
#58 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fa80, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#59 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127fa80, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#60 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028
#61 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#62 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f030010a560, self=87087800, defined_class=87087760,
    argc=argc@entry=1, argv=argv@entry=0x7f0321181c38, blockptr=0x0) at vm.c:788
#63 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f030010a560, argc=argc@entry=1,
    argv=argv@entry=0x7f0321181c38, blockptr=&lt;optimized out&gt;) at vm.c:807
#64 0x00007f0329f6e550 in proc_call (argc=1, argv=0x7f0321181c38, procval=139651130809960) at proc.c:734
#65 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fb20, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#66 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fb20, th=0x7f030c0455c0) at vm_insnhelper.c:1560
#67 vm_call_method (th=0x7f030c0455c0, cfp=0x7f032127fb20, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754
#68 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028
#69 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#70 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f030010a720, self=87087800, defined_class=87087760,
    argc=argc@entry=1, argv=argv@entry=0x7f0321181be0, blockptr=0x0) at vm.c:788
#71 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f030010a720, argc=argc@entry=1,
    argv=argv@entry=0x7f0321181be0, blockptr=&lt;optimized out&gt;) at vm.c:807
#72 0x00007f0329f6e550 in proc_call (argc=1, argv=0x7f0321181be0, procval=139651130809560) at proc.c:734
#73 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032127fbc0, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#74 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f032127fbc0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#75 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028
#76 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#77 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x7f0304529c40, self=156831200, defined_class=50567600,
    argc=argc@entry=1, argv=argv@entry=0x7f0321181990, blockptr=0x0) at vm.c:788
#78 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x7f0304529c40, argc=argc@entry=1,
    argv=argv@entry=0x7f0321181990, blockptr=&lt;optimized out&gt;) at vm.c:807
#79 0x00007f0329f6e550 in proc_call (argc=1, argv=0x7f0321181990, procval=139650673670240) at proc.c:734
#80 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321280070, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#81 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f0321280070, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#82 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:1028
#83 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304
#84 0x00007f032a0c2cff in invoke_block_from_c (defined_class=76547880, cref=0x0, blockptr=0x0, argv=0x7f032117ee08, argc=1, self=34415960,
    block=&lt;optimized out&gt;, th=0x7f030c0455c0) at vm.c:732
#85 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763
#86 rb_yield_0 (argv=0x7f032117ee08, argc=1) at vm_eval.c:938
#87 rb_yield (val=&lt;optimized out&gt;) at vm_eval.c:948
#88 0x00007f0329f15fa2 in rb_ary_each (array=139650673629520) at array.c:1792
#89 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f03212801b0, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#90 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f03212801b0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#91 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999
#92 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x7f030c0455c0) at vm.c:1304
#93 0x00007f032a0c2924 in invoke_block_from_c (defined_class=80036240, cref=0x0, blockptr=0x0, argv=0x7f032117f1c8, argc=1, self=120753520,
    block=&lt;optimized out&gt;, th=0x7f030c0455c0) at vm.c:732
#94 vm_yield (argv=0x7f032117f1c8, argc=1, th=0x7f030c0455c0) at vm.c:763
#95 rb_yield_0 (argv=0x7f032117f1c8, argc=1) at vm_eval.c:938
#96 catch_i (tag=&lt;optimized out&gt;, data=data@entry=0) at vm_eval.c:1772
#97 0x00007f032a0b4b4a in rb_catch_protect (t=&lt;optimized out&gt;, func=func@entry=0x7f032a0c26c0 &lt;catch_i&gt;, data=data@entry=0,
    stateptr=stateptr@entry=0x7f032117f340) at vm_eval.c:1858
#98 0x00007f032a0b4bbc in rb_catch_obj (t=&lt;optimized out&gt;, func=func@entry=0x7f032a0c26c0 &lt;catch_i&gt;, data=data@entry=0) at vm_eval.c:1837
#99 0x00007f032a0b4c6e in rb_f_catch (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at vm_eval.c:1823
#100 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f03212802f0, th=0x7f030c0455c0) at vm_insnhelper.c:1470
#101 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f03212802f0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#102 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999
#103 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#104 0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0455c0, proc=proc@entry=0x96c8680, self=133126360, defined_class=118126960,
    argc=argc@entry=2, argv=argv@entry=0x7f0321181070, blockptr=0x0) at vm.c:788
#105 0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x96c8680, argc=argc@entry=2,
    argv=argv@entry=0x7f0321181070, blockptr=&lt;optimized out&gt;) at vm.c:807
#106 0x00007f0329f6e550 in proc_call (argc=2, argv=0x7f0321181070, procval=133281320) at proc.c:734
#107 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f0321280f70, th=0x7f030c0455c0) at vm_insnhelper.c:1470
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---
#108 vm_call_cfunc (th=0x7f030c0455c0, reg_cfp=0x7f0321280f70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#109 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0455c0, initial=initial@entry=0) at insns.def:999
#110 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0455c0) at vm.c:1304
#111 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x7f030c0455c0, proc=0x7f030c044ca0, self=133281640, defined_class=117256680, argc=0,
    argv=0x7f02f4c943a0, blockptr=blockptr@entry=0x0) at vm.c:788
#112 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x7f030c0455c0, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;,
    blockptr=blockptr@entry=0x0) at vm.c:807
#113 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x7f030c0455c0, stack_start=&lt;optimized out&gt;) at thread.c:535
#114 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x7f030c0455c0) at thread_pthread.c:803
#115 0x00007f032990c182 in start_thread (arg=0x7f0321180700) at pthread_create.c:312
#116 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 2 (Thread 0x7f0320f7e700 (LWP 9563)):
#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185
#1  0x00007f032a0d6ce3 in native_cond_wait (mutex=0x8ef42b0, cond=0x8ef42d8) at thread_pthread.c:334
#2  lock_func (timeout_ms=0, mutex=0x8ef42b0, th=0x7f030c0485d0) at thread.c:4324
#3  rb_mutex_lock (self=120765160) at thread.c:4398
#4  0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032107ebb0, th=0x7f030c0485d0) at vm_insnhelper.c:1470
#5  vm_call_cfunc (th=0x7f030c0485d0, reg_cfp=0x7f032107ebb0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#6  0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x7f030c0485d0, initial=initial@entry=0) at insns.def:1028
#7  0x00007f032a0bb5ec in vm_exec (th=0x7f030c0485d0) at vm.c:1304
#8  0x00007f032a0be89f in vm_invoke_proc (th=0x7f030c0485d0, proc=proc@entry=0x96c8680, self=133126360, defined_class=118126960,
    argc=argc@entry=2, argv=argv@entry=0x7f0320f7f070, blockptr=0x0) at vm.c:788
#9  0x00007f032a0be8da in rb_vm_invoke_proc (th=&lt;optimized out&gt;, proc=proc@entry=0x96c8680, argc=argc@entry=2,
    argv=argv@entry=0x7f0320f7f070, blockptr=&lt;optimized out&gt;) at vm.c:807
#10 0x00007f0329f6e550 in proc_call (argc=2, argv=0x7f0320f7f070, procval=133281320) at proc.c:734
#11 0x00007f032a0b3024 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032107ef70, th=0x7f030c0485d0) at vm_insnhelper.c:1470
#12 vm_call_cfunc (th=0x7f030c0485d0, reg_cfp=0x7f032107ef70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1560
#13 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x7f030c0485d0, initial=initial@entry=0) at insns.def:999
#14 0x00007f032a0bb5ec in vm_exec (th=0x7f030c0485d0) at vm.c:1304
#15 0x00007f032a0be89f in vm_invoke_proc (th=th@entry=0x7f030c0485d0, proc=0x7f030c047b40, self=133281640, defined_class=117256680, argc=0,
    argv=0x7f02f4cd2290, blockptr=blockptr@entry=0x0) at vm.c:788
#16 0x00007f032a0be8da in rb_vm_invoke_proc (th=th@entry=0x7f030c0485d0, proc=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;,
    blockptr=blockptr@entry=0x0) at vm.c:807
#17 0x00007f032a0d475d in thread_start_func_2 (th=th@entry=0x7f030c0485d0, stack_start=&lt;optimized out&gt;) at thread.c:535
#18 0x00007f032a0d4a9b in thread_start_func_1 (th_ptr=0x7f030c0485d0) at thread_pthread.c:803
#19 0x00007f032990c182 in start_thread (arg=0x7f0320f7e700) at pthread_create.c:312
#20 0x00007f0329c1d30d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111

Thread 1 (Thread 0x7f032a5c2740 (LWP 8999)):
#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185
#1  0x00007f032a0d2390 in native_cond_wait (mutex=0x1ed96d0, cond=&lt;optimized out&gt;) at thread_pthread.c:334
#2  native_sleep (th=th@entry=0x1ed95b0, timeout_tv=0x0) at thread_pthread.c:1059
#3  0x00007f032a0d618a in sleep_forever (deadlockable=1, spurious_check=0, th=0x1ed95b0) at thread.c:996
#4  thread_join_sleep (arg=arg@entry=140734195440096) at thread.c:787
#5  0x00007f0329f67d97 in rb_ensure (b_proc=b_proc@entry=0x7f032a0d6090 &lt;thread_join_sleep&gt;, data1=data1@entry=140734195440096,
    e_proc=e_proc@entry=0x7f032a0cfa10 &lt;remove_from_join_list&gt;, data2=data2@entry=140734195440096) at eval.c:850
#6  0x00007f032a0d0cd0 in thread_join (delay=&lt;optimized out&gt;, target_th=0x96c9f10) at thread.c:829
#7  thread_join_m (argc=&lt;optimized out&gt;, argv=0x7f032a4c1168, self=&lt;optimized out&gt;) at thread.c:909
#8  0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0ca0, th=0x1ed95b0) at vm_insnhelper.c:1470
#9  vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0ca0, th=0x1ed95b0) at vm_insnhelper.c:1560
#10 vm_call_method (th=0x1ed95b0, cfp=0x7f032a5c0ca0, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754
#11 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x1ed95b0, initial=initial@entry=0) at insns.def:1028
#12 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x1ed95b0) at vm.c:1304
#13 0x00007f032a0c2cff in invoke_block_from_c (defined_class=51649880, cref=0x0, blockptr=0x0, argv=0x7fff3bba1e08, argc=1, self=51647880,
    block=&lt;optimized out&gt;, th=0x1ed95b0) at vm.c:732
#14 vm_yield (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;, th=&lt;optimized out&gt;) at vm.c:763
#15 rb_yield_0 (argv=0x7fff3bba1e08, argc=1) at vm_eval.c:938
#16 rb_yield (val=val@entry=52428600) at vm_eval.c:948
#17 0x00007f0329fcb079 in rb_obj_tap (obj=52428600) at object.c:675
#18 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0e30, th=0x1ed95b0) at vm_insnhelper.c:1470
#19 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0e30, th=0x1ed95b0) at vm_insnhelper.c:1560
#20 vm_call_method (th=0x1ed95b0, cfp=0x7f032a5c0e30, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754
#21 0x00007f032a0b8385 in vm_exec_core (th=th@entry=0x1ed95b0, initial=initial@entry=0) at insns.def:999
#22 0x00007f032a0bb5ec in vm_exec (th=0x1ed95b0) at vm.c:1304
#23 0x00007f032a0c43c9 in rb_iseq_eval (iseqval=&lt;optimized out&gt;) at vm.c:1549
#24 0x00007f0329f6a630 in rb_load_internal0 (th=0x1ed95b0, fname=52100160, wrap=wrap@entry=0) at load.c:615
#25 0x00007f0329f6bdde in rb_load_internal (wrap=0, fname=&lt;optimized out&gt;) at load.c:644
#26 rb_require_safe (fname=52099680, safe=0) at load.c:996
#27 0x00007f032a0bfae1 in vm_call_cfunc_with_frame (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0f70, th=0x1ed95b0) at vm_insnhelper.c:1470
#28 vm_call_cfunc (ci=&lt;optimized out&gt;, reg_cfp=0x7f032a5c0f70, th=0x1ed95b0) at vm_insnhelper.c:1560
#29 vm_call_method (th=0x1ed95b0, cfp=0x7f032a5c0f70, ci=&lt;optimized out&gt;) at vm_insnhelper.c:1754
#30 0x00007f032a0b7a44 in vm_exec_core (th=th@entry=0x1ed95b0, initial=initial@entry=0) at insns.def:1028
#31 0x00007f032a0bb5ec in vm_exec (th=th@entry=0x1ed95b0) at vm.c:1304
#32 0x00007f032a0c4636 in rb_iseq_eval_main (iseqval=iseqval@entry=52095080) at vm.c:1562
#33 0x00007f0329f6510a in ruby_exec_internal (n=0x31ae868) at eval.c:253
#34 0x00007f0329f670ad in ruby_exec_node (n=n@entry=0x31ae868) at eval.c:318
#35 0x00007f0329f694dc in ruby_run_node (n=0x31ae868) at eval.c:310
#36 0x000000000040088b in main (argc=3, argv=0x7fff3bba2b88) at main.c:36
</pre></table></code></div></div><p>I then thought I might get a bit more info if I dumped the current Ruby backtrace:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>(gdb) call (void) close(1)
(gdb) call (void) close(2)
(gdb) shell tty
/dev/pts/15 &lt;--- this will likely be different on your machine
(gdb) call (int) open("/dev/pts/15", 2, 0)
$1 = 1
(gdb) call (int) open("/dev/pts/15", 2, 0)
$2 = 2
(gdb) call (void)rb_backtrace()
</pre></table></code></div></div><p>This now shows me what’s going on inside my Ruby process:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
</pre><td class="rouge-code"><pre>  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/thread_pool.rb:92:in `block in spawn_thread'
  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/thread_pool.rb:92:in `call'
  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/server.rb:254:in `block in run'
  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/server.rb:361:in `process_client'
  gems/ruby-2.1.1/gems/puma-2.8.2/lib/puma/server.rb:490:in `handle_request'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/content_length.rb:14:in `call'
  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/application.rb:144:in `call'
  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/engine.rb:514:in `call'
  gems/ruby-2.1.1/gems/airbrake-4.0.0/lib/airbrake/user_informer.rb:12:in `call'
  gems/ruby-2.1.1/gems/airbrake-4.0.0/lib/airbrake/user_informer.rb:16:in `_call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/sendfile.rb:112:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/static.rb:64:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/lock.rb:17:in `call'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/runtime.rb:17:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/methodoverride.rb:21:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/request_id.rb:21:in `call'
  gems/ruby-2.1.1/gems/quiet_assets-1.0.2/lib/quiet_assets.rb:18:in `call_with_quiet_assets'
  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/rack/logger.rb:20:in `call'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/tagged_logging.rb:68:in `tagged'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/tagged_logging.rb:26:in `tagged'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/tagged_logging.rb:68:in `block in tagged'
  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/rack/logger.rb:20:in `block in call'
  gems/ruby-2.1.1/gems/railties-4.1.1/lib/rails/rack/logger.rb:38:in `call_app'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  gems/ruby-2.1.1/gems/airbrake-4.0.0/lib/airbrake/rails/middleware.rb:13:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/reloader.rb:73:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:82:in `run_callbacks'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/cookies.rb:560:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/session/abstract/id.rb:220:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/session/abstract/id.rb:225:in `context'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/flash.rb:254:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/head.rb:11:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/conditionalget.rb:25:in `call'
  gems/ruby-2.1.1/gems/rack-1.5.2/lib/rack/etag.rb:23:in `call'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/manager.rb:34:in `call'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/manager.rb:34:in `catch'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/manager.rb:35:in `block in call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:676:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/journey/router.rb:59:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/journey/router.rb:59:in `each'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/journey/router.rb:71:in `block in call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:48:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:80:in `dispatch'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_dispatch/routing/route_set.rb:80:in `call'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal.rb:231:in `block in action'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal.rb:195:in `dispatch'
  gems/ruby-2.1.1/gems/actionview-4.1.1/lib/action_view/rendering.rb:30:in `process'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/abstract_controller/base.rb:136:in `process'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `instrument'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `block in instrument'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/action_controller/metal/rescue.rb:29:in `process_action'
  gems/ruby-2.1.1/gems/actionpack-4.1.1/lib/abstract_controller/callbacks.rb:19:in `process_action'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:86:in `run_callbacks'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:86:in `call'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:166:in `block in halting'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:166:in `call'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:160:in `block in halting'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:160:in `call'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:440:in `block in make_lambda'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/callbacks.rb:440:in `instance_exec'
  gems/ruby-2.1.1/gems/mongoid_userstamp-0.3.2/lib/mongoid/userstamp/railtie.rb:15:in `block (2 levels) in &lt;class:Railtie&gt;'
  gems/ruby-2.1.1/gems/devise-3.2.4/lib/devise/controllers/helpers.rb:58:in `current_user'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/proxy.rb:104:in `authenticate'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/proxy.rb:318:in `_perform_authentication'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/proxy.rb:212:in `user'
  gems/ruby-2.1.1/gems/warden-1.2.3/lib/warden/session_serializer.rb:34:in `fetch'
  gems/ruby-2.1.1/gems/devise-3.2.4/lib/devise.rb:462:in `block (2 levels) in configure_warden!'
  gems/ruby-2.1.1/gems/devise-3.2.4/lib/devise/models/authenticatable.rb:208:in `serialize_from_session'
  gems/ruby-2.1.1/gems/orm_adapter-0.5.0/lib/orm_adapter/adapters/mongoid.rb:22:in `get'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual.rb:20:in `first'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:197:in `first'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:447:in `try_cache'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:198:in `block in first'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:535:in `with_sorting'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/contextual/mongo.rb:199:in `block (2 levels) in first'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/query_cache.rb:186:in `first_with_cache'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/query_cache.rb:135:in `with_cache'
  gems/ruby-2.1.1/bundler/gems/mongoid-49bc68fd3011/lib/mongoid/query_cache.rb:187:in `block in first_with_cache'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/query.rb:127:in `first'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/primary.rb:54:in `with_node'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/selectable.rb:65:in `with_retry'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/selectable.rb:65:in `call'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/read_preference/primary.rb:55:in `block in with_node'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:240:in `with_primary'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:151:in `nodes'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:194:in `refresh'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:194:in `each'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/cluster.rb:182:in `block in refresh'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:432:in `refresh'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:90:in `command'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:648:in `read'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/operation/read.rb:48:in `execute'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:391:in `process'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:587:in `flush'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:616:in `logging'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/instrumentable.rb:31:in `instrument'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `instrument'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  gems/ruby-2.1.1/gems/activesupport-4.1.1/lib/active_support/notifications.rb:159:in `block in instrument'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:617:in `block in logging'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:589:in `block in flush'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:187:in `ensure_connected'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:184:in `rescue in ensure_connected'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/failover/retry.rb:29:in `execute'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:114:in `connection'
  gems/ruby-2.1.1/gems/connection_pool-2.0.0/lib/connection_pool.rb:58:in `with'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:115:in `block in connection'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/failover/retry.rb:30:in `block in execute'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/node.rb:590:in `block (2 levels) in flush'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection.rb:172:in `write'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection.rb:220:in `with_connection'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection.rb:52:in `connect'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:144:in `connect'
  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:106:in `timeout'
  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:35:in `catch'
  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:35:in `catch'
  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:35:in `block in catch'
  rubies/ruby-2.1.1/lib/ruby/2.1.0/timeout.rb:91:in `block in timeout'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:145:in `block in connect'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:145:in `new'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/tcp.rb:20:in `initialize'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/connectable.rb:119:in `handle_socket_errors'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/tcp.rb:20:in `block in initialize'
  gems/ruby-2.1.1/bundler/gems/moped-074ba070aa98/lib/moped/connection/socket/tcp.rb:20:in `initialize'
</pre></table></code></div></div><p>Looks like the whole think started with a <a href="https://github.com/mongoid/moped">moped</a> socket connection (which makes sense).</p><p>Investigating further …</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/mongodb/'>MongoDB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/mongoid/" class="post-tag no-text-decoration" >mongoid</a> <a href="/tags/rails/" class="post-tag no-text-decoration" >rails</a> <a href="/tags/ruby/" class="post-tag no-text-decoration" >ruby</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Troubleshooting%20a%20Mongoid%20Connection%20Issue%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2014%2F06%2F23%2Ftroubleshooting-a-mongoid-connection-issue%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Troubleshooting%20a%20Mongoid%20Connection%20Issue%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2014%2F06%2F23%2Ftroubleshooting-a-mongoid-connection-issue%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2014%2F06%2F23%2Ftroubleshooting-a-mongoid-connection-issue%2F&text=Troubleshooting%20a%20Mongoid%20Connection%20Issue%20-%20ALEX%20BEVILACQUA" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2014%2F06%2F23%2Ftroubleshooting-a-mongoid-connection-issue%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Troubleshooting%20a%20Mongoid%20Connection%20Issue%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2014%2F06%2F23%2Ftroubleshooting-a-mongoid-connection-issue%2F" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2021/07/28/adventure-games-1980-1999/">Journey into Adventure Games (1980-1999)</a><li><a href="/blog/2021/08/08/adventure-games-1980-1999-sorted-by-score/">Adventure Games (1980-1999): Sorted by Score</a><li><a href="/blog/2023/04/11/deja-vu/">Déjà Vu: A Nightmare Comes True (ICOM Simulations) - 1985</a><li><a href="/blog/2014/10/17/just-finished-robotrek/">Just Finished - Robotrek</a><li><a href="/blog/2015/06/10/just-finished-breath-of-fire/">Just Finished - Breath of Fire</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/adventure/">adventure</a> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/redmine/">redmine</a> <a class="post-tag" href="/tags/rpg/">rpg</a> <a class="post-tag" href="/tags/ruby/">ruby</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag" href="/tags/jrpg/">jrpg</a> <a class="post-tag" href="/tags/snes/">snes</a> <a class="post-tag" href="/tags/linux/">linux</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2022/09/09/performance-profiling-a-mongoid-issue-using-appprofiler/"><div class="card-body"> <em class="small" data-ts="1662720061" data-df="ll" > Sep 9, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Performance Profiling a Mongoid Issue Using AppProfiler</h3><div class="text-muted small"><p> In MONGOID-4889 the claim was made that assignment of a large number of embedded documents to an instance of a model will take increasingly longer as the size of the list of documents to embed grow...</p></div></div></a></div><div class="card"> <a href="/blog/2021/03/26/analysis-and-optimization-of-an-n-plus-1-scenario-in-mongoid/"><div class="card-body"> <em class="small" data-ts="1616764569" data-df="ll" > Mar 26, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Analysis and Optimization of an N+1 Scenario in Mongoid</h3><div class="text-muted small"><p> The N + 1 queries problem is a common issue Rails applications face whereby iterating an array of models and accessing an association results in a sub-optimal pattern of recurring queries. To addr...</p></div></div></a></div><div class="card"> <a href="/blog/2022/08/18/why-use-mongodb-with-ruby/"><div class="card-body"> <em class="small" data-ts="1660836207" data-df="ll" > Aug 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Why Use MongoDB with Ruby</h3><div class="text-muted small"><p> Cross posted from the MongoDB Developer Center Before discovering Ruby and Ruby on Rails I was a .NET developer. At that time I’d make ad-hoc changes to my development database, export my tabl...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2014/06/02/accessing-stdout-of-a-running-process/" class="btn btn-outline-primary" prompt="Older"><p>Accessing a running process' STDOUT</p></a> <a href="/blog/2014/07/07/subversion-plus-ruby-on-heroku-via-buildpacks/" class="btn btn-outline-primary" prompt="Newer"><p>Subversion + Ruby on Heroku via Buildpacks</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/'; this.page.identifier = '/blog/2014/06/23/troubleshooting-a-mongoid-connection-issue/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/adventure/">adventure</a> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/redmine/">redmine</a> <a class="post-tag" href="/tags/rpg/">rpg</a> <a class="post-tag" href="/tags/ruby/">ruby</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag" href="/tags/jrpg/">jrpg</a> <a class="post-tag" href="/tags/snes/">snes</a> <a class="post-tag" href="/tags/linux/">linux</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/lib/magnific-popup/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/lazysizes/lazysizes.min.js"></script> <script src="/assets/lib/clipboard/clipboard.min.js"></script> <script src="/assets/lib/dayjs/dayjs.min.js"></script> <script src="/assets/lib/dayjs/locale/en.min.js"></script> <script src="/assets/lib/dayjs/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/lib/bootstrap/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
