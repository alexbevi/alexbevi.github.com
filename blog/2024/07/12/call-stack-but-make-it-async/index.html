<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Call Stack, But Make It Async!" /><meta name="author" content="Neal Beeken" /><meta property="og:locale" content="en" /><meta name="description" content="Written by Neal Beeken (Blog, GitHub) - Canonical URL is at medium.com" /><meta property="og:description" content="Written by Neal Beeken (Blog, GitHub) - Canonical URL is at medium.com" /><link rel="canonical" href="https://medium.com/@MongoDB/call-stack-but-make-it-async-f912cb895ebd" /><meta property="og:url" content="https://medium.com/@MongoDB/call-stack-but-make-it-async-f912cb895ebd" /><meta property="og:site_name" content="ALEX BEVILACQUA" /><meta property="og:image" content=" https://www.alexbevi.com/images/nodejs-banner.jpg " /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-07-12T11:15:50-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content=" https://www.alexbevi.com/images/nodejs-banner.jpg " /><meta property="twitter:title" content="Call Stack, But Make It Async!" /><meta name="twitter:site" content="@alexbevi" /><meta name="twitter:creator" content="@Neal Beeken" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Neal Beeken","url":"https://nbbeeken.github.io"},"dateModified":"2025-10-15T05:56:53-04:00","datePublished":"2024-07-12T11:15:50-04:00","description":"Written by Neal Beeken (Blog, GitHub) - Canonical URL is at medium.com","headline":"Call Stack, But Make It Async!","image":" https://www.alexbevi.com/images/nodejs-banner.jpg ","mainEntityOfPage":{"@type":"WebPage","@id":"https://medium.com/@MongoDB/call-stack-but-make-it-async-f912cb895ebd"},"url":"https://medium.com/@MongoDB/call-stack-but-make-it-async-f912cb895ebd"}</script><title>Call Stack, But Make It Async! | ALEX BEVILACQUA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="ALEX BEVILACQUA"><meta name="application-name" content="ALEX BEVILACQUA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="/assets/lib/tocbot/tocbot.min.css"><link rel="stylesheet" href="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="/assets/lib/glightbox/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="/assets/lib/simple-jekyll-search/simple-jekyll-search.min.js"></script> <script defer src="/assets/lib/loading-attribute-polyfill/loading-attribute-polyfill.umd.min.js"></script> <script defer src="/assets/lib/glightbox/glightbox.min.js"></script> <script defer src="/assets/lib/clipboard/clipboard.min.js"></script> <script defer src="/assets/lib/dayjs/dayjs.min.js"></script> <script defer src="/assets/lib/dayjs/locale/en.js"></script> <script defer src="/assets/lib/dayjs/plugin/relativeTime.js"></script> <script defer src="/assets/lib/dayjs/plugin/localizedFormat.js"></script> <script defer src="/assets/lib/tocbot/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-36490021-1"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-36490021-1'); }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery-bundle.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-transitions.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css" rel="stylesheet"><style> .inline-gallery-container { width: 100%; // set 60% height height: 0; padding-bottom: 65%; }</style><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6215800856413580" crossorigin="anonymous"></script><meta name="google-adsense-account" content="ca-pub-6215800856413580"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src=" /./images/avatar.png " width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">ALEX BEVILACQUA</a><p class="site-subtitle fst-italic mb-0">my little corner of the interwebs</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/specifications/" class="nav-link"> <i class="fa-fw fas fa-leaf"></i> <span>MONGODB DRIVER SPECIFICATIONS</span> </a><li class="nav-item"> <a href="/driver-compatibility-checker/" class="nav-link"> <i class="fa-fw fas fa-car"></i> <span>MONGODB DRIVER COMPATIBILITY CHECKER</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/alexbevi " aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/alexbevi " aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['alex','alexbevi.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="@alexbevi@ruby.social" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="https://linkedin.com/in/alexbevi" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/195509" aria-label="stack-overflow" target="_blank" rel="noopener noreferrer" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.facebook.com/alexbevi" aria-label="facebook" target="_blank" rel="noopener noreferrer" > <i class="fab fa-facebook"></i> </a> <a href="https://reddit.com/user/alexbevi" aria-label="reddit" target="_blank" rel="noopener noreferrer" > <i class="fab fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Call Stack, But Make It Async!</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Call Stack, But Make It Async!</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1720797350" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 12, 2024 </time> </span> <span> Updated <time data-ts="1760522213" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 15, 2025 </time> </span><div class="mt-3 mb-3"> <a href=" /images/nodejs-banner.jpg" class="popup img-link preview-img shimmer"><img src=" /images/nodejs-banner.jpg" alt="Preview Image" width="1200" height="630" loading="lazy"></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://nbbeeken.github.io">Neal Beeken</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1818 words" > <em>10 min</em> read </span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Call Stack, But Make It Async!</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Call Stack, But Make It Async!</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><blockquote class="prompt-tip"><p>Written by Neal Beeken (<a href="https://nbbeeken.github.io/">Blog</a>, <a href="https://github.com/nbbeeken">GitHub</a>) - Canonical URL is at <a href="https://medium.com/@MongoDB/call-stack-but-make-it-async-f912cb895ebd">medium.com</a></p></blockquote><p>In a recent release of the MongoDB Node.js driver (<a href="https://github.com/mongodb/node-mongodb-native/releases/tag/v6.5.0">v6.5.0</a>), the team completed the effort of getting all our asynchronous operations to report an accurate asynchronous stack trace to assist in pinpointing error origination. Here, I‚Äôll walk you through what this feature of JavaScript is and how to obtain it at the low price of zero cost.</p><h2 id="calls-and-how-to-stack-them-"><span class="me-2">Calls and how to stack them üìö</span><a href="#calls-and-how-to-stack-them-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>First, what is a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Call_stack">call stack</a>? A call stack is a hidden data structure that stores information about the active subroutines of a program - active subroutines being functions that have been called but have yet to complete execution and return control to the caller. The main function of the call stack is to keep track of the point to which each active subroutine should return control when it finishes executing.</p><p>Let‚Äôs go through an example. Take a program that parses a string from its arguments that is an equation like ‚Äú2+2‚Äù and computes the result:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nf">main</span><span class="p">()</span>
  <span class="o">-&gt;</span> <span class="nf">parseString</span><span class="p">()</span>
    <span class="o">-&gt;</span> <span class="nf">splitString</span><span class="p">()</span>
      <span class="o">-&gt;</span> <span class="nf">stringLength</span><span class="p">()</span>
    <span class="o">-&gt;</span> <span class="nf">stringToNumber</span><span class="p">()</span>
  <span class="o">-&gt;</span> <span class="nf">add</span><span class="p">()</span>
  <span class="o">-&gt;</span> <span class="nf">printResult</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="k">return</span><span class="p">;</span>
</pre></table></code></div></div><p>Most of us are familiar with the above procedural paradigm (whether from JavaScript, C, Java, or Python) where each step in the program is synchronous, so our call stack is a clear ordering of dependent procedures. For example, if <code class="language-plaintext highlighter-rouge">stringLength</code> fails, the call stack would contain <code class="language-plaintext highlighter-rouge">stringLength</code>, <code class="language-plaintext highlighter-rouge">splitString</code>, <code class="language-plaintext highlighter-rouge">parseString</code>, and <code class="language-plaintext highlighter-rouge">main</code> as active procedures that have yet to return to their callers. The error system of our runtime uses this stack trace to generate a helpful error trace:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>file://addNumbers.mjs:35
    throw new Error('cannot get string length')
          ^
Error: cannot get string length
    at stringLength (file://addNumbers.mjs:35:11)
    at splitString (file://addNumbers.mjs:17:17)
    at parseString (file://addNumbers.mjs:11:19)
    at main (file://addNumbers.mjs:4:5)
</pre></table></code></div></div><h3 id="the-async-wrench-"><span class="me-2">The async wrench üîß</span><a href="#the-async-wrench-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Everything changes when we shift to an asynchronous programming model, as the introduction of asynchronous work means we no longer have strictly dependent procedures. Essentially, async programming is about setting up tasks and adding handling that will be invoked sometime later when the task is complete.</p><p>Let‚Äôs add I/O (a read from standard in) into our program to see how this changes our call stack:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nf">main</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="nf">readStdin</span><span class="p">(</span><span class="nx">handleUserInput</span><span class="p">)</span>
<span class="c1">// When the user finishes typing</span>
<span class="nf">handleUserInput</span><span class="p">()</span>
<span class="o">-&gt;</span> <span class="nf">parseString</span><span class="p">()</span>
  <span class="o">-&gt;</span> <span class="nf">splitString</span><span class="p">()</span>
    <span class="o">-&gt;</span> <span class="nf">stringLength</span><span class="p">()</span>
</pre></table></code></div></div><p>Now, main‚Äôs only job is to ask the runtime to read from stdin and invoke a function of our choice when it is done doing so. This means main is no longer an active procedure; it returns, leaving it up to the runtime to keep the process running until it has input from stdin to hand back to our function <code class="language-plaintext highlighter-rouge">handleUserInput</code>.</p><p>Here‚Äôs what the stack trace looks like:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>file://addNumbers.mjs:42
    throw new Error('cannot get string length')
    ^
Error: cannot get string length
    at stringLength (file://addNumbers.mjs:42:11)
    at splitString (file://addNumbers.mjs:24:17)
    at parseString (file://addNumbers.mjs:18:19)
    at ReadStream.handleUserInput (file://addNumbers.mjs:11:5)
    at ReadStream.emit (node:events:511:28)
    at addChunk (node:internal/streams/readable:332:12)
    at readableAddChunk (node:internal/streams/readable:305:9)
    at Readable.push (node:internal/streams/readable:242:10)
    at TTY.onStreamRead (node:internal/stream_base_commons:190:23)
</pre></table></code></div></div><p>No sign of <code class="language-plaintext highlighter-rouge">main</code>, only <code class="language-plaintext highlighter-rouge">handleUserInput</code>.</p><p>This is a common hazard of asynchronous programming: You are always replacing the record of your active procedures as they are all performing task setup that completes and the callbacks they created are later invoked by the runtime.</p><h2 id="javascript-"><span class="me-2">JavaScript üíö</span><a href="#javascript-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Asynchronous programming has always been at the heart of JS and is one of the central selling points of using Node.js.</p><p>In 2015, the first <a href="https://nodejs.org/en/blog/release/v4.2.0">Long Term Support version of Node.js was released</a>, and with it came a stable standard library that popularized a common pattern for handling asynchronous tasks. All asynchronous tasks would accept a callback as their last argument, with the callback taking at least two arguments: an error and the task‚Äôs result. The pattern was that if the first argument was <a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy">truthy</a> (an error object), the task failed, and if it was not, then the second argument would contain the result.</p><p>Here‚Äôs a simplified example of a function that reads a file:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nf">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">filename.txt</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">file contents</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">})</span>
</pre></table></code></div></div><p>The Node.js callback pattern is ubiquitous and familiar, resulting in many popular libraries - such as the <a href="https://www.mongodb.com/docs/drivers/node/current/">MongoDB Node.js driver</a> - adopting it, as well.</p><h3 id="no-throw-only-callback-"><span class="me-2">No throw, only callback üêï</span><a href="#no-throw-only-callback-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href=" /images/js-cupcake.png" class="popup img-link shimmer"><img src=" /images/js-cupcake.png" alt="" loading="lazy"></a> <em>credit: <a href="https://cupcakelogic.tumblr.com/post/124392369931/she-is-still-learning">cupcakelogic</a></em></p><p>A challenge associated with the callback pattern is the requirement that the implementer keep in mind execution expectations manually. Otherwise, they can end up with a confusing order of operations.</p><p>Typically, this is something that should be abstracted to the runtime or language, which can be broken down as follows:</p><p><strong>Error handling</strong></p><p>Properly implementing the callback pattern means errors are passed as variables to a chain of handlers so they eventually reach the top-level initiator of the async operation. The syntax and keywords <code class="language-plaintext highlighter-rouge">throw</code>/<code class="language-plaintext highlighter-rouge">try</code>/<code class="language-plaintext highlighter-rouge">catch</code> can no longer be used for control flow.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
  <span class="nf">readFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">filename</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ? */</span> <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// So what's the truth?</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Runtime order</strong></p><p>Callbacks also demand the developers ensure execution order is consistent. If a file is successfully read and the contents are returned in the callback passed to <code class="language-plaintext highlighter-rouge">readFile</code>, that callback will always run after the code that is on the line following <code class="language-plaintext highlighter-rouge">readFile</code>. However, say <code class="language-plaintext highlighter-rouge">readFile</code> is passed an invalid argument, like a number instead of a string for the path. When it invokes the callback with an invalid argument error, we would still expect that code to run in the same order as the success case:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">filename</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
       <span class="nf">callback</span><span class="p">(</span><span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">invalid argument</span><span class="dl">'</span><span class="p">))</span>
       <span class="k">return</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="c1">// open &amp; read file ...</span>
<span class="p">}</span>

<span class="nf">readFile</span><span class="p">(</span><span class="mh">0xF113</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">cannot read file</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
       <span class="k">return</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">contents:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">starting to read file</span><span class="dl">'</span><span class="p">)</span>
</pre></table></code></div></div><p>The code above prints:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>cannot read file Error: invalid argument
starting to read file
</pre></table></code></div></div><p>Whereas when I change <code class="language-plaintext highlighter-rouge">readFile</code> to be called with a non-existent path:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>starting to read file
cannot read file Error: /notAPath.txt Does Not Exist
</pre></table></code></div></div><p>This is unexpected! The implementer of <code class="language-plaintext highlighter-rouge">readFile</code> calls the callback synchronously for an invalid type so <code class="language-plaintext highlighter-rouge">readFile</code> does not return until that callback completes. It is fairly easy to write callback-accepting functions that inconsistently order their execution in this way.</p><h3 id="promises-"><span class="me-2">Promises ü§û</span><a href="#promises-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Introducing a more structured approach: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a>. A promise is an object that handles the resolution or rejection of an async operation, mitigating the above issues and allowing for many async operations to be chained together without needing to explicitly pass a finalizer callback through to each API that would indicate when all tasks are done.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// callbacks</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
 <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nf">done</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
 <span class="p">}</span>
 <span class="nx">client</span>
   <span class="p">.</span><span class="nf">db</span><span class="p">()</span>
   <span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">)</span>
   <span class="p">.</span><span class="nf">findOne</span><span class="p">({},</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nb">document</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="nf">done</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
     <span class="k">return</span> <span class="nf">done</span><span class="p">();</span>
   <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// promises</span>
<span class="nx">client</span>
 <span class="p">.</span><span class="nf">connect</span><span class="p">()</span>
 <span class="p">.</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">client</span><span class="p">.</span><span class="nf">db</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">).</span><span class="nf">findOne</span><span class="p">({}))</span>
 <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nb">document</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nb">document</span><span class="p">));</span>
 <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">error</span><span class="p">));</span>
</pre></table></code></div></div><p>Note how in the promise code there is one error handling case as opposed to the two in the callback case. The ability to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises#chaining">chain promises</a> allows us to treat many async operations as one. The <code class="language-plaintext highlighter-rouge">catch</code> handler would be called if either the <code class="language-plaintext highlighter-rouge">connect</code> or the <code class="language-plaintext highlighter-rouge">find</code> methods were to throw an error. This chaining is convenient, but when writing JavaScript today, we do even better by using special syntax for handling promises.</p><h3 id="enter-asyncawait-"><span class="me-2">Enter <code class="language-plaintext highlighter-rouge">async</code>/<code class="language-plaintext highlighter-rouge">await</code> üîÅ</span><a href="#enter-asyncawait-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Mid-2017, JavaScript engines shipped support for <code class="language-plaintext highlighter-rouge">async</code>/<code class="language-plaintext highlighter-rouge">await</code> syntax, allowing programmers to write asynchronous operations in a familiar procedural format. Using <code class="language-plaintext highlighter-rouge">async</code>/<code class="language-plaintext highlighter-rouge">await</code> allows the programmer to encode their logical asynchronous dependencies right into the syntax of the language.</p><p>Let‚Äôs return to our user input example, as we can now ‚Äúawait‚Äù the input which keeps <code class="language-plaintext highlighter-rouge">main</code> as the active procedure that began the task to read from standard in.</p><blockquote class="prompt-info"><p>‚ÄúFor <code class="language-plaintext highlighter-rouge">await</code>, the suspend and resume points coincide and so we not only know where we would continue, but by coincidence, we also know where we came from.‚Äù</p><p>source: <a href="https://docs.google.com/document/d/13Sy_kBIJGP0XT34V1CV3nkWya4TwYx9L3Yv45LdGB6Q/edit#heading=h.e6lcalo0cl47">Zero-cost async stack traces</a></p></blockquote><p>When the input is available, <code class="language-plaintext highlighter-rouge">readStdin</code> will resolve and we can continue with our parsing.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">async</span> <span class="nf">main</span><span class="p">()</span>
  <span class="o">-&gt;</span> <span class="k">await</span> <span class="nf">readStdin</span><span class="p">()</span>
  <span class="o">-&gt;</span> <span class="nf">parseString</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>file://addNumbers.mjs:43
    throw new Error('cannot get string length')
          ^
Error: cannot get string length
    at stringLength (file://addNumbers.mjs:43:11)
    at splitString (file://addNumbers.mjs:25:17)
    at parseString (file://addNumbers.mjs:19:19)
    at main (file://addNumbers.mjs:9:5)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file://addNumbers.mjs:62:1
</pre></table></code></div></div><p>When the JavaScript engine reaches the ‚Äúawait‚Äù, <code class="language-plaintext highlighter-rouge">main</code> is suspended. The engine is free to handle other tasks while the read is waiting for our user to type. We can now encode into the syntax of the function that it will suspend until some other task completes, and when it continues, it maintains the context of everything that was in scope when it started.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
 <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nf">connect</span><span class="p">();</span>
 <span class="kd">const</span> <span class="nb">document</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nf">db</span><span class="p">().</span><span class="nf">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">).</span><span class="nf">findOne</span><span class="p">({});</span>
 <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
 <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote class="prompt-info"><p>‚ÄúThe fundamental difference between <code class="language-plaintext highlighter-rouge">await</code> and manually constructed promises is that <code class="language-plaintext highlighter-rouge">await X()</code> <strong>suspends</strong> execution of the current function, while <code class="language-plaintext highlighter-rouge">promise.then(X)</code> will <strong>continue</strong> execution of the current function after adding the <code class="language-plaintext highlighter-rouge">X</code> call to the callback chain. In the context of stack traces, this difference is pretty significant.‚Äù</p><p>source: <a href="https://mathiasbynens.be/notes/async-stack-traces">Why await beats Promise#then() ¬∑ Mathias Bynens</a></p></blockquote><h2 id="sample-stack-traces"><span class="me-2">Sample Stack Traces</span><a href="#sample-stack-traces" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Prior to completing the <code class="language-plaintext highlighter-rouge">async</code>/<code class="language-plaintext highlighter-rouge">await</code> conversion down to the internal network layer of the driver, our error stack would begin at the point of converting a server‚Äôs error message into a JavaScript, such as:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>MongoServerError: Failing command via 'failCommand' failpoint
    at Connection.onMessage (./mongodb/lib/cmap/connection.js:231:30)
    at MessageStream.&lt;anonymous&gt; (./mongodb/lib/cmap/connection.js:61:60)
    at MessageStream.emit (node:events:520:28)
    at processIncomingData (./mongodb/lib/cmap/message_stream.js:125:16)
    at MessageStream._write (./mongodb/lib/cmap/message_stream.js:33:9)
    at writeOrBuffer (node:internal/streams/writable:564:12)
    at _write (node:internal/streams/writable:493:10)
    at Writable.write (node:internal/streams/writable:502:10)
    at Socket.ondata (node:internal/streams/readable:1007:22)
    at Socket.emit (node:events:520:28)
                    ^-- Sadness, that's not my code...
</pre></table></code></div></div><p>Now, post v6.5.0, the stack trace points directly back to the origination of an operation (we see you <code class="language-plaintext highlighter-rouge">main.js</code>!):</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>MongoServerError: Failing command via 'failCommand' failpoint
    at Connection.sendCommand (./mongodb/lib/cmap/connection.js:290:27)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Connection.command (./mongodb/lib/cmap/connection.js:313:26)
    at async Server.command (./mongodb/lib/sdam/server.js:167:29)
    at async FindOperation.execute (./mongodb/lib/operations/find.js:34:16)
    at async tryOperation (./mongodb/lib/operations/execute_operation.js:192:20)
    at async executeOperation (./mongodb/lib/operations/execute_operation.js:69:16)
    at async FindCursor._initialize (./mongodb/lib/cursor/find_cursor.js:51:26)
    at async FindCursor.cursorInit (./mongodb/lib/cursor/abstract_cursor.js:471:27)
    at async FindCursor.fetchBatch (./mongodb/lib/cursor/abstract_cursor.js:503:13)
    at async FindCursor.next (./mongodb/lib/cursor/abstract_cursor.js:228:13)
    at async Collection.findOne (./mongodb/lib/collection.js:274:21)
    at async main (./mongodb/main.js:19:3)
                   ^-- Yay, that's my code!
</pre></table></code></div></div><hr /><p><strong>Additional Resources</strong></p><ul><li><a href="https://docs.google.com/document/d/13Sy_kBIJGP0XT34V1CV3nkWya4TwYx9L3Yv45LdGB6Q/edit">Zero-cost async stack traces</a><li><a href="https://github.com/tc39/proposal-error-stacks">tc39/proposal-error-stacks</a><li><a href="https://v8.dev/docs/stack-trace-api">Stack trace API</a><li><a href="https://v8.dev/blog/modern-javascript#proper-tail-calls">ES2015, ES2016, and beyond ¬∑ Tail Calls ¬∑ V8</a><li><a href="https://v8.dev/blog/fast-async">Faster async functions and promises ¬∑ V8</a><li><a href="https://mathiasbynens.be/notes/async-stack-traces">Asynchronous stack traces: why await beats Promise#then() ¬∑ Mathias Bynens</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/programming/">Programming</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="/tags/node/" class="post-tag no-text-decoration" >node</a> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/drivers/" class="post-tag no-text-decoration" >drivers</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA&u=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F&text=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA&url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Weibo" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <a href="https://bsky.app/intent/compose?text=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Bluesky" aria-label="Bluesky"> <i class="fa-fw fa-brands fa-bluesky"></i> </a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F&title=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit"> <i class="fa-fw fa-brands fa-square-reddit"></i> </a> <a href="https://www.threads.net/intent/post?text=Call%20Stack,%20But%20Make%20It%20Async!%20-%20ALEX%20BEVILACQUA%20https%3A%2F%2Fwww.alexbevi.com%2Fblog%2F2024%2F07%2F12%2Fcall-stack-but-make-it-async%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Threads" aria-label="Threads"> <i class="fa-fw fa-brands fa-square-threads"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/blog/2023/02/13/ruby-on-rails-global-summit-23/">Ruby on Rails Global Summit '23</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/15/urban-runner/">Urban Runner (Coktel Vision) - 1996</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/15/the-crimson-crown-further-adventures-in-transylvania/">The Crimson Crown - Further Adventures in Transylvania (Penguin Software) - 1985</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/18/manhunter-new-york/">Manhunter: New York (Evryware) - 1988</a><li class="text-truncate lh-lg"> <a href="/blog/2023/02/21/police-quest-2/">Police Quest II: The Vengeance (Sierra On-Line) - 1988</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/blog/2025/07/30/mongodb-driver-compatibility-with-mongodb-servers/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1753910439" data-df="ll" > Jul 30, 2025 </time><h4 class="pt-0 my-2">MongoDB Driver Compatibility with MongoDB Servers</h4><div class="text-muted"><p>MongoDB server versions [eventually reach EOL](https://www.mongodb.com/legal/support-policy/lifecycles) - as MongoDB 6.0 did on July 31, 2025. If your workload is running in MongoDB Atlas, the majo...</p></div></div></a></article><article class="col"> <a href="/blog/2025/04/11/performance-profiling-mongodb-on-cloudflare-workers/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1744367035" data-df="ll" > Apr 11, 2025 </time><h4 class="pt-0 my-2">Performance Profiling MongoDB on Cloudflare Workers</h4><div class="text-muted"><p>Cloudflare recently wrote about "[Your frontend, backend, and database ‚Äî now in one Cloudflare Worker](https://blog.cloudflare.com/full-stack-development-on-cloudflare-workers/#node-js-compatibilit...</p></div></div></a></article><article class="col"> <a href="/blog/2025/03/25/cloudflare-workers-and-mongodb/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1742923302" data-df="ll" > Mar 25, 2025 </time><h4 class="pt-0 my-2">Cloudflare Workers and MongoDB</h4><div class="text-muted"><p>Previously I wrote about [_Why Cloudflare Workers Don't Work With MongoDB_]({% post_url 2024-09-11-why-cloudflare-workers-dont-work-with-mongodb %}), but since then the Cloudflare team has done som...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/blog/2024/07/09/discworld/" class="btn btn-outline-primary" aria-label="Older" ><p>Discworld (Teeny Weeny Games/Perfect 10 Productions) - 1995</p></a> <a href="/blog/2024/07/15/jurassic-park/" class="btn btn-outline-primary" aria-label="Newer" ><p>Jurassic Park (Sega of America) - 1993</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>¬© <time>2025</time> <a href="https://twitter.com/alexbevi">Alex Bevilacqua</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/adventure/">adventure</a> <a class="post-tag btn btn-outline-primary" href="/tags/mongodb/">mongodb</a> <a class="post-tag btn btn-outline-primary" href="/tags/sierra-on-line/">Sierra On-Line</a> <a class="post-tag btn btn-outline-primary" href="/tags/drivers/">drivers</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/redmine/">redmine</a> <a class="post-tag btn btn-outline-primary" href="/tags/sci/">SCI</a> <a class="post-tag btn btn-outline-primary" href="/tags/rpg/">rpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/book/">book</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> var disqus_config = function () { this.page.url = 'https://www.alexbevi.com/blog/2024/07/12/call-stack-but-make-it-async/'; this.page.identifier = '/blog/2024/07/12/call-stack-but-make-it-async/'; }; function addDisqus() { let disqusThread = document.createElement('div'); let paragraph = document.createElement('p'); disqusThread.id = 'disqus_thread'; paragraph.className = 'text-center text-muted small'; paragraph.innerHTML = 'Comments powered by <a href="https://disqus.com/">Disqus</a>.'; disqusThread.appendChild(paragraph); const footer = document.querySelector('footer'); footer.insertAdjacentElement("beforebegin", disqusThread); }function reloadDisqus(event) { if (event.source === window && event.data && event.data.id === Theme.ID) {if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } addDisqus(); if (Theme.switchable) { addEventListener('message', reloadDisqus); }var disqusObserver = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { var d = document, s = d.createElement('script'); s.src = 'https://alexbevi.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); disqusObserver.disconnect(); } }, { threshold: [0] } ); disqusObserver.observe(document.getElementById('disqus_thread')); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
